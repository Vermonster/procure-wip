{"version":3,"sources":["store/initial-state.js","smart/fhir.js","smart/smart-core.js","smart/smart-popup.js","store/file-exporter.js","store/merge-objects.js","store/config-loader.js","store/zip-exporter.js","store/github-api.js","store/spreadsheet-exporter.js","store/csv-writer.js","store/user-settings.js","store/store.js","store/fhir-loader.js","store/github-exporter.js","components/ProviderForm.js","components/TimeAgo.js","components/ProviderList.js","components/Fetcher.js","components/Loader.js","components/GithubUploader.js","components/SettingsImportDropZone.js","components/Header.js","components/FhirTree.js","components/Toolbar.js","components/BlankSlate.js","components/FileUploader.js","components/Wizard/Start.js","components/Wizard/SelectProvider.js","components/Wizard/Retrieve.js","components/Wizard/DownloadButton.js","components/Wizard/Review.js","components/Wizard/Upload.js","components/Wizard/index.js","components/App.js","serviceWorker.js","index.js"],"names":["module","exports","uiState","mode","spreadsheetTemplates","isDirty","nonModalUi","queryProfile","mimeTypeMappings","githubConfig","upload","providers","fetchFHIR","url","config","fhirVersion","token","retryLimit","retries","headers","Accept","isR2","toUpperCase","Authorization","fetch","then","response","ok","Error","status","statusText","data","json","resourceType","error","issue","diagnostics","catch","err","replaceValue","path","element","replaceFn","split","value","nextPath","slice","length","undefined","Array","isArray","forEach","v","newValue","pathToValues","map","reduce","a","b","concat","filter","buildAbsoluteUrl","fhirEndpoint","reference","test","replace","addProvenance","resource","meta","source","extension","push","valueUri","getResourcesByUrl","urls","allowErrors","signal","statusCallback","Promise","all","_","fullUrl","e","name","message","requestType","errorLog","r","entry","findReferences","paths","p","refIndex","ent","i","each","ref","rawUrl","embedReferences","refEntry","contained","id","findAttachments","attachmentIndex","attachment","contentType","count","getResourcesByQuery","query","resolve","reject","fetchResources","page","fhirData","nextUrl","link","find","l","relation","pageLimit","errorCount","resourcePath","Object","keys","params","fhirParams","k","join","encodeURIComponent","followAndEmbedReferences","updatedEntry","followReferences","findAndDownloadAttachments","fetchAttachment","blob","urlExtension","match","mimeExtension","fileName","toString","files","attachmentsToFilenames","file","f","authEndpointErr","getWellKnownEndpoints","baseUrl","endpoints","registrationEndpoint","registration_endpoint","authorizationEndpoint","authorization_endpoint","tokenEndpoint","token_endpoint","getCapabilityEndpoints","fhir","extensions","obj","trim","out","key","getPath","o","ext","getAuthEndpoints","buildQs","buildAuthorizeUrl","authEndpoint","state","scope","redirectUri","clientId","clientSecret","launch","exchangeCodeForToken","code","method","body","btoa","refreshToken","generateStateParam","targetLen","charSet","result","charAt","Math","floor","random","SmartPopup","constructor","provider","this","authWindow","window","open","document","write","parseQs","qs","pairs","pair","decodeURIComponent","cancel","clearInterval","popupPoll","removeEventListener","messageListener","close","authorize","authEndpoints","ignoreState","stateParam","SMART","setInterval","closed","addEventListener","event","origin","location","access_token","console","log","href","FileExporter","controller","abort","resetCancelled","AbortController","isValidUrl","whitelist","rule","matchUrl","getManifest","accept","tv4","validate","configSchema","putFile","get","indexOf","merge","templates","mergeArray","base","override","overrideItem","baseIndex","findIndex","splice","mergeObject","isPlainObject","JSON","parse","stringify","template","getUrlParameter","results","RegExp","exec","search","readConfigFile","isOverride","text","stripJsonComments","loadConfigFile","overridePath","allowQsOverride","configReaders","qsOverridePath","mergeObjects","endpointLists","invalidEndpointId","defaults","queryProfiles","invalidCredentialId","credentialId","credentials","templateNames","templateName","extends","baseTemplateName","endpointList","endpointListSchema","Entries","endpoint","newEntry","OrganizationName","FHIRPatientFacingURI","orgId","defaultId","getEndpointList","organizations","apply","orgDefaults","mapValues","loadEndpointLists","manifestUrl","qsManifestUrl","label","showWizard","overlayQsValues","uploadUrl","fileExporter","manifest","addProviderToZip","zipFolder","bundles","chain","groupBy","total","type","bundle","exportProvidersAsBlob","zip","jszip","selected","folder","sanitizeFilename","generateAsync","generateFile","multiProviderFileName","exportableProviders","saveAs","exportProviders","callApi","jsonPayload","reqConfig","owner","project","stats","getLastCommit","branchName","getTree","commit","object","sha","tree","truncated","createBlob","createTree","commitTree","lastCommit","parents","commitTreeToPullRequest","title","newBranchName","baseBranch","bodyText","head","maintainer_can_modify","defaultHelperFns","validateExists","validateCode","c","target","validateValue","getHelperData","helperData","helperDataField","stringifyCodings","system","parseDateForExcel","format","Date","flatten","helperFns","rows","field","mergeRows","rowsToMerge","newRows","mergeRow","mergeRowItem","row","at","first","transform","children","childRows","childElement","item","flattenProviders","providerHelperData","getTemplateColumns","cols","arrayToCols","templateArray","exportFlatDataCSV","flatData","columns","col","csv","rawValue","toLocaleString","Blob","csvWriter","exportSpreadsheet","templateId","templateDefinition","templateDefinitions","mergedTemplateDefinition","sortBy","s","sortDir","dir","orderBy","dateCols","XlsxPopulate","fromBlankAsync","workbook","sheet","cell","dateCol","column","style","outputAsync","exportFlatDataExcel","buildJSON","lastUpdated","download","readFromFile","reader","FileReader","onload","onerror","readAsText","userSettingsSchema","initialState","require","fhirLoader","resetAbortController","popup","mergeAndDeDupeData","uniqueUrls","queryResult","getFHIR","context","patientId","patient","queries","FHIR","containReferences","retrieveReferences","downloadAttachments","authAndGetFHIR","Smart","ghExporter","canceled","blobToBase64","base64","readAsDataURL","buildProviderTree","content","encoding","statusCb","gh","buildResourceTree","buildFileTree","trees","buildTree","baseTree","allProviders","folders","newTrees","prepareCommit","export","pullRequest","commitPullRequest","commitToMaster","toISOString","pull","html_url","simulateTimer","createUniqueId","store","createStore","on","newUiState","counts","countType","newState","dirtySnapshot","reset","newSnapshot","UserSettings","dispatch","endState","ConfigLoader","process","newConfig","providerId","handleLoadDone","submode","handleStatusUpdate","isError","requestCount","loadFhir","handleGlobalError","isOpen","isDownloading","ZipExporter","finally","isExportingSheet","SpreadsheetExporter","statusUrl","simulate","clearTimeout","setTimeout","zipExporter","noCustomEndpoints","useStoreon","useState","setProvider","validation","setValidation","showDetails","setShowDetails","orgOptions","handleCancel","useCallback","preventDefault","useEffect","downHandler","keyCode","currentProvider","handleSubmit","skipRefresh","errors","handleOrgSelection","selection","orgConfig","updatedProvider","isInvalidUrl","toLowerCase","renderTextInput","property","isRequired","instructions","valueFn","onChangeFn","formText","FormText","color","errorText","FormFeedback","onChange","FormGroup","Label","for","Input","invalid","required","renderProfileSelector","profileOptions","q","openCheckbox","check","checked","detailsLink","onClick","shortForm","autoFocus","filterOption","createFilter","ignoreAccents","isSearchable","options","defaultMenuIsOpen","renderOrgSelector","openDetails","secureDetails","Modal","fade","backdrop","ModalHeader","ModalBody","Form","onSubmit","className","noValidate","ModalFooter","Button","marginLeft","TimeAgo","React","Component","props","super","timeAgo","time","componentDidMount","interval","setState","refreshMinutes","componentWillUnmount","render","toggleProviderSelection","pluralizeEn","len","marginBottom","marginRight","icon","faPlus","controls","handleEditProvider","faEdit","handleDeleteProvider","faTrash","fontWeight","handleLoadRecords","Card","margin","CardBody","Row","Col","xs","size","visibility","width","height","htmlFor","faCheckSquare","faSquare","cursor","display","useMemo","handleClose","handleSave","handleLogDownload","textAlign","padding","Spinner","downloadLink","renderLoadedButtons","showInstructions","setShowInstructions","handleHideDialog","handleCancelExport","handleFieldChange","fieldName","handleToggleInstructions","Container","Alert","rel","renderMessage","form","marginTop","placeholder","data-lpignore","readOnly","defaultValue","dropHint","fileDropHandler","dragCounter","setDragCounter","isFileDrag","dataTransfer","types","overlay","border","backgroundColor","position","top","bottom","left","right","zIndex","onDragEnter","stopPropagation","onDragOver","onDragLeave","onDrop","warnOnPageNavigate","appName","fileInput","useRef","onbeforeunload","readFile","confirm","SettingsImportDropZone","Navbar","light","expand","NavbarBrand","faMedkit","alt","Nav","navbar","NavItem","NavLink","current","click","dateSortElements","setResourceType","setPosition","overlayResources","setOverlayResources","componentTopRef","resourceTypeOptions","uniq","resources","sortElements","sortElement","start","reverse","simplifyUrl","referenceIndex","index","j","handlePosChange","filters","isClearable","treeTheme","base00","base01","base02","base03","base04","base05","base06","base07","base08","base09","base0A","base0B","base0C","base0D","base0E","base0F","valueRenderer","raw","refUrl","last","substring","textDecoration","scrollTo","offsetTop","handleReference","noResources","nextPrevNav","outline","disabled","faChevronLeft","faChevronRight","overlayNav","renderPositionNav","overlayData","getResourceByUrl","borderRadius","background","theme","hideRoot","shouldExpandNode","keyName","level","invertTheme","renderJsonTree","showSpreadsheetOptions","setShowSpreadsheetOptions","handelExportSpreadsheet","uploadButton","faFileUpload","downloadAllButton","faFileDownload","ghExportButton","faGithub","hasResources","menuItems","DropdownItem","bind","Dropdown","toggle","DropdownToggle","caret","faTable","DropdownMenu","renderSpreadsheetExport","block","handleDone","continueUrl","handleUploadFile","renderLoading","infoUrl","successMessage","continueLabel","handleBack","renderWorking","showDownloadOptions","setShowDownloadOptions","providerList","DownloadButton","numberStyle","active","inactive","switchToFull","md","offset","lg","borderBottom","minWidth","minHeight","Start","SelectProvider","Retrieve","Review","Upload","App","Loader","inlineError","hasProviders","hasData","fullUi","Header","fluid","xl","ProviderList","sm","BlankSlate","Toolbar","FhirTree","renderData","ProviderForm","Fetcher","GithubUploader","FileUploader","wizardUi","Wizard","classList","add","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","onUpdate","onSuccess","ReactDOM","Provider","getElementById","URL","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.3ca37277.chunk.js","sourcesContent":["module.exports = {\n\tuiState: {mode: \"loading\"},\n\tspreadsheetTemplates: {},\n\tisDirty: false,\n\tnonModalUi: {},\n\tqueryProfile: {},\n\tmimeTypeMappings: {},\n\tgithubConfig: {},\n\tupload: {},\n\tproviders: []\n}","import \"cross-fetch\";\nimport _ from \"lodash\";\n\nfunction fetchFHIR(url, config={}, fhirVersion=\"DSTU2\", token=null, retryLimit=0, retries=0) {\n\tif (!config) config = {};\n\tif (!config.headers) config.headers = {};\n\tif (!config.headers.Accept) {\n\t\tconst isR2 = fhirVersion.toUpperCase() === \"DSTU2\" || fhirVersion.toUpperCase() === \"R2\";\n\t\tconfig.headers.Accept = isR2 ? \"application/json+fhir\" : \"application/fhir+json\"; \n\t}\n\tif (token) config.headers.Authorization = `Bearer ${token}`\n\n\t// if (console) console.log(\"Fetching: \" + url);\n\n\treturn fetch(url, config)\n\t\t.then( response => {\n\t\t\tif (!response.ok)\n\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.json() )\n\t\t// .then( json => { console.log(json); return json; })\n\t\t.then( json => {\n\t\t\tif (!json.resourceType || json.resourceType === \"OperationOutcome\") {\n\t\t\t\tconst error = json.issue && json.issue[0] && json.issue[0].diagnostics;\n\t\t\t\tthrow new Error(error || \"Fetch failed for \" + url);\n\t\t\t}\n\t\t\treturn json;\n\t\t})\n\t\t.catch( err => {\n\t\t\tif (retryLimit && retries < retryLimit) {\n\t\t\t\treturn fetchFHIR(url, config, fhirVersion, token, retryLimit, retries+1)\n\t\t\t} else {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t});\n}\n\nfunction buildQs(fhirParams) {\n\treturn \"?\" + Object.keys(fhirParams).map( k => {\n\t\tconst value = Array.isArray(fhirParams[k]) ? fhirParams[k].join(\",\") : fhirParams[k];\n\t\treturn k + \"=\" + encodeURIComponent(value);\n\t}).join(\"&\");\n}\n\n\nfunction replaceValue(path, element, replaceFn) {\n\tif (typeof(path) === \"string\")\n\t\tpath = path.split(\".\");\n\n\tif (!element) return;\n\n\tconst value = element[path[0]];\n\tconst nextPath = path.slice(1);\n\n\tif (!nextPath.length && value !== undefined) {\n\t\tconst newValue = replaceFn(value);\n\t\tif (newValue !== undefined) element[path[0]] = newValue;\n\n\t} else if (value !== undefined) {\n\t\t(Array.isArray(value) ? value : [value])\n\t\t\t.forEach( v => replaceValue(nextPath, v, replaceFn) )\n\t}\n\t\n\treturn element;\n}\n\nfunction pathToValues(path, element) {\n\tif (typeof(path) === \"string\")\n\t\tpath = path.split(\".\");\n\n\tif (!element) return [];\n\n\tlet value = element[path[0]] || [];\n\tif (!Array.isArray(value)) value = [value];\n\tconst nextPath = path.slice(1);\n\n\tif (!nextPath.length) return value\n\n\treturn value\n\t\t.map( v => pathToValues(nextPath, v) )\n\t\t.reduce((a, b) => a.concat(b), []) //flatten\n\t\t.filter( v => v !== undefined);\n}\n\n//this is probably too simplistic\nfunction buildAbsoluteUrl(fhirEndpoint=\"\", reference) {\n\tif (/^http/.test(reference)) {\n\t\treturn reference;\n\t} else {\n\t\treturn fhirEndpoint.replace(/\\/*$/, \"/\") + reference;\n\t}\n}\n\nfunction addProvenance(resource, fhirEndpoint, fhirVersion=\"R2\") {\n\tresource.meta = resource.meta || {};\n\tif (fhirVersion.toUpperCase() === \"STU4\" || fhirVersion.toUpperCase() === \"R4\") {\n\t\tresource.meta.source = resource.meta.source || fhirEndpoint;\n\t} else {\n\t\tresource.meta.extension = resource.meta.extension || [];\n\t\t//per http://build.fhir.org/versions.html#extensions\n\t\tresource.meta.extension.push({\n\t\t\turl: \"http://hl7.org/fhir/4.0/StructureDefinition/extension-Meta.source\",\n\t\t\tvalueUri: fhirEndpoint\n\t\t})\n\t}\n\treturn resource;\n}\n\nfunction getResourcesByQuery({ fhirEndpoint, query={}, retryLimit=0, token, signal, allowErrors, statusCallback }) {\n\tlet entry = [];\n\treturn new Promise( (resolve, reject) => {\n\t\tconst fetchResources = (url, retries=0, page=1) => {\n\t\t\tif (statusCallback) statusCallback(url);\n\t\t\tfetchFHIR(url, {signal}, query.fhirVersion, token, retryLimit)\n\t\t\t\t.then( fhirData => {\n\t\t\t\t\t//single resource fetch (Operation Outcomes are converted to errors in fetchFHIR function)\n\t\t\t\t\tif (fhirData.resourceType !== \"Bundle\") {\n\t\t\t\t\t\tfhirData = addProvenance(fhirData, fhirEndpoint, query.fhirVersion);\n\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\tquery, entry: [{resource: fhirData, fullUrl: url}]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t//Epic returns Operation Outcomes in bundles to indicate data is not guaranteed to be complete\n\t\t\t\t\tentry = entry.concat(\n\t\t\t\t\t\t(fhirData.entry || [])\n\t\t\t\t\t\t\t.filter( r => r.resource.resourceType !== \"OperationOutcome\")\n\t\t\t\t\t\t\t.map(r => {\n\t\t\t\t\t\t\t\tr.resource = addProvenance(r.resource, fhirEndpoint, query.fhirVersion);\n\t\t\t\t\t\t\t\tr.fullUrl = buildAbsoluteUrl(fhirEndpoint, r.resource.resourceType + \"/\" + r.resource.id);\n\t\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\t//walk to next bundle or return resources\n\t\t\t\t\tconst nextUrl = fhirData.link && fhirData.link.find(l => l.relation === \"next\");\n\t\t\t\t\treturn (nextUrl && (!query.pageLimit || page < query.pageLimit))\n\t\t\t\t\t\t? fetchResources(nextUrl.url, retries, page+1)\n\t\t\t\t\t\t: resolve({ entry, query });\n\t\t\t\t\n\t\t\t\t})\n\t\t\t\t.catch( e => {\n\t\t\t\t\tif (allowErrors && e.name !== \"AbortError\") {\n\t\t\t\t\t\tif (statusCallback) statusCallback(url, true);\n\t\t\t\t\t\tresolve({errorLog: [{fullUrl: url, error: e.message, requestType: \"query\"}], entry: [], errorCount: 1});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(e)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t}\n\n\t\tconst url = fhirEndpoint.replace(/\\/*$/, \"/\") + (query.resourcePath || \"\") + \n\t\t\t(Object.keys(query.params || {}).length ? buildQs(query.params) : \"\");\n\t\tfetchResources(url);\n\t\n\t});\n\n}\n\nfunction getResourcesByUrl({ urls=[], fhirVersion, retryLimit, token, allowErrors, signal, statusCallback }) {\n\tconst getResourceByUrl = (url) => {\n\t\tif (statusCallback) statusCallback(url);\n\t\treturn fetchFHIR(url, {signal}, fhirVersion, token, retryLimit)\n\t\t\t.then( resource => ({fullUrl: url, resource}) )\n\t\t\t.catch( e => {\n\t\t\t\tif (!allowErrors || e.name === \"AbortError\") throw e;\n\t\t\t\tif (statusCallback) statusCallback(url, true);\n\t\t\t\treturn {fullUrl: url, error: e.message, requestType: \"reference\"};\n\t\t\t});\n\t}\n\n\treturn Promise.all( _.map(urls, getResourceByUrl) )\n\t\t.then( data => {\n\t\t\tconst errorLog = data.filter( r => r.error );\n\t\t\tconst entry = data.filter( r => !r.error );\n\t\t\treturn allowErrors ? {entry, errorLog} : entry;\n\t\t});\n\n}\n\nfunction findReferences({ entry=[], paths=[], fhirEndpoint }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\t//add reference element within reference type if not included\n\tpaths = paths.map(p => /\\.reference$/.test(p) ? p : p+\".reference\");\n\n\treturn _.reduce( entry, (refIndex, ent, i) => {\n\t\t_.each( paths, path => {\n\t\t\t_.each( pathToValues(path, ent.resource), ref => {\n\t\t\t\t//ignore contained references\n\t\t\t\tif (/^#/.test(ref)) return;\n\t\t\t\tconst url = buildAbsoluteUrl(fhirEndpoint, ref);\n\t\t\t\trefIndex[url] = refIndex[url] || [];\n\t\t\t\trefIndex[url].push({i, path, rawUrl: ref});\n\t\t\t});\n\t\t});\n\t\treturn refIndex;\n\t}, {});\n}\n\n//note - this function mutates the entries that are passed in\nfunction embedReferences({ entry=[], refEntry=[], refIndex={} }) {\n\t_.each( refEntry, ent => {\n\t\tlet resource;\n\t\t_.each( (refIndex[ent.fullUrl] || []), ref => {\n\t\t\tif (!resource) {\n\t\t\t\tresource = \tentry[ref.i].resource;\n\t\t\t\tresource.contained = entry[ref.i].resource.contained || [];\n\t\t\t\tresource.contained.push(ent.resource);\n\t\t\t}\n\t\t\treplaceValue(ref.path, resource, v => {\n\t\t\t\tif (v === ref.rawUrl) return \"#\" + ent.resource.id;\n\t\t\t});\n\t\t});\n\t});\n\treturn entry;\n}\n\nfunction followReferences({ entry=[], paths=[], fhirEndpoint, fhirVersion, retryLimit=0, token, allowErrors, signal, statusCallback }) {\n\tconst refIndex = findReferences({ entry, paths, fhirEndpoint });\n\treturn getResourcesByUrl({ urls: _.keys(refIndex), fhirVersion, retryLimit, token, allowErrors, signal, statusCallback })\n\t\t.then( data => {\n\t\t\tif (allowErrors) data.errorCount = \n\t\t\t\t_.reduce(data.errorLog, (count, ent) => count+refIndex[ent.fullUrl].length, 0);\n\t\t\treturn data;\n\t\t})\n}\n\nfunction followAndEmbedReferences({ entry=[], paths=[], fhirEndpoint, fhirVersion, retryLimit=0, token, allowErrors, signal, statusCallback }) {\n\tconst refIndex = findReferences({ entry, paths, fhirEndpoint });\n\treturn getResourcesByUrl({ urls: _.keys(refIndex), fhirVersion, retryLimit, token, allowErrors, signal, statusCallback })\n\t\t.then( data => {\n\t\t\tconst refEntry = allowErrors ? data.entry : data;\n\t\t\tconst updatedEntry = embedReferences({ entry, refEntry, refIndex })\n\t\t\treturn allowErrors ? {entry: updatedEntry, errorLog: data.errorLog} : updatedEntry;\n\t\t})\n}\n\nfunction findAttachments({ entry=[], paths=[], fhirEndpoint }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\n\treturn _.reduce( entry, (attachmentIndex, ent) => {\n\t\t_.each( paths, path => {\n\t\t\t_.each( pathToValues(path, ent.resource), attachment => {\n\t\t\t\t//ignore embedded data\n\t\t\t\tif (!attachment.url || attachment.data) return;\n\t\t\t\tconst url = buildAbsoluteUrl(fhirEndpoint, attachment.url);\n\t\t\t\tconst contentType = attachment.contentType || \"\";\n\t\t\t\tattachmentIndex[url+\"::\"+contentType||\"\"] = attachmentIndex[url+\"::\"+contentType||\"\"] || \n\t\t\t\t\t{contentType: attachment.contentType, url: url, rawUrl: attachment.url, count: 0};\n\t\t\t\tattachmentIndex[url+\"::\"+contentType||\"\"].count += 1;\n\t\t\t});\n\t\t});\n\t\treturn attachmentIndex;\n\t}, {});\n}\n\n//this function mutates the resources passed in\nfunction attachmentsToFilenames({ entry = [], files = [], paths }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\t_.each( entry, ent => {\n\t\t_.each( paths, path => {\n\t\t\tent.resource = replaceValue(path, ent.resource, v => {\n\t\t\t\tconst file = files.find(f => f.rawUrl === v.url && f.contentType === v.contentType);\n\t\t\t\tif (file) return {...v, url: file.fileName};\n\t\t\t});\n\t\t});\n\t})\n\treturn entry;\n}\n\nfunction findAndDownloadAttachments({ entry=[], paths=[], fhirEndpoint, token, allowErrors, retryLimit=0, signal, statusCallback, mimeTypeMappings={} }) {\n\t\n\tconst attachmentIndex = findAttachments({ entry, paths, fhirEndpoint });\n\t\n\tconst fetchAttachment = (url, config={}, retryLimit=0, retries=0) => {\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\t//Note that CORS errors for any reason even due to a 401 will not have an error code\n\t\t\t\t//in logs. See https://github.com/github/fetch/issues/201\n\t\t\t\tif (retryLimit && retries < retryLimit) {\n\t\t\t\t\treturn fetchAttachment(url, config, retryLimit, retries+1)\n\t\t\t\t} else {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\tlet i = 0;\n\treturn Promise.all(\n\t\t_.map( attachmentIndex, attachment => {\n\t\t\tlet config = {signal, headers: {\n\t\t\t\tAuthorization: token ? `Bearer ${token}` : undefined,\n\t\t\t\tAccept: attachment.contentType || undefined\n\t\t\t}};\n\t\t\tif (statusCallback) statusCallback(attachment.url);\n\t\t\treturn fetchAttachment(attachment.url, config, retryLimit)\n\t\t\t\t.then( data => data.blob() )\n\t\t\t\t.then( blob => {\n\t\t\t\t\tconst urlExtension = attachment.url.match(/\\.(.{3})$|\\.(.{4})$/);\n\t\t\t\t\tconst mimeExtension = attachment.contentType && mimeTypeMappings[attachment.contentType];\n\t\t\t\t\tconst extension = (urlExtension && urlExtension[1]) || mimeExtension;\n\t\t\t\t\tconst fileName = (i += 1).toString() + (extension ? \".\" + extension : \"\");\n\t\t\t\t\treturn {fileName, fullUrl: attachment.url, blob, contentType: attachment.contentType, rawUrl: attachment.rawUrl}\n\t\t\t\t})\n\t\t\t\t.catch( e => {\n\t\t\t\t\tif (!allowErrors || e.name === \"AbortError\") throw e;\n\t\t\t\t\tif (statusCallback) statusCallback(attachment.url, true);\n\t\t\t\t\treturn {fullUrl: attachment.url, contentType: attachment.contentType, error: e.message, requestType: \"attachment\", rawUrl: attachment.rawUrl};\n\t\t\t\t})\n\t\t})\n\t).then( data => {\n\t\tif (!allowErrors) return data;\n\t\tconst errorLog = data.filter( r => r.error );\n\t\tconst errorCount = _.reduce(errorLog, (count, ent) => count+attachmentIndex[ent.fullUrl+\"::\"+ent.contentType||\"\"].count, 0);\n\t\tconst files = data.filter( r => !r.error );\n\t\treturn allowErrors ? { files, errorLog, errorCount } : files;\n\t});\n}\n\n\nexport default { \n\tfetchFHIR, replaceValue, pathToValues, findReferences, embedReferences, findAttachments,\n\tgetResourcesByQuery, followAndEmbedReferences, followReferences, findAndDownloadAttachments,\n\tattachmentsToFilenames\n}","import fhir from \"./fhir\";\n\nconst authEndpointErr = \"Authorization endpoint or token endpoint not found\";\n\nfunction getPath(obj, path = \"\") {\n\tpath = path.trim();\n\tif (!path) return obj;\n\treturn path.split(\".\").reduce(\n\t\t(out, key) => out ? out[key] : undefined,\n\t\tobj\n\t);\n}\n\nfunction getAuthEndpoints(fhirEndpoint) {\n\tconst url = fhirEndpoint.replace(/\\/*$/, \"/\");\n\treturn new Promise( (resolve, reject) => {\n\t\tgetWellKnownEndpoints(url)\n\t\t\t.then( endpoints => resolve(endpoints) )\n\t\t\t.catch( err => {\n\t\t\t\tgetCapabilityEndpoints(url)\n\t\t\t\t\t.then( endpoints => resolve(endpoints) )\n\t\t\t\t\t.catch( err => reject( authEndpointErr ) )\n\t\t\t});\n\t});\n}\n\nfunction getWellKnownEndpoints(baseUrl) {\n\tconst url = baseUrl + \".well-known/smart-configuration\";\n\treturn fetch(url)\n\t\t.then( response => {\n\t\t\tif (!response.ok)\n\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.json() )\n\t\t.then( json => {\n\t\t\tlet endpoints = {\n\t\t\t\tregistrationEndpoint  : json.registration_endpoint,\n\t\t\t\tauthorizationEndpoint : json.authorization_endpoint,\n\t\t\t\ttokenEndpoint         : json.token_endpoint\n\t\t\t};\n\t\t\tif (!endpoints.authorizationEndpoint || !endpoints.tokenEndpoint) {\n\t\t\t\tthrow authEndpointErr;\n\t\t\t} else {\n\t\t\t\treturn endpoints;\t\t\n\t\t\t}\n\t\t})\n\t\t.catch( e => { throw authEndpointErr });\n}\n\nfunction getCapabilityEndpoints(baseUrl) {\n\tconst nsUri = \"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris\";\n\tconst url = baseUrl + \"metadata\";\n\n\treturn fhir.fetchFHIR(url)\n\t\t.then( json => {\n\t\t\tconst extensions = (getPath(json || {}, \"rest.0.security.extension\") || [])\n\t\t\t\t.filter(e => e.url === nsUri)\n\t\t\t\t.map(o => o.extension)[0];\n\n\t\t\tlet endpoints = {};\n\t\t\tif (extensions) {\n\t\t\t\textensions.forEach(ext => {\n\t\t\t\t\tif (ext.url === \"register\")\n\t\t\t\t\t\tendpoints.registrationEndpoint = ext.valueUri;\n\t\t\t\t\tif (ext.url === \"authorize\")\n\t\t\t\t\t\tendpoints.authorizationEndpoint = ext.valueUri;\n\t\t\t\t\tif (ext.url === \"token\")\n\t\t\t\t\t\tendpoints.tokenEndpoint = ext.valueUri;\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!endpoints.authorizationEndpoint || !endpoints.tokenEndpoint) {\n\t\t\t\tthrow authEndpointErr;\n\t\t\t} else{\n\t\t\t\treturn endpoints;\t\t\n\t\t\t}\n\t\t})\n\t\t.catch( e => { throw authEndpointErr });\n}\n\nfunction generateStateParam(targetLen=32) {\n\tconst charSet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\tlet result = [];\n\twhile (targetLen--)\n\t\tresult.push(charSet.charAt(Math.floor(Math.random() * charSet.length)));\n\treturn result.join(\"\");\n}\n\nfunction buildAuthorizeUrl(authEndpoint, fhirEndpoint, state, scope, redirectUri, clientId, clientSecret, launch) {\n\tif (Array.isArray(scope)) scope = scope.join(\" \");\n\n\tlet params = [\n\t\t\"response_type=code\",\n\t\t\"client_id=\"    + encodeURIComponent(clientId),\n\t\t\"scope=\"        + encodeURIComponent(scope),\n\t\t\"redirect_uri=\" + encodeURIComponent(redirectUri),\n\t\t\"aud=\"          + encodeURIComponent(fhirEndpoint),\n\t\t\"state=\"        + state\n\t];\n\n\tif (launch) \n\t\tparams.push(\"launch=\" + encodeURIComponent(launch));\n\tif (clientSecret) \n\t\tparams.push(\"client_secret=\" + encodeURIComponent(clientSecret));\n\n\treturn authEndpoint + \"?\" + params.join(\"&\");\n}\n\nfunction exchangeCodeForToken(tokenEndpoint, code, redirectUri, clientId, clientSecret) {\n\tlet config = {\n\t\tmethod: \"post\",\n\t\theaders:  {\"content-type\": \"application/x-www-form-urlencoded\"},\n\t\t// mode: \"cors\",\n\t\tbody: [\n\t\t\t\"grant_type=authorization_code\",\n\t\t\t\"code=\" + encodeURIComponent(code),\n\t\t\t\"redirect_uri=\" + encodeURIComponent(redirectUri)\n\t\t].join(\"&\")\n\t}\n\n\tif (clientSecret) {\n\t\tconfig.headers.Authorization = `Basic ${btoa(`${clientId}:${clientSecret}`)}`;\n\t} else {\n\t\tconfig.body += \"&client_id=\" + encodeURIComponent(clientId);\n\t}\n\n\treturn fetch(tokenEndpoint, config)\n\n}\n\nfunction refreshToken(tokenEndpoint, refreshToken) {\n\treturn fetch(tokenEndpoint, {\n\t\tmethod: \"post\",\n\t\theaders:  {\"content-type\": \"application/x-www-form-urlencoded\"},\n\t\tmode: \"cors\",\n\t\tbody: [\n\t\t\t\"grant_type=refresh_token\",\n\t\t\t\"refresh_token=\" + encodeURIComponent(refreshToken)\n\t\t].join(\"&\")\n\t})\n}\n\nfunction buildQs(fhirParams) {\n\treturn \"?\" + Object.keys(fhirParams).map( k => {\n\t\tconst value = Array.isArray(fhirParams[k]) ? fhirParams[k].join(\",\") : fhirParams[k];\n\t\treturn k + \"=\" + encodeURIComponent(value);\n\t}).join(\"&\");\n}\n\nexport default {\n\tgetWellKnownEndpoints, getCapabilityEndpoints, getAuthEndpoints, buildQs,\n\tbuildAuthorizeUrl, exchangeCodeForToken, refreshToken, generateStateParam\n}","import SMART from \"./smart-core\";\n\nexport default class SmartPopup {\n\n\tconstructor(provider) {\n\t\tthis.provider = provider;\n\t\tthis.authWindow = window.open('', '_blank');\n\t\tthis.authWindow.document.write('Loading...');\n\t}\n\n\tparseQs(qs) {\n\t\tconst pairs = qs.split('&');\n\t\tlet result = {};\n\t\tpairs.forEach( pair => {\n\t\t\tpair = pair.split('=');\n\t\t\tresult[pair[0]] = decodeURIComponent(pair[1]||\"\");\n\t\t});\n\t\treturn result;\n\t}\n\n\tcancel() {\n\t\tif (this.reject) {\n\t\t\tclearInterval(this.popupPoll);\n\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\tthis.authWindow.close();\n\t\t\tthis.reject(new Error(\"cancelled\"))\n\t\t}\n\t}\n\n\tauthorize(authEndpoints, ignoreState) {\t\n\t\treturn new Promise( (resolve, reject) => {\n\t\t\tthis.reject = reject;\n\t\t\tconst stateParam = SMART.generateStateParam();\n\n\t\t\tthis.popupPoll = setInterval( () => {   \n\t\t\t\tif (this.authWindow.closed) {\n\t\t\t\t\tclearInterval(this.popupPoll);\n\t\t\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\t\t\treject(new Error(\"Login window closed by user\"));\n\t\t\t\t}\n\t\t\t}, 500); \n\t\n\n\t\t\tconst receiveMessage = (event) => {\n\t\t\t\tif (event.origin !== window.location.origin) return;\n\t\t\t\t//block react dev tools messages\n\t\t\t\tif (typeof event.data !== \"string\") return;\n\t\t\t\tclearInterval(this.popupPoll);\n\t\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\t\tthis.authWindow.close();\n\n\t\t\t\tconst data = this.parseQs(event.data);\n\n\t\t\t\tif (data.error) {\n\t\t\t\t\treject(data.error);\n\t\t\t\t} else if (data.code && ignoreState !== true && data.state !== stateParam) {\n\t\t\t\t\treject(\"Invalid state parameter returned by server\");\n\t\t\t\t} else if (data.code) {\n\t\t\t\t\tSMART.exchangeCodeForToken(\n\t\t\t\t\t\tauthEndpoints.tokenEndpoint,\n\t\t\t\t\t\tdata.code,\n\t\t\t\t\t\tthis.provider.redirectUri,\n\t\t\t\t\t\tthis.provider.clientId,\n\t\t\t\t\t\tthis.provider.clientSecret\n\t\t\t\t\t)\n\t\t\t\t\t.then( data => data.json() )\n\t\t\t\t\t.then( data => {\n\t\t\t\t\t\tif (data.access_token) {\n\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t\t\treject(\"No access token in server token response\");\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\treject(\"Failed to retrieve code parameter\");\n\t\t\t\t}\n\t\t\t};\n\t\t\n\t\t\tconst url = SMART.buildAuthorizeUrl(\n\t\t\t\tauthEndpoints.authorizationEndpoint,\n\t\t\t\tthis.provider.fhirEndpoint,\n\t\t\t\tstateParam,\n\t\t\t\tthis.provider.scope,\n\t\t\t\tthis.provider.redirectUri,\n\t\t\t\tthis.provider.clientId\n\t\t\t);\n\n\t\t\tthis.messageListener = \n\t\t\t\twindow.addEventListener(\"message\", receiveMessage, false);\n\t\t\t\n\t\t\tthis.authWindow.location.href = url;\n\t\t});\n\t}\n\n}","import tv4 from \"tv4\";\nimport  matchUrl from 'match-url-wildcard';\nimport configSchema from \"../schemas/upload-manifest-schema.json\";\nimport _ from \"lodash\";\n\nexport default class FileExporter {\n\n\tcancel() {\n\t\tthis.controller.abort();\n\t}\n\n\tresetCancelled() {\n\t\tthis.controller = new AbortController();\n\t\tthis.signal = this.controller.signal;\n\t}\n\n\tisValidUrl(url, whitelist) {\n\t\treturn _.find(whitelist, rule => matchUrl(url, rule)) !== undefined;\n\t}\n\n\tgetManifest(url) {\n\t\tthis.resetCancelled();\n\t\tconst config = {\n\t\t\tsignal: this.signal,\n\t\t\taccept: \"application/json\"\n\t\t}\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.then( data => data.json() )\n\t\t\t.then( data => {\n\t\t\t\ttv4.validate(data, configSchema);\n\t\t\t\tif (tv4.error) {\n\t\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\t\tthrow new Error(url + \": \" + tv4.error.message);\n\t\t\t\t}\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\t\n\tputFile(url, file) {\n\t\tthis.resetCancelled()\n\t\tconst config = {\n\t\t\tsignal: this.signal,\n\t\t\tmethod: \"PUT\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/octet-stream\"\n\t\t\t},\n\t\t\tbody: file\n\t\t}\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.then( response => {\n\t\t\t\tconst contentType = response.headers.get(\"content-type\");\n\t\t\t\tif (contentType && contentType.indexOf(\"application/json\") !== -1) {\n\t\t\t\t\treturn response.json();\n\t\t\t\t} else {\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (data.error) throw new Error(data.error);\n\t\t\t})\n\t\t\t.catch( error => {\t\n\t\t\t\tconsole.log(error);\n\t\t\t\tif (error.name === \"AbortError\") {\n\t\t\t\t\tthrow(error);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`An error occurred sending your data: ${error.message}`);\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\n}","import _ from \"lodash\";\n\n//matching object keys merge properties\n//if key has an underscore, then object is replaced\n//arrays items merge by id, appending otherwise\n//array items with an underscore property replace all properties\n//objects item with an underscore property are deleted\nfunction merge(templates) {\n\n\tconst mergeArray = (base, override) => {\n\t\t_.each(override, overrideItem => {\n\t\t\tconst baseIndex = overrideItem.id \n\t\t\t\t? _.findIndex(base, b => b.id === overrideItem.id) \n\t\t\t\t: -1;\n\t\t\tif (overrideItem._) {\n\t\t\t\tif (baseIndex > -1) base.splice(baseIndex, 1); \n\t\t\t} else if (baseIndex > -1) {\n\t\t\t\tbase[baseIndex] = mergeObject(base[baseIndex], overrideItem);\n\t\t\t} else {\n\t\t\t\tbase.push(overrideItem)\n\t\t\t}\n\t\t});\n\t\treturn base;\n\t}\n\n\tconst mergeObject = (base, override) => {\n\t\t_.each( _.keys(override), key => {\n\t\t\tif (key[0] === \"_\") {\n\t\t\t\tbase[key.slice(1)] = override[key];\n\t\t\t} else if (base[key] === undefined) {\n\t\t\t\tbase[key] = override[key];\n\t\t\t} else if (_.isPlainObject(override[key]) && override[key]._) {\n\t\t\t\tdelete base[key];\n\t\t\t} else if (_.isPlainObject(override[key])) {\n\t\t\t\tbase[key] = mergeObject(base[key], override[key]);\n\t\t\t} else if (_.isArray(base[key]) && _.isArray(override[key])) {\n\t\t\t\tbase[key] = mergeArray(base[key], override[key]);\n\t\t\t} else {\n\t\t\t\tbase[key] = override[key];\n\t\t\t}\n\t\t})\n\t\treturn base;\n\t}\n\n\tlet base = JSON.parse(JSON.stringify(templates[0]));\n\t_.each( templates, (template, i) => {\n\t\tif (i === 0) return;\n\t\ttemplate = JSON.parse(JSON.stringify(template));\n\t\tif (_.isPlainObject(base) && _.isPlainObject(template)) {\n\t\t\tbase = mergeObject(base, template)\n\t\t} else if (_.isArray(base) && _.isArray(template)) {\n\t\t\tbase = mergeArray(base, template);\n\t\t} else {\n\t\t\tbase = template;\n\t\t}\n\t})\n\treturn base;\n\n}\n\nexport default { merge };","import fetch from \"cross-fetch\";\nimport stripJsonComments from \"strip-json-comments\";\nimport tv4 from \"tv4\";\nimport endpointListSchema from \"../schemas/endpoint-list-schema.json\";\nimport configSchema from \"../schemas/config-schema.json\";\nimport FileExporter from \"./file-exporter\";\nimport _ from \"lodash\";\nimport mergeObjects from \"./merge-objects.js\";\n\nfunction getUrlParameter(name) {\n    name = name.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\");\n    var results = regex.exec(window.location.search);\n    return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\nfunction overlayQsValues(config) {\n\tconst manifestUrl = getUrlParameter(\"upload_manifest_url\");\n\tif (manifestUrl) {\n\t\tconfig.upload = config.upload || {};\n\t\tconfig.upload.manifestUrl = manifestUrl;\n\t\tconfig.upload.qsManifestUrl = true;\n\t}\n\tconst label = getUrlParameter(\"upload_label\");\n\tif (label) {\n\t\tconfig.upload = config.upload || {};\n\t\tconfig.upload.label = label;\n\t}\n\tconst wizard = getUrlParameter(\"wizard\");\n\tif (wizard) config.showWizard = true;\n\treturn config;\n}\n\n\nfunction readConfigFile(path, isOverride) {\n\treturn fetch(path, { headers: {'Accept': 'application/json'} })\n\t\t.then( response => {\n\t\t\tif (!response.ok && !isOverride)\n\t\t\t\tthrow new Error(`${path} - HTTP ${response.status} - ${response.statusText}`);\t\t\t\t\n\t\t\t\n\t\t\tif (!response.ok && isOverride)\n\t\t\t\tresponse = { text: () => \"{}\" };\n\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.text() )\n\t\t.then( data => {\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(stripJsonComments(data));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tthrow new Error(`${path} is not valid JSON.`);\n\t\t\t}\n\t\t})\n\n}\n\nfunction loadConfigFile(path, overridePath, allowQsOverride) {\n\tlet configReaders = [readConfigFile(path)];\n\tconst qsOverridePath = getUrlParameter(\"config\");\n\n\tif (qsOverridePath && allowQsOverride) {\n\t\tconfigReaders.push(readConfigFile(qsOverridePath, true));\n\t} else if (overridePath) {\n\t\tconfigReaders.push(readConfigFile(overridePath, true));\n\t}\n\n\treturn Promise.all(configReaders)\n\t\t.then( data => mergeObjects.merge(data) )\n\t\t.then( data => {\n\t\t\ttv4.validate(data, configSchema);\n\t\t\tif (tv4.error) {\n\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\tthrow new Error(path + \": \" + tv4.error.message);\n\t\t\t}\n\t\t\treturn data;\n\t\t})\n\t\t//check for invalid queryProfile name and credential references (can't do this in json schema v4)\n\t\t.then( config => {\n\t\t\tif (!config.endpointLists) return config;\n\t\t\t\n\t\t\tconst invalidEndpointId = _.find( _.keys(config.endpointLists) || [], id => {\n\t\t\t\tconst v = config.endpointLists[id];\n\t\t\t\treturn (\n\t\t\t\t\tv && v.defaults && v.defaults.queryProfile && \n\t\t\t\t\t!config.queryProfiles[v.defaults.queryProfile]\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tif (invalidEndpointId) throw new Error(\n\t\t\t\t\"Invalid query profile in endpoint \" + \n\t\t\t\tpath + \": /endpointLists/\" + invalidEndpointId + \"/defaults\"\n\t\t\t);\n\n\t\t\tconst invalidCredentialId = _.find( _.keys(config.endpointLists) || [], id => {\n\t\t\t\tconst v = config.endpointLists[id];\n\t\t\t\treturn (\n\t\t\t\t\tv && v.defaults && v.defaults.credentialId && \n\t\t\t\t\t!config.credentials[v.defaults.credentialId]\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tif (invalidCredentialId) throw new Error(\n\t\t\t\t\"Invalid credential id in endpoint \" + \n\t\t\t\tpath + \": /endpointLists/\" + invalidCredentialId + \"/defaults\"\n\t\t\t);\n\n\t\t\treturn config;\n\t\t})\n\t\t//check for invalid template name references (can't do this in json schema v4)\n\t\t.then( config => {\n\t\t\tif (!config.spreadsheetTemplates) return config;\n\n\t\t\tconst templateNames = Object.keys(config.spreadsheetTemplates);\n\t\t\ttemplateNames.forEach( templateName => {\n\t\t\t\tconst baseTemplates = config.spreadsheetTemplates[templateName].extends || [];\n\t\t\t\tbaseTemplates.forEach( baseTemplateName => {\n\t\t\t\t\tif (templateNames.indexOf(baseTemplateName) === -1)\n\t\t\t\t\t\tthrow new Error(\"Invalid base template name in '\" + templateName + \"'\");\n\t\t\t\t})\n\t\t\t})\n\t\t\treturn config;\n\t\t})\n\t\t.then( config => {\n\t\t\tif (!config.endpointLists) return config;\n\t\t\treturn loadEndpointLists(config);\n\t\t})\n\t\t.then( config => {\n\t\t\tconfig.redirectUri = config.redirectUri || \n\t\t\t\twindow.location.href.split(/\\?|#/)[0].replace(/\\/*$/, \"/callback.html\");\n\t\t\treturn config;\n\t\t})\n\t\t.then( config => {\n\t\t\treturn overlayQsValues(config);\n\t\t})\n\t\t//preload manifest if in wizard mode.\n\t\t//manifest is loaded on-demand when in full mode so as not to display \n\t\t//unnecessary errors to the user if it fails to load.\n\t\t.then( config => {\n\n\t\t\tif (!config.showWizard || (config.upload && !config.upload.manifestUrl)) \n\t\t\t\treturn config;\n\t\t\t\n\t\t\tif (!config.upload || (!config.upload.manifestUrl && !config.upload.uploadUrl))\n\t\t\t\tthrow new Error(\"Upload configuration required for wizard mode\");\n\t\t\t\n\t\t\tconst fileExporter = new FileExporter();\n\t\t\tif (config.upload.qsManifestUrl) {\n\t\t\t\tconst isValidUrl = fileExporter.isValidUrl(config.upload.manifestUrl, config.upload.whitelist);\n\t\t\t\tif (!isValidUrl) \n\t\t\t\t\tthrow new Error(\"Url manifest location not in whitelist: \" + config.upload.manifestUrl);\n\t\t\t}\n\n\t\t\treturn fileExporter.getManifest(config.upload.manifestUrl)\n\t\t\t\t.then( manifest => {\n\t\t\t\t\tconfig.upload = {...config.upload, ...manifest}\n\t\t\t\t\treturn config;\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\tthrow new Error(\"Unable to load manifest at \" + config.upload.manifestUrl);\n\t\t\t\t});\n\t\n\n\t\t})\n\t\t// .then( config => {\n\t\t// \tconsole.log(config);\n\t\t// \treturn config;\n\t\t// })\n\n}\n\nfunction loadEndpointLists(config) {\n\n\tconst getEndpointList = (endpointList, id) => {\n\t\tif (!endpointList.path) return;\n\n\t\treturn fetch(endpointList.path, { headers: {'Accept': 'application/json'} })\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`${endpointList.path} - HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\t\t\n\t\t\t.then( data => data.text() )\n\t\t\t.then( data => {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(stripJsonComments(data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\tthrow new Error(`${endpointList.path} is not valid JSON.`);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\ttv4.validate(data, endpointListSchema);\n\t\t\t\tif (tv4.error) {\n\t\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\t\tthrow new Error(endpointList.path + \": \" + tv4.error.message);\n\t\t\t\t}\n\t\t\t\treturn data;\n\t\t\t})\n\n\t\t\t//check for invalid queryProfile name references and credential ids(can't do this in json schema)\n\t\t\t.then( data => {\n\n\t\t\t\t(data.entry || data.Entries || []).forEach( endpoint => {\n\t\t\t\t\tif (endpoint.queryProfile && !config.queryProfiles[endpoint.queryProfile]\n\t\t\t\t\t) throw new Error(\n\t\t\t\t\t\t\"Invalid query profile in endpoint list \" + \n\t\t\t\t\t\tendpointList.path + \" - \" + endpoint.queryProfile\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\t(data.entry || data.Entries || []).forEach( endpoint => {\n\t\t\t\t\tif (endpoint.credentialId && !config.credentials[endpoint.credentialId]\n\t\t\t\t\t) throw new Error(\n\t\t\t\t\t\t\"Invalid credential id endpoint list \" + \n\t\t\t\t\t\tendpointList.path + \" - \" + endpoint.credentialId\n\t\t\t\t\t);\n\t\t\t\t})\n\n\t\t\t\treturn data; \n\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tconst result = (data.Entries || data.entry).map( entry => {\n\t\t\t\t\tlet newEntry = {...entry}\n\t\t\t\t\t//standardize epic format\n\t\t\t\t\tif (newEntry.OrganizationName) {\n\t\t\t\t\t\tnewEntry.name = newEntry.OrganizationName;\n\t\t\t\t\t\tdelete newEntry.OrganizationName;\n\t\t\t\t\t}\n\t\t\t\t\tif (newEntry.FHIRPatientFacingURI) {\n\t\t\t\t\t\tnewEntry.fhirEndpoint = newEntry.FHIRPatientFacingURI;\n\t\t\t\t\t\tdelete newEntry.FHIRPatientFacingURI;\n\t\t\t\t\t}\n\t\t\t\t\tif (newEntry.id) {\n\t\t\t\t\t\tnewEntry.orgId = newEntry.id;\n\t\t\t\t\t\tdelete newEntry.id;\n\t\t\t\t\t}\n\t\t\t\t\t//add defaults group name\n\t\t\t\t\tif (endpointList.defaults)\n\t\t\t\t\t\tnewEntry.defaultId = id;\n\t\t\t\t\treturn newEntry;\n\t\t\t\t});\n\t\t\t\treturn result\n\t\t\t})\n\t\t\t.catch( e => { \n\t\t\t\tif (e.message) throw e;\n\t\t\t\tthrow new Error(\"Error reading \" + endpointList.path)\n\t\t\t})\n\t}\n\n\treturn Promise.all(\n\t\t_.map( config.endpointLists, (l,id) => getEndpointList(l,id) )\n\t)\n\t\t.then( data => {\n\t\t\tconst organizations = [].concat.apply([], data);\n\t\t\tconst orgDefaults = _.mapValues( config.endpointLists, v => v.defaults );\n\t\t\treturn {...config, orgDefaults, organizations, endpointLists: null}\n\t\t});\n}\n\nexport default { loadConfigFile }","import sanitizeFilename from \"sanitize-filename\";\nimport _ from \"lodash\";\nimport jszip from \"jszip\";\nimport { saveAs } from \"file-saver\";\n\nfunction addProviderToZip(zipFolder, provider) {\n\t\n\t// console.log(JSON.stringify(provider.data))\n\t\n\tconst bundles = _.chain(provider.data.entry)\n\t\t.groupBy(e => e.resource.resourceType)\n\t\t.mapValues(entry => {\n\t\t\treturn {\n\t\t\t\tentry: _.map(entry, e => ({fullUrl: e.fullUrl, resource: e.resource}) ),\n\t\t\t\ttotal: entry.length, \n\t\t\t\ttype:\"collection\"\n\t\t\t}\n\t\t}).value();\n\t_.each(bundles, (bundle, resourceType) => {\n\t\tzipFolder.file(resourceType+\".json\", JSON.stringify(bundle, null, 2)) \n\t});\n\t_.each(provider.data.files, f => {\n\t\tzipFolder.file(f.fileName, f.blob, {type: \"blob\"});\n\t});\n\tif (provider.data.errorLog.length)\n\t\tzipFolder.file(\"error_log.json\", JSON.stringify(provider.data.errorLog, null, 2));\n}\n\nfunction exportProvider(provider) {\n\treturn new Promise( (resolve, reject) => {\n\t\tconst zip = new jszip();\n\t\taddProviderToZip(zip, provider);\n\t\tconst fileName = sanitizeFilename(provider.name);\n\t\tzip.generateAsync({type: \"blob\"})\n\t\t\t.then( blob => saveAs(blob, fileName) )\n\t\t\t.then( resolve )\n\t\t\t.catch( reject );\n\t});\n}\n\nfunction exportProviders(providers, fileName=\"procure-data.zip\") {\n\treturn exportProvidersAsBlob(providers)\n\t\t.then( blob => saveAs(blob, fileName) );\n}\n\nfunction exportProvidersAsBlob(providers) {\n\treturn new Promise( (resolve, reject) => {\n\t\tconst zip = new jszip();\n\t\tproviders.filter( p => p.data && p.selected).forEach( provider => {\n\t\t\tconst folder = zip.folder( sanitizeFilename(provider.name) );\n\t\t\taddProviderToZip(folder, provider);\n\t\t});\n\t\tzip.generateAsync({type: \"blob\"})\n\t\t\t.then( resolve )\n\t\t\t.catch( reject );\n\t});\n}\n\nfunction generateFile(providers, multiProviderFileName) {\n\tconst exportableProviders = _.filter(providers, p => {\n\t\treturn p.data && p.data.entry && p.selected && (p.data.entry.length || p.data.errorLog.length)\n\t});\n\tif (exportableProviders.length > 1) {\n\t\treturn exportProviders(exportableProviders, multiProviderFileName);\n\t} else {\n\t\treturn exportProvider(exportableProviders[0]);\n\t}\n}\n\nexport default { generateFile, exportProvidersAsBlob }","const defaultBaseUrl = \"https://api.github.com\";\n\nfunction callApi(config, path, method=\"GET\", jsonPayload) {\n\tconst reqConfig = {\n\t\theaders: {\"Authorization\": `Bearer ${config.token}`},\n\t\tmethod\n\t}\n\tif (jsonPayload) reqConfig.body = JSON.stringify(jsonPayload);\n\t\n\tconst url = `${config.baseUrl||defaultBaseUrl}/repos/${config.owner}/${config.project}/${path}`\n\treturn fetch(url, reqConfig).then( response => {\n\t\tif (response.ok) {\n\t\t\treturn response.json();\n\t\t} else if (response.status === 404) {\n\t\t\tthrow new Error(\"Repository not found\");\n\t\t} else if (response.stats === 500) {\n\t\t\tthrow new Error(response.message || \"Github API returned a 500 error\");\n\t\t} else {\n\t\t\treturn response.json().then( (json) => {\n\t\t\t\tthrow new Error(json.message);\n\t\t\t});\n\t\t}\n\t})\n}\n\nfunction getLastCommit(config, branchName=\"master\") {\n\treturn callApi(config, `git/refs/heads/${branchName}`)\n\t\t//special handling for uninitialized repository (repo without any files)\n\t\t.catch( e => {\n\t\t\tif (e.message === \"Git Repository is empty.\")\n\t\t\t\te.message = \"Git repository is empty. Please initialize the repository and try again.\"\n\t\t\tthrow e;\n\t\t});\n}\n\nfunction getTree(config, commit) {\n\treturn callApi(config, `git/trees/${commit.object.sha}`)\n\t\t.then( tree => {\n\t\t\tif (tree.truncated)\n\t\t\t\tthrow new Error(\"Unable to load entire head tree - too many files\");\n\t\t\treturn tree;\n\t\t})\n\t\t//handle 404 for when tree has been deleted and repo is empty\n\t\t.catch( e => {\n\t\t\tif (e.message === \"Repository not found\") {\n\t\t\t\treturn {tree: []}\n\t\t\t}\n\t\t})\n}\n\nfunction createBlob(config, blob) {\n\treturn callApi(config, \"git/blobs\", \"POST\", blob)\n}\n\nfunction createTree(config, tree) {\n\treturn callApi(config, \"git/trees\", \"POST\", tree);\n}\n\nfunction commitTree(config, tree, message, lastCommit, branchName=\"master\") {\n\t\treturn callApi(config, \"git/commits\", \"POST\", {\n\t\t\tmessage,\n\t\t\ttree: tree.sha,\n\t\t\tparents: [lastCommit.object.sha]\n\t\t}).then( commit => {\n\t\t\treturn callApi(config, `git/refs/heads/${branchName}`,\"PATCH\", {\n\t\t\t\tsha: commit.sha\n\t\t\t})\n\t\t})\n\t}\n\nfunction commitTreeToPullRequest(config, tree, message, lastCommit, title, newBranchName,  baseBranch=\"master\", bodyText) {\n\treturn callApi(config, \"git/commits\", \"POST\", {\n\t\tmessage,\n\t\ttree: tree.sha,\n\t\tparents: [lastCommit.object.sha]\n\t}).then( commit => {\n\t\treturn callApi(config, \"git/refs\", \"POST\", {\n\t\t\tref: `refs/heads/${newBranchName}`,\n\t\t\tsha: commit.sha\n\t\t});\n\t}).then( () => {\n\t\treturn callApi(config, \"pulls\", \"POST\", {\n\t\t\ttitle: title,\n\t\t\tbody: bodyText,\n\t\t\thead: newBranchName,\n\t\t\tbase: baseBranch,\n\t\t\tmaintainer_can_modify: true\n\t\t})\n\t})\n}\n\nexport default {\n\tgetLastCommit, getTree, createBlob, \n\tcreateTree, commitTree, commitTreeToPullRequest\n}","import _ from \"lodash\";\nimport XlsxPopulate from \"xlsx-populate\";\nimport saveAs from \"file-saver\";\nimport sanitizeFilename from \"sanitize-filename\";\nimport mergeObjects from \"./merge-objects.js\";\nimport csvWriter from \"./csv-writer\";\n\nconst defaultHelperFns = {\n\tvalidateExists: v => {\n\t\treturn v !== undefined\n\t},\n\tvalidateCode: (v, template) => {\n\t\tif (!v) return false;\n\t\tif (!Array.isArray(v)) v = [v];\n\t\treturn v.find( c => c.code === template.target ) ? true : false;\n\t},\n\tvalidateValue: (v, template) => {\n\t\treturn v === template.target;\n\t},\n\tgetHelperData: (v, template, helperData) => {\n\t\treturn helperData[template.helperDataField];\n\t},\n\tstringifyCodings: v => {\n\t\tif (!v) return v;\n\t\tif (!Array.isArray(v)) v = [v];\n\t\treturn v\n\t\t\t.map( c => c.system + \"|\" + c.code )\n\t\t\t.join(\" \");\n\t},\n\tparseDateForExcel:  (v, template, helperData) => {\n\t\treturn (v && helperData.format !== \"csv\")\n\t\t\t? new Date(v) \n\t\t\t: v;\n\t}\n}\n\nfunction flatten(element, template, helperData={}, helperFns) {\n\thelperFns = helperFns || defaultHelperFns;\n\tlet rows = [];\n\t_.each(template, field => {\n\n\t\tconst mergeRows = (rowsToMerge) => {\n\t\t\tif (rows.length === 0) rows = [{}];\n\t\t\tlet newRows = [];\n\t\t\t_.each(rowsToMerge, mergeRow => {\n\t\t\t\tif (!_.isArray(mergeRow)) mergeRow = [mergeRow];\n\t\t\t\t_.each(mergeRow, mergeRowItem => {\n\t\t\t\t\t_.each(rows, row => {\n\t\t\t\t\t\tnewRows.push({ ...row, ...mergeRowItem});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\trows = newRows;\n\t\t}\n\n\t\tif (!_.isArray(field.path))\n\t\t\tfield.path = [field.path];\n\n\t\tlet data = _.chain(element)\n\t\t\t.at(element, field.path)\n\t\t\t.filter( v => v !== undefined )\n\t\t\t.first().value();\n\n\t\t//allow a fallback path. Note: this will always be evaluated last regardless of array position\n\t\tif (!data && field.path.indexOf(\"*\") > -1) \n\t\t\tdata = element;\n\n\t\tif (field.transform)\n\t\t\tdata = helperFns[field.transform](data, field, helperData);\n\n\t\tconst valid = \n\t\t\tfield.test === undefined || helperFns[field.test](data, field, helperData);\n\n\t\t// console.log(valid, field, data)\n\n\t\tif (!valid) {\n\t\t\trows = null;\n\t\t\treturn false;\n\t\t} else if (field.children) {\n\t\t\tif (!_.isArray(data)) data = [data];\n\t\t\tconst childRows = _.map( data, childElement => {\n\t\t\t\treturn flatten(childElement, field.children, helperData, helperFns);\n\t\t\t});\n\t\t\t//check if all children were valid and bail if they weren't\n\t\t\tif (childRows.indexOf(null) > -1) {\n\t\t\t\trows = null;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tmergeRows(childRows);\n\t\t\t}\n\t\t} else if (field.name) {\n\t\t\tif (!_.isArray(data)) data = [data];\n\t\t\tconst rowsToMerge = data.map( item => ({[field.name]: item}) );\n\t\t\tmergeRows(rowsToMerge);\n\t\t}\n\t})\n\treturn rows;\n}\n\nfunction flattenProviders(providers, template, helperData={}, helperFns) {\n\treturn _.chain(providers)\n\t\t.filter( p => p.selected && p.data && p.data.entry && p.data.entry.length > 0)\n\t\t.map( p => {\n\t\t\treturn _.chain(p.data.entry).map( e => {\n\t\t\t\tconst providerHelperData = {...helperData, source: p.name};\n\t\t\t\treturn flatten(e.resource, template, providerHelperData, helperFns);\n\t\t\t}).flatten().value()\n\t\t})\n\t\t.flatten()\n\t\t.filter( f => f !== null )\n\t\t.value();\n}\n\nfunction getTemplateColumns(template) {\n\tlet cols = [];\n\tconst arrayToCols = templateArray => {\n\t\t_.each(templateArray, field => {\n\t\t\tif (field.name) cols.push(field.name);\n\t\t\tif (field.children) arrayToCols(field.children);\n\t\t});\n\t}\n\tarrayToCols(template || template.template);\n\treturn cols;\n}\n\n// JS Excel libraries with browser compatibility (others are node.js only)\n// https://github.com/SheetJS/js-xlsx (Apache2, very robust, support for .xls, formatting requires commercial license)\n// https://github.com/dtjohnson/xlsx-populate (MIT, good option)\n// https://github.com/exceljs/exceljs (MIT, good option, slightly more dependencies)\n// https://github.com/egeriis/zipcelx (MIT, very light weight, currently no date support)\n// https://en.wikipedia.org/wiki/Microsoft_Office_XML_formats#Excel_XML_Spreadsheet_example (Excel 2003, seems to not require zip)\n\nfunction exportFlatDataCSV(flatData, template, name) {\n\tconst columns = getTemplateColumns(template);\n\tconst data = flatData.map( row => {\n\t\treturn columns.map( col =>  row[col] );\n\t});\n\tconst blob = csvWriter([columns].concat(data));\n\treturn new Promise( (resolve) => {\n\t\tsaveAs(blob, sanitizeFilename(name) + \".csv\")\n\t\tresolve();\n\t})\n}\n\nfunction exportFlatDataExcel(flatData, template, name) {\n\tconst columns = getTemplateColumns(template);\n\tlet dateCols = [];\n\tconst data = flatData.map( row => {\n\t\treturn columns.map( (col, i) => {\n\t\t\tif (row[col] instanceof Date && dateCols.indexOf(i+1) === -1)\n\t\t\t\tdateCols.push(i+1);\n\t\t\treturn row[col] \n\t\t});\n\t});\n\n\treturn XlsxPopulate.fromBlankAsync()\n    \t.then( workbook => {\n\t\t\tworkbook.sheet(0).name(name)\n\t\t\t\t.cell(\"A1\").value(\n\t\t\t\t\t[columns].concat(data)\n\t\t\t\t)\n\t\t\tdateCols.forEach( dateCol => {\n\t\t\t\tworkbook.sheet(0).column(dateCol)\n\t\t\t\t\t.style(\"numberFormat\", \"dddd, mmmm dd, yyyy\");\n\t\t\t});\n\t\t\treturn workbook.outputAsync()\n\t\t})\n\t\t.then( blob => {\n\t\t\tsaveAs(blob, sanitizeFilename(name) + \".xlsx\");\n\t\t});\n}\n\nfunction exportSpreadsheet(providers, spreadsheetTemplates, templateId, format) {\n\tconst templateDefinition = spreadsheetTemplates[templateId];\n\n\tconst templateDefinitions = _.map( (templateDefinition.extends||[]),\n\t\tid => spreadsheetTemplates[id]\n\t).concat([templateDefinition]);\n\n\tconst mergedTemplateDefinition = mergeObjects.merge(templateDefinitions);\t\n\tlet flatData = flattenProviders(providers, mergedTemplateDefinition.template, { format });\n\n\tif (mergedTemplateDefinition.sortBy) {\n\t\tconst sortBy = _.map(mergedTemplateDefinition.sortBy, s => s.name);\n\t\tconst sortDir = _.map(mergedTemplateDefinition.sortBy, s => s.dir || \"desc\");\n\t\tflatData = _.orderBy(flatData, sortBy, sortDir);\n\t}\n\tif (format === \"xlsx\") {\n\t\treturn exportFlatDataExcel(flatData, mergedTemplateDefinition.template, mergedTemplateDefinition.name)\n\t} else {\n\t\treturn exportFlatDataCSV(flatData, mergedTemplateDefinition.template, mergedTemplateDefinition.name)\n\t}\n}\n\n\nexport default { \n\tflatten, flattenProviders, \n\tdefaultHelperFns, exportSpreadsheet\n}","export default (rows) => {\n\tconst processRow = (row) => {\n\t\treturn row.map( rawValue => {\n\t\t\tlet value = rawValue === null ? \"\" : rawValue.toString();\n\t\t\tif (rawValue instanceof Date)\n\t\t\t\tvalue = rawValue.toLocaleString();\n\t\t\tvalue = value.replace(/\"/g, '\"\"');\n\t\t\tif (value.search(/(\"|,|\\n)/g) >= 0)\n\t\t\t\tvalue = '\"' + value + '\"';\n\t\t\treturn value;\n\t\t}).join(\",\");\n\t};\n\n\tconst csv = rows.map(processRow).join(\"\\n\");\n\treturn new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n}","import _ from \"lodash\";\nimport saveAs from \"file-saver\";\nimport tv4 from \"tv4\";\nimport userSettingsSchema from \"../schemas/user-settings-schema.json\";\n\nfunction buildJSON(providers, githubConfig, redirectUri) {\n\tconst json = {\n\t\tproviders: _.map(providers, p => ({\n\t\t\t...p, lastUpdated: null, data: null\n\t\t}) ),\n\t\tgithubConfig, redirectUri\n\t};\n\treturn JSON.stringify(json, null, 2);\n\n}\n\nfunction download(providers, githubConfig, redirectUri, fileName=\"procure-settings.json\") {\n\tconst json = buildJSON(providers, githubConfig, redirectUri);\n\tconst blob = new Blob(\n\t\t[json], \n\t\t{type: \"application/json;charset=utf-8\"}\n\t);\n    saveAs(blob, fileName);\n}\n\nfunction readFromFile(file, redirectUri, queryProfiles) {\n\tconst reader = new FileReader();\n\treturn new Promise( (resolve, reject) => {\t\n\t\treader.onload = e => resolve(reader.result);\n\t\treader.onerror = e => reject(e);\n\t\treader.readAsText(file);\n\t})\n\t.then( data => {\n\t\ttry {\n\t\t\treturn JSON.parse(data);\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"Unable to read file\")\n\t\t}\n\t})\n\t.then( json => {\n\t\tif (json.redirectUri !== redirectUri)\n\t\t\tthrow new Error(\"Only settings saved from this website can be imported\")\n\t\treturn json;\n\n\t})\n\t.then( json => {\n\t\ttv4.validate(json, userSettingsSchema);\n\t\tif (tv4.error) {\n\t\t\tif (console) console.log(tv4.error);\n\t\t\tthrow new Error(\"Invalid file format: \" + tv4.error.message);\n\t\t}\n\t\treturn json;\n\n\t})\n\t.then( json => {\n\t\t_.each( json.providers, provider => {\n\t\t\tif (!queryProfiles[provider.queryProfile]) \n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Query profile not found: \" + provider.queryProfile\n\t\t\t\t);\n\t\t});\n\t\treturn json;\n\t})\n}\n\nexport default { \n\tbuildJSON, download, readFromFile \n}","import createStore from \"storeon\";\nimport FhirLoader from \"./fhir-loader\";\nimport ConfigLoader from \"./config-loader\";\nimport ZipExporter from \"./zip-exporter\";\nimport GithubExporter from \"./github-exporter\";\nimport SpreadsheetExporter from \"./spreadsheet-exporter\";\nimport UserSettings from \"./user-settings\";\nimport FileExporter from \"./file-exporter\";\nimport zipExporter from \"./zip-exporter\";\n\n//have to use require here since imports need to be at the top level\nlet initialState;\nif (process.env.NODE_ENV !== \"development\") {\n\tinitialState = require(\"./initial-state\");\n} else {\n\tinitialState =  require(\"./initial-state-dev\");\n}\n\nconst fhirLoader = new FhirLoader();\nconst ghExporter = new GithubExporter();\nconst fileExporter = new FileExporter();\nlet simulateTimer;\n\nconst createUniqueId = () => Math.random().toString(36);\nconst actions = store => {\n\tstore.on(\"@init\", () => initialState);\n\tstore.on(\"uiState/set\", (state, uiState) => { \n\t\treturn { uiState }\n\t});\n\tstore.on(\"uiState/merge\", ({ uiState }, newUiState) => {\n\t\treturn {uiState: {...uiState, ...newUiState}}\n\t})\n\tstore.on(\"uiState/incrementCounts\", ({ uiState }, counts) => {\n\t\tObject.keys(counts).forEach( countType => {\n\t\t\tcounts[countType] = counts[countType] + (uiState[countType] || 0)\n\t\t});\t\n\t\treturn {uiState: {...uiState, ...counts}}\n\t})\n\tstore.on(\"wizard/hide\", () => {\n\t\treturn {showWizard: false, uiState: {mode: \"ready\"}}\n\t})\n\tstore.on(\"nonModalUi/merge\", ({ nonModalUi }, newState) => {\n\t\treturn {nonModalUi: {...(nonModalUi ||{}), ...newState}}\n\t});\n\tstore.on(\"refreshDirty\", ({ providers, githubConfig, redirectUri, dirtySnapshot }, reset) => {\n\t\tconst newSnapshot = UserSettings.buildJSON(providers, githubConfig, redirectUri);\n\t\tif (reset) {\n\t\t\treturn {isDirty: false, dirtySnapshot: newSnapshot};\n\t\t} else {\n\t\t\treturn {isDirty: dirtySnapshot === newSnapshot ? false : true};\n\t\t}\n\t})\n\tstore.on(\"providers/add\", ({ providers }, provider) => {\n\t\tif (!provider.id) provider.id = createUniqueId();\n\t\tprovider.selected = true;\n\t\tconsole.log(provider)\n\t\treturn {providers: providers.concat([provider])}\n\t});\n\tstore.on(\"providers/update\", ({ providers }, provider) => {\n\t\treturn {\n\t\t\tproviders: providers.map( p => {\n\t\t\t\treturn (p.id !== provider.id) \n\t\t\t\t\t? p \n\t\t\t\t\t: {...p, ...provider}\n\t\t\t})\n\t\t}\n\t});\n\tstore.on(\"providers/upsert\", (state, provider) => {\n\t\tif (!provider.id) {\n\t\t\tprovider.id = createUniqueId();\n\t\t\tstore.dispatch(\"providers/add\", provider);\n\t\t} else {\n\t\t\tstore.dispatch(\"providers/update\", provider);\n\t\t}\n\t});\n\tstore.on(\"providers/upsertAndLoad\", (state, provider) => {\n\t\tstore.dispatch(\"providers/upsert\", provider);\n\t\tstore.dispatch(\"fhir/loadData\", provider.id);\n\t});\n\tstore.on(\"providers/remove\", ({ providers }, id) => {\n\t\treturn {\n\t\t\tproviders: providers.filter( p => {\n\t\t\t\treturn p.id !== id\n\t\t\t})\n\t\t}\n\t});\n\tstore.on(\"config/load\", (state, endState=\"ready\") => {\n\t\tstore.dispatch(\"uiState/set\", {mode: \"loading\"});\n\t\tconst isDev = process.env.NODE_ENV === \"development\";\n\t\tconst overridePath = isDev\n\t\t\t? \"./config/config-override-dev.json\" \n\t\t\t: \"./config/config-override.json\";\n\n\t\tConfigLoader\n\t\t\t.loadConfigFile(\"./config/config.json\", overridePath, isDev)\n\t\t\t.then( config => {\n\t\t\t\tstore.dispatch(\"config/merge\", config);\n\n\t\t\t\tstore.dispatch(\"uiState/set\", {mode: endState});\n\n\t\t\t\t//initialize content for refresh\n\t\t\t\tstore.dispatch(\"refreshDirty\", true);\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"globalError\", \n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t})\n\t});\n\tstore.on(\"config/merge\", (state, newConfig) => {\n\t\treturn {...state, ...newConfig}\n\t});\n\tstore.on(\"fhir/loadData\", ({ providers, queryProfiles, mimeTypeMappings, ignoreState }, providerId) => {\n\t\tconst provider = providers.find(p => p.id === providerId);\n\t\tconst queryProfile = queryProfiles[provider.queryProfile];\n\t\tconst retryLimit = queryProfiles[provider.queryProfile].retryLimit || 0;\n\t\t\n\t\tconst handleLoadDone = (data) => {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"loaded\",\n\t\t\t\tdata: data,\n\t\t\t\tid: provider.id\n\t\t\t});\n\t\t}\n\n\t\tconst handleStatusUpdate = (url, isError) => {\n\t\t\tif (console) console.log(\"Fetching: \", url);\n\t\t\tstore.dispatch(\"uiState/incrementCounts\", {\n\t\t\t\trequestCount: 1,\n\t\t\t\terrorCount: isError ? 1 : 0,\n\t\t\t})\n\t\t}\n\t\t\n\t\tconst loadFhir = (context) => {\n\t\t\tstore.dispatch(\"uiState/merge\", {submode: \"loading\"});\n\t\t\tfhirLoader.getFHIR(provider, queryProfile, context, true, mimeTypeMappings, retryLimit, handleStatusUpdate)\n\t\t\t\t.then(handleLoadDone)\n\t\t\t\t.catch(handleGlobalError);\n\t\t}\n\n\t\tconst handleGlobalError = (e) => {\n\t\t\t//don't show error if user clicked the cancel button\n\t\t\tif (e.message === \"cancelled\" || e.name === \"AbortError\")\n\t\t\t\treturn;\n\t\t\t\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"loadData\",\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: e.message || e,\n\t\t\t\t\tid: provider.id\n\t\t\t\t});\n\t\t}\n\n\t\tif (!provider.isOpen) {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"authorizing\",\n\t\t\t\tid: provider.id\n\t\t\t});\n\t\t\tfhirLoader.authAndGetFHIR(provider, ignoreState)\n\t\t\t\t.then(loadFhir)\n\t\t\t\t.catch(handleGlobalError);\n\t\t} else {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"loading\",\n\t\t\t\tid: provider.id\t\n\t\t\t});\t\t\n\t\t\tloadFhir()\n\t\t}\n\t});\n\tstore.on(\"fhir/cancelLoad\", (state, endState=\"ready\") =>  {\n\t\tfhirLoader.cancel();\n\t\tstore.dispatch(\"uiState/set\", {mode: endState});\n\t});\n\n\tstore.on(\"export/download\", ({ providers }) => {\n\t\tstore.dispatch(\"nonModalUi/merge\", {isDownloading: true})\n\t\tZipExporter.generateFile(providers)\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"ready\", \n\t\t\t\t\terror: e.message\n\t\t\t\t});\n\t\t\t})\n\t\t\t.finally( () => {\n\t\t\t\tstore.dispatch(\"nonModalUi/merge\", {isDownloading: false})\n\t\t\t});\n\t});\n\tstore.on(\"export/spreadsheet\", ({ providers, spreadsheetTemplates}, params) => {\n\t\tstore.dispatch(\"nonModalUi/merge\", {isExportingSheet: true})\n\t\tSpreadsheetExporter.exportSpreadsheet(\n\t\t\tproviders, spreadsheetTemplates, params.templateId, params.format\n\t\t)\n\t\t.catch( e => {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"globalError\", \n\t\t\t\terror: e\n\t\t\t});\n\t\t})\n\t\t.finally( () => {\n\t\t\tstore.dispatch(\"nonModalUi/merge\", {isExportingSheet: false})\n\t\t});\n\t});\n\n\tstore.on(\"export/github\", ( {githubConfig, providers} ) => {\n\t\t\n\t\tconst statusCallback = (status, statusUrl) => {\n\t\t\tstore.dispatch(\"uiState/merge\", { status, statusUrl });\n\t\t}\n\n\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\tsubmode: \"push\",\n\t\t\terror: null\n\t\t});\n\n\t\tghExporter.export(\n\t\t\tproviders, githubConfig, statusCallback\n\t\t)\n\t\t\t.then( () => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: null\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"githubExport\",\n\t\t\t\t\terror: e.message === \"canceled\" ? null : e.message\n\t\t\t\t});\n\t\t\t});\n\n\t})\n\n\tstore.on(\"export/github/cancel\", () => {\n\t\tghExporter.cancel();\n\t\tstore.dispatch(\"uiState/set\", { \n\t\t\tmode: \"githubExport\"\n\t\t});\n\t});\n\n\tstore.on(\"export/upload\", ({upload})  => {\n\t\tstore.dispatch(\"uiState/set\", { \n\t\t\tmode: \"fileUpload\",\n\t\t\tsubmode: \"getManifest\",\n\t\t\tstatus: \"Preparing to send data\"\n\t\t});\n\n\t\t//check whitelist if url doesn't come from config file\n\t\tif (upload.qsManifestUrl) {\n\t\t\tconst isValidUrl = fileExporter.isValidUrl(upload.manifestUrl, upload.whitelist);\n\t\t\tif (!isValidUrl) return store.dispatch(\"uiState/merge\", {\n\t\t\t\tsubmode: \"error\",\n\t\t\t\tstatus: \"Url manifest location not in whitelist: \" + upload.manifestUrl\n\t\t\t});\n\t\t}\n\n\t\t//if upload url is in config and no overriding manifest url, don't fetch manifest\n\t\tif (upload.uploadUrl && !upload.manifestUrl) {\n\t\t\treturn store.dispatch(\"uiState/merge\", {\n\t\t\t\tsubmode: \"preUpload\"\n\t\t\t});\n\t\t}\n\n\t\t//fetch manifest to get upload info\n\t\tfileExporter.getManifest(upload.manifestUrl)\n\t\t\t.then( data => {\n\t\t\t\tstore.dispatch(\"config/merge\", {\n\t\t\t\t\tupload: {\n\t\t\t\t\t\tmanifestUrl: upload.manifestUrl,\n\t\t\t\t\t\tlabel: upload.label,\n\t\t\t\t\t\t...data\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"preUpload\"\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: \"Unable to load manifest at \" + upload.manifestUrl\n\t\t\t\t});\n\t\t\t});\n\t});\n\t\n\tstore.on(\"export/upload/cancel\", ({upload}) => {\n\t\tif (upload.simulate)\n\t\t\treturn window.clearTimeout(simulateTimer);\n\t\tfileExporter.cancel();\n\t});\n\n\tstore.on(\"export/upload/send\", ({upload, providers}) => {\n\t\tstore.dispatch(\"uiState/set\", {\n\t\t\tmode: \"fileUpload\", \n\t\t\tsubmode: \"uploading\",\n\t\t\tstatus: \"Uploading Data\"\n\t\t});\n\n\t\tif (upload.simulate) {\n\t\t\treturn simulateTimer = window.setTimeout(() => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"postUpload\"\n\t\t\t\t});\n\t\t\t}, 2000);\n\t\t}\n\n\t\tzipExporter.exportProvidersAsBlob(providers)\n\t\t\t.then( file => {\n\t\t\t\treturn fileExporter.putFile(upload.uploadUrl, file)\n\t\t\t})\n\t\t\t.then( () => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"postUpload\"\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tif (err.name === \"AbortError\") return;\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: err.message.toString()\n\t\t\t\t});\n\t\t\t})\n\n\t});\n\n\tstore.on(\"export/settings\", ({providers, githubConfig, redirectUri}) => {\n\t\tUserSettings.download(providers, githubConfig, redirectUri);\n\t});\n\n\tstore.on(\"import/settings\", ({redirectUri, queryProfiles, noCustomEndpoints}, file) => {\n\t\tUserSettings.readFromFile(file, redirectUri, queryProfiles)\n\t\t\t.then( config => {\n\t\t\t\tif (noCustomEndpoints) config.providers = [];\n\t\t\t\t//unloading data controls prior to modifying config to avoid\n\t\t\t\t//timing error from control update and unmount at same time\n\t\t\t\tstore.dispatch(\"uiState/set\", {mode: \"loading\"});\n\t\t\t\tstore.dispatch(\"config/merge\", config);\n\t\t\t\tstore.dispatch(\"uiState/set\", { mode: \"ready\" });\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"ready\", \n\t\t\t\t\terror: e.message\n\t\t\t\t})\n\t\t\t})\n\t});\n\n}\n\nconst store = createStore([actions]);\n\nexport default store;","import Smart from \"../smart/smart-core\";\nimport SmartPopup from \"../smart/smart-popup\";\nimport FHIR from \"../smart/fhir\";\n\nexport default class FhirLoader {\n\t\n\tresetAbortController() {\n\t\tthis.controller = new AbortController();\n\t\tthis.signal = this.controller.signal;\t\n\t}\n\n\tcancel() {\n\t\tif (this.popup) {\n\t\t\tthis.popup.cancel();\n\t\t} else {\n\t\t\tthis.controller.abort();\n\t\t}\n\t}\n\n\tmergeAndDeDupeData(data) {\n\t\tlet uniqueUrls = {};\n\t\tlet files = [];\n\t\tlet entry = [];\n\t\tlet errorLog = [];\n\t\tlet errorCount = 0;\n\t\tdata.forEach( queryResult => {\n\t\t\tqueryResult.entry.forEach( ent => {\n\t\t\t\t//prevent duplicates\n\t\t\t\tif (uniqueUrls[ent.fullUrl]) return;\n\t\t\t\tuniqueUrls[ent.fullUrl] = true;\n\t\t\t\tentry.push(ent)\n\t\t\t})\n\t\t\tfiles = files.concat(queryResult.files || []);\n\t\t\terrorLog = errorLog.concat(queryResult.errorLog || []);\n\t\t\terrorCount += queryResult.errorCount || 0;\n\t\t})\n\t\treturn {entry, files, errorLog, errorCount}\n\t}\n\n\tgetFHIR(provider, queryProfile, context, allowErrors=true, mimeTypeMappings={}, retryLimit, statusCallback) {\n\t\tconst patientId = context ? context.patient : provider.patient;\n\n\t\tconst fetchQuery = (query) => {\n\t\t\tlet params = {...query.params}\n\t\t\tObject.keys(params).forEach(k => {\n\t\t\t\tif (Array.isArray(params[k])) params[k] = params[k].join(\",\");\n\t\t\t\tparams[k] = params[k].toString().replace(\"{{patientId}}\", patientId);\n\t\t\t});\n\t\t\tconst resourcePath = query.resourcePath.replace(/\\{\\{patientId\\}\\}/g, patientId);\n\n\t\t\treturn FHIR.getResourcesByQuery({\n\t\t\t\tfhirEndpoint: provider.fhirEndpoint, \n\t\t\t\tquery: {...query, params, resourcePath, fhirVersion: queryProfile.fhirVersion},\n\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\tretryLimit,\n\t\t\t\tallowErrors,\n\t\t\t\tstatusCallback,\n\t\t\t\tsignal: this.signal\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.containReferences) return data;\n\n\t\t\t\treturn FHIR.followAndEmbedReferences({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.containReferences,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tallowErrors,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then( result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.entry = result.entry;\n\t\t\t\t\treturn data;\n\t\t\t\t}); \n\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.retrieveReferences) return data;\n\n\t\t\t\treturn FHIR.followReferences({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.retrieveReferences,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tallowErrors,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then( result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.entry = data.entry.concat(result.entry);\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.downloadAttachments) return data;\n\t\t\t\treturn FHIR.findAndDownloadAttachments({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.downloadAttachments,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tmimeTypeMappings,\n\t\t\t\t\tallowErrors: true,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then(result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog || []);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.files = result.files;\n\t\t\t\t\tdata.entry = FHIR.attachmentsToFilenames({\n\t\t\t\t\t\tentry: data.entry, files: result.files, paths: query.downloadAttachments\n\t\t\t\t\t});\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\n\t\tthis.resetAbortController();\n\n\t\t//sequential query\n\t\t// return queryProfile.queries.reduce((promiseChain, currentQuery) => {\n\t\t// \treturn promiseChain.then( chainResults =>\n\t\t// \t\tfetchQuery(currentQuery) .then( currentResult =>\n\t\t// \t\t\t[ ...chainResults, currentResult ]\n\t\t// \t\t)\n\t\t// \t);\n\t\t// }, Promise.resolve([]))\n\t\t// \t.then( this.mergeAndDeDupeData )\n\n\t\t//parallel (moderated by browser)\n\t\treturn Promise.all( queryProfile.queries.map(fetchQuery) )\n\t\t\t.then( this.mergeAndDeDupeData )\n\t}\n\t\n\tauthAndGetFHIR(provider, ignoreState) {\n\t\t//make available to cancel function\n\t\tthis.popup = new SmartPopup(provider);\n\t\treturn Smart.getAuthEndpoints(provider.fhirEndpoint)\n\t\t\t.then(authEndpoints => {\n\t\t\t\treturn this.popup.authorize(authEndpoints, ignoreState);\n\t\t\t})\n\t\t\t.then(context => {\n\t\t\t\tthis.popup = null;\n\t\t\t\treturn context;\n\t\t\t}).catch(e => {\n\t\t\t\tthis.popup = null;\n\t\t\t\tthrow e;\n\t\t\t});\n\n\t}\n\n}\n","import gh from \"./github-api\";\nimport sanitizeFilename from \"sanitize-filename\";\nimport _ from \"lodash\";\n\nexport default class GithubExporter {\n\n\tcancel() {\n\t\tthis.canceled = true;\n\t}\n\n\tblobToBase64(blob) {\n\t\treturn new Promise( (resolve, reject) => {\n\t\t\tlet reader = new FileReader();\n\t\t\treader.onload = () => {\n\t\t\t\tconst dataUrl = reader.result;\n\t\t\t\tconst base64 = dataUrl.split(',')[1];\n\t\t\t\tresolve(base64);\n\t\t\t};\n\t\t\treader.onerror = reject;\n\t\t\treader.readAsDataURL(blob);\n\t\t});\n\t}\n\t\n\tbuildProviderTree(provider, folder) {\t\n\t\tconst createBlob = (content, fileName, encoding=\"utf-8\") => {\n\t\t\tif (this.canceled) throw new Error(\"Canceled\");\n\n\t\t\tif (this.statusCb)\n\t\t\t\tthis.statusCb(\"Adding \" + folder + \"/\" + fileName);\n\n\t\t\treturn gh.createBlob(this.config, {content, encoding})\n\t\t\t\t.then( blob => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsha: blob.sha,\n\t\t\t\t\t\tpath: folder + \"/\" + fileName,\n\t\t\t\t\t\tmode: \"100644\", //file\n\t\t\t\t\t\ttype: \"blob\"\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t};\n\n\t\tconst buildResourceTree = (bundles) => {\n\t\t\treturn Promise.all(\n\t\t\t\t_.map( bundles, (bundle, resourceType) => {\n\t\t\t\t\treturn createBlob(\n\t\t\t\t\t\tJSON.stringify(bundle, null, 2),\n\t\t\t\t\t\tresourceType+\".json\"\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\n\t\tconst buildFileTree = (files) => {\n\t\t\treturn Promise.all(\n\t\t\t\t_.map( files, file => {\n\t\t\t\t\treturn this.blobToBase64(file.blob)\n\t\t\t\t\t\t.then( base64 => {\n\t\t\t\t\t\t\treturn createBlob(base64, file.fileName, \"base64\") \n\t\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\n\t\tconst buildErrorLogTree = (errorLog) => {\n\t\t\treturn !errorLog.length \n\t\t\t\t? Promise.resolve([])\n\t\t\t\t: createBlob(\n\t\t\t\t\t\tJSON.stringify(errorLog, null, 2),\n\t\t\t\t\t\t\"error_log.json\"\n\t\t\t\t\t).then( blob => [blob] );\n\t\t}\n\n\t\tconst bundles = _.chain(provider.data.entry)\n\t\t\t.groupBy(e => e.resource.resourceType)\n\t\t\t.mapValues(entry => {\n\t\t\t\treturn {\n\t\t\t\t\tentry: _.map(entry, e => ({fullUrl: e.fullUrl, resource: e.resource}) ),\n\t\t\t\t\ttotal: entry.length, \n\t\t\t\t\ttype:\"collection\"\n\t\t\t\t}\n\t\t\t}).value();\n\n\t\treturn Promise.all([\n\t\t\tbuildResourceTree(bundles),\n\t\t\tbuildFileTree(provider.data.files),\n\t\t\tbuildErrorLogTree(provider.data.errorLog)\n\t\t]).then( trees => _.flatten(trees) );\n\n\t}\n\t\n\tbuildTree(baseTree, allProviders) {\n\t\tconst providers = _.filter( allProviders, p => {\n\t\t\treturn p.selected && p.data && p.data.entry && (p.data.entry.length || p.data.errorLog.length)\n\t\t})\n\t\tconst folders = _.map(providers, p => {\n\t\t\treturn sanitizeFilename(p.name);\n\t\t})\n\t\tconst tree = _.filter(baseTree.tree, item => {\n\t\t\tconst clear = folders.find( f => item.type === \"tree\" && item.path === f);\n\t\t\treturn clear ? false : true;\n\t\t});\n\t\treturn Promise.all( \n\t\t\t_.map( providers, (provider, i) => {\n\t\t\t\treturn this.buildProviderTree(provider, folders[i]);\n\t\t\t})\n\t\t).then( newTrees => {\n\t\t\treturn { \n\t\t\t\t...baseTree, \n\t\t\t\ttree: tree.concat(_.flatten(newTrees))\n\t\t\t}\n\t\t})\n\t}\n\n\tprepareCommit(providers) {\n\t\tlet lastCommit;\n\t\tif (this.statusCb)\n\t\t\tthis.statusCb(\"Retrieving repository information\");\n\n\t\treturn gh.getLastCommit(this.config)\n\t\t\t.then( commit => {\n\t\t\t\tlastCommit = commit;\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn gh.getTree(this.config, commit);\n\t\t\t})\n\t\t\t.then( commit => {\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn this.buildTree(commit, providers) \n\t\t\t})\n\t\t\t.then( tree => {\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn gh.createTree(this.config, tree) \n\t\t\t})\n\t\t\t.then( tree => ({ tree, lastCommit }) );\n\t}\n\n\texport(providers, githubConfig, statusCb, branchName) {\n\t\tthis.config = githubConfig;\n\t\tthis.canceled = false;\n\t\tthis.statusCb = statusCb;\n\t\treturn githubConfig.pullRequest \n\t\t\t? this.commitPullRequest(providers, branchName)\n\t\t\t: this.commitToMaster(providers);\n\t}\n\n\tcommitToMaster(providers) {\n\t\treturn this.prepareCommit(providers)\n\t\t\t.then( ({tree, lastCommit}) => {\n\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\n\t\t\t\tif (this.statusCb)\n\t\t\t\t\tthis.statusCb(\"Committing files\");\n\n\t\t\t\treturn gh.commitTree(\n\t\t\t\t\tthis.config,\n\t\t\t\t\ttree,\n\t\t\t\t\t\"ProcureBot Commit\",\n\t\t\t\t\tlastCommit\n\t\t\t\t).then( () => {\n\t\t\t\t\tif (this.statusCb)\n\t\t\t\t\t\tthis.statusCb(\"Data has been committed to master branch\");\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tcommitPullRequest(providers, branchName) {\n\t\tif (!branchName) \n\t\t\tbranchName = \"Procure/\" + \n\t\t\t\t(new Date().toISOString()).replace(/:/g, \"-\");\n\n\t\treturn this.prepareCommit(providers)\n\t\t\t.then( ({tree, lastCommit}) => {\n\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\n\t\t\t\tif (this.statusCb)\n\t\t\t\t\tthis.statusCb(\"Creating pull request\");\n\n\t\t\t\treturn gh.commitTreeToPullRequest(\n\t\t\t\t\tthis.config,\n\t\t\t\t\ttree,\n\t\t\t\t\t\"ProcureBot commit\",\n\t\t\t\t\tlastCommit,\n\t\t\t\t\t\"ProcureBot pull request\",\n\t\t\t\t\tbranchName\n\t\t\t\t).then( pull => {\n\t\t\t\t\tif (this.statusCb)\n\t\t\t\t\t\tthis.statusCb(\"A new pull request has been created\", pull.html_url);\n\t\t\t\t})\n\t\t\t});\t\t\n\t}\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Modal, ModalHeader, ModalBody, ModalFooter, Form, FormGroup, Label, Input, FormText, FormFeedback} from 'reactstrap';\nimport Select, { createFilter } from \"react-select\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\t//app state\n\tconst {\n\t\tuiState, providers, queryProfiles, credentials,\n\t\torganizations, orgDefaults, redirectUri, noCustomEndpoints, dispatch\n\t } = useStoreon(\n\t\t\"uiState\", \"providers\", \"queryProfiles\", \"credentials\",\n\t\t\"organizations\", \"orgDefaults\", \"redirectUri\", \"noCustomEndpoints\"\n\t );\n\n\t//component state\n\tconst [provider, setProvider] = useState({});\n\tconst [validation, setValidation] = useState({});\n\tconst [showDetails, setShowDetails] = useState(false);\n\t\n\tconst orgOptions = (\n\t\tnoCustomEndpoints ? [] : [{label: \"Custom Endpoint\", value: \"custom\"}] \n\t).concat(\n\t\t_.chain(organizations)\n\t\t\t.map( o => ({label: o.name, value: o.orgId || o.fhirEndpoint}) )\n\t\t\t.sortBy( o => o.label )\n\t\t\t.value()\n\t);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode === 27) handleCancel(e);\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel]);\n\n\tuseEffect( () => {\n\t\tif (!provider.id && uiState.id && uiState.mode === \"editProvider\") {\n\t\t\tconst currentProvider = providers.find(p => p.id === uiState.id);\n\t\t\tsetProvider(currentProvider)\n\t\t\tsetValidation({});\n\t\t\tsetShowDetails(currentProvider && currentProvider.orgId === \"custom\");\n\t\t}\n\t}, [uiState.id, uiState.mode, provider.id, providers])\n\n\tconst handleSubmit = (e, skipRefresh) => {\n\t\te.preventDefault();\n\n\t\tconst errors = validate(provider);\n\t\tif (errors) return setValidation(errors);\n\n\t\tif (skipRefresh) {\n\t\t\tdispatch(\"providers/upsert\", provider);\n\t\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t\t} else {\n\t\t\tdispatch(\"providers/upsertAndLoad\", provider);\n\t\t}\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleOrgSelection = (selection) => {\n\t\tlet orgConfig;\n\t\t//get default details\n\t\tif (selection.value !== \"custom\") {\n\t\t\torgConfig = organizations.find( o => selection.value === o.orgId || selection.value === o.fhirEndpoint );\n\t\t\tconst defaults = orgDefaults[orgConfig.defaultId] || {};\n\t\t\tif (orgConfig.defaultId !== undefined) orgConfig = {...defaults, ...orgConfig};\n\t\t} else {\n\t\t\torgConfig = {\n\t\t\t\tname: selection.label\n\t\t\t}\n\t\t}\n\t\t//get credential details if included by reference\n\t\tif (orgConfig.credentialId)\n\t\t\torgConfig = {...credentials[orgConfig.credentialId], ...orgConfig};\n\n\t\t//update provider with new defaults\n\t\tconst updatedProvider = {\n\t\t\tscope: [\"patient/*.read\", \"launch/patient\"],\n\t\t\tqueryProfile: \"argonaut_spec\",\n\t\t\t...orgConfig,\n\t\t\tredirectUri,\n\t\t\tid: provider.id,\n\t\t\torgId: selection.value\n\t\t}\n\t\t//show form if there's any missing data\n\t\tsetShowDetails(validate(updatedProvider));\n\t\tsetProvider(updatedProvider);\n\t}\n\n\tconst validate = (provider) => {\n\t\tlet validation = {};\n\t\tconst isInvalidUrl = (url) => !/^https?:\\/\\//.test(url.toLowerCase());\n\n\t\tif (provider.isOpen) {\n\t\t\t[\"name\", \"patient\"].forEach( f => { if (!provider[f]) validation[f] = \"Required\" })\n\t\t} else {\n\t\t\t[\"name\", \"clientId\", \"scope\"].forEach( f => { if (!provider[f]) validation[f] = \"Required\" })\n\t\t}\n\n\t\tif (isInvalidUrl(provider.fhirEndpoint || \"\"))\n\t\t\tvalidation.fhirEndpoint = \"Valid URL Required\";\n\t\t\n\t\tif (!provider.isOpen && isInvalidUrl(provider.redirectUri || \"\"))\n\t\t\tvalidation.redirectUri = \"Valid URL Required\";\n\n\t\treturn Object.keys(validation).length > 0 ? validation : null;\n\t}\n\n\tconst renderOrgSelector = () => {\n\t\t//workaround since component uses both the value and label to match and we just want to store the value\n\t\tconst value = provider.orgId ? orgOptions.find(o => o.value === provider.orgId) : null;\n\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"organization\">Healthcare Organization</Label>\n\t\t\t<Select id=\"organization\" autoFocus\n\t\t\t\t//performance improvement on autocomplete\n\t\t\t\tfilterOption={createFilter({ignoreAccents: false})}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={handleOrgSelection}\n\t\t\t\tisSearchable={true}\n\t\t\t\toptions={orgOptions}\n\t\t\t\tdefaultMenuIsOpen={provider.id ? false : true}\n\t\t\t/>\n\t\t</FormGroup>\n\t}\n\n\tconst renderTextInput = (title, property, type, isRequired, instructions, valueFn, onChangeFn) => {\n\t\tconst formText = instructions ? <FormText color=\"muted\">{instructions}</FormText> : \"\";\n\t\tconst errorText = validation[property] ? <FormFeedback>{validation[property]}</FormFeedback> : \"\";\n\t\tconst onChange = onChangeFn || ( e => {setProvider({...provider, [property]: e.target.value}) });\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"{property}\">{title}</Label>\n\t\t\t<Input\n\t\t\t\tvalue={valueFn ? valueFn() : provider[property] || \"\"}\n\t\t\t\ttype={type || \"text\"}\n\t\t\t\tid={property}\n\t\t\t\tonChange={onChange}\n\t\t\t\tinvalid={validation[property] ? true : false}\n\t\t\t\trequired={isRequired}\n\t\t\t/>\n\t\t\t{formText}\n\t\t\t{errorText}\n\t\t</FormGroup>\n\t}\t\n\n\tconst renderProfileSelector = () => {\n\t\tconst profileOptions = Object.keys(queryProfiles).map(q => {\n\t\t\treturn <option value={q} key={q}>{queryProfiles[q].title}</option>\n\t\t});\n\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"profile\">Profile</Label>\n\t\t\t<Input type=\"select\"\n\t\t\t\tvalue={provider.queryProfile || \"argonaut_spec\"}\n\t\t\t\tonChange={ e=> setProvider({...provider, queryProfile: e.target.value}) }\n\t\t\t\tname=\"profile\"\n\t\t\t> {profileOptions} </Input>\n\t\t</FormGroup>\n\t}\n\n\tconst openCheckbox = <FormGroup check>\n\t\t<Input type=\"checkbox\"\n\t\t\tid=\"isOpen\"\n\t\t\tchecked={provider.isOpen === true || provider.isOpen === \"true\" || false}\n\t\t\tonChange={e => setProvider({...provider, isOpen:!provider.isOpen})}\n\t\t/>\n\t\t<Label for=\"isOpen\">Open Endpoint</Label>\n\t</FormGroup>\n\n\tconst detailsLink = !noCustomEndpoints && <FormGroup>\n\t\t<a href=\"#\" onClick={e => setShowDetails(true)} >\n\t\t\t{\"Show Configuration Details\"}\n\t\t</a>\n\t</FormGroup>\n\n\tconst shortForm = <>\n\t\t{ renderOrgSelector() }\n\t\t{ renderTextInput(\"Title\", \"name\", \"text\", true) }\n\t</>\n\n\tconst openDetails = <>\n\t\t{ renderTextInput(\"FHIR Endpoint URL\", \"fhirEndpoint\", \"url\", true) }\n\t\t{ openCheckbox }\n\t\t{ renderProfileSelector() }\n\t\t{ renderTextInput(\"Patient Id\", \"patient\", \"text\", true)}\n\t</>\n\t\n\tconst secureDetails =  <>\n\t\t{ renderTextInput(\"FHIR Endpoint URL\", \"fhirEndpoint\", \"url\", true) }\n\t\t{ openCheckbox }\n\t\t{ renderProfileSelector() }\n\t\t{ renderTextInput(\"Client Id\", \"clientId\", \"text\", true) }\n\t\t{ renderTextInput(\"Client Secret (if applicable)\", \"clientSecret\", \"text\", true) }\n\t\t{ renderTextInput(\"Redirect URL\", \"redirectUri\", \"url\", true) }\n\t\t{ renderTextInput(\n\t\t\t\"Scope\", \"scope\", \"text\", true,  \"separate scopes with spaces\",\n\t\t\t() => (provider.scope || []).join(\" \"),\n\t\t\te => setProvider({...provider, scope: e.target.value.split(/\\s+/)})\n\t\t)}\n\t</>\n\n\treturn  <Modal isOpen={true} fade={false} backdrop={true} autoFocus={false}>\n\t\t<ModalHeader>{provider.id ? \"Update Provider\" : \"Add Provider\"} </ModalHeader>\n\t\t<ModalBody><Form onSubmit={handleSubmit} className=\"needs-validation\" noValidate>\n\t\t\t{ shortForm }\n\t\t\t{ !showDetails && provider.orgId ? detailsLink : null }\n\t\t\t{ showDetails && provider.isOpen ? openDetails : null }\n\t\t\t{ showDetails && !provider.isOpen ? secureDetails : null }\n\t\t</Form></ModalBody>\n\t\t<ModalFooter>\n\t\t\t<div className=\"mr-auto\"><a href=\"#\" onClick={handleCancel}>Cancel</a></div>\n\t\t\t<Button color=\"outline-secondary\" onClick={e => handleSubmit(e, true)}>Save</Button>\n\t\t\t<Button color=\"primary\" style={{marginLeft: \"1em\"}} onClick={handleSubmit}>Save and Load Records</Button>\n\t\t</ModalFooter>\n\t</Modal>\n\n}","import React from \"react\";\nimport {format} from \"timeago.js\";\n\nexport default class TimeAgo extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state= {timeAgo: format(this.props.time)}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.interval = setInterval(() => {\n\t\tthis.setState({timeAgo: format(this.props.time)});\n\t\t}, (this.props.refreshMinutes||1)*60000);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tclearInterval(this.interval);\n\t}\n\n\trender() {\n\t\treturn this.state.timeAgo\n\t}\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport TimeAgo from \"./TimeAgo\"\nimport { Button, CardBody, Card, Row, Col } from \"reactstrap\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faPlus, faTrash, faEdit, faCheckSquare } from \"@fortawesome/free-solid-svg-icons\"\nimport { faSquare } from \"@fortawesome/free-regular-svg-icons\"\n\nexport default () => {\n\n\tconst { providers, dispatch } = useStoreon(\"providers\");\n\n\tconst handleDeleteProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/remove\", id);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleEditProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {\n\t\t\tmode: \"editProvider\", id\n\t\t});\n\t}\n\n\tconst handleLoadRecords = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/loadData\", id);\n\t}\n\n\tconst handleAddProvider = (e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\tconst toggleProviderSelection = (id, newValue, e) => {\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: id, selected: newValue\n\t\t});\n\t}\n\n\tconst pluralizeEn = (text, len) => len === 1 ? text : text+\"s\";\n\n\tconst renderCard = (provider) => {\n\n\n\t\tconst renderDataDetails = () => <p>\t\n\t\t\t{ provider.data.entry.length} { pluralizeEn(\"resource\", provider.data.entry.length) }{\" | \"}\n\t\t\t{ provider.data.files.length} { pluralizeEn(\"file\", provider.data.files.length) }{\" | \"}\n\t\t\t{ provider.data.errorLog.length} { pluralizeEn(\"error\", provider.data.errorLog.length) }\n\t\t\t<br />loaded <TimeAgo time={provider.lastUpdated} />\n\t\t</p>\n\n\t\tconst controls = <div>\n\t\t\t<div className=\"float-right\">\n\t\t\t\t<a href=\"#\" \n\t\t\t\t\tonClick={e => handleEditProvider(provider.id, e)}\n\t\t\t\t\ttitle=\"Edit Provider\"\n\t\t\t\t>\n\t\t\t\t\t<FontAwesomeIcon icon={faEdit} color=\"#6c757d\" className=\"mx-2\" />\n\t\t\t\t</a>\n\n\t\t\t\t<a href=\"#\" \n\t\t\t\t\tonClick={e => handleDeleteProvider(provider.id, e)}\n\t\t\t\t\ttitle=\"Delete Provider\"\n\t\t\t\t>\n\t\t\t\t\t<FontAwesomeIcon icon={faTrash} color=\"#6c757d\" className=\"mx-2\" />\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<a href=\"#\" \n\t\t\t\tstyle={{fontWeight: !provider.lastUpdated ? \"bold\" : \"normal\"}}\n\t\t\t\tonClick={e => handleLoadRecords(provider.id, e)}>\n\t\t\t\t{provider.lastUpdated ? \"re\" : \"\"}load records\n\t\t\t</a>\n\t\t</div>\n\n\t\treturn <Card style={{margin:\"0 1rem 1rem 0\"}} key={provider.id}>\n\t\t\t<CardBody><Row>\n\t\t\t\t<Col xs={{size: \"auto\"}} className=\"mr-0 pr-1 text-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<input type=\"checkbox\"\n\t\t\t\t\t\t\tstyle={{visibility: \"hidden\", width:0, height:0}}\n\t\t\t\t\t\t\tchecked={!!provider.selected} \n\t\t\t\t\t\t\tid={\"selection-\"+ provider.id}\n\t\t\t\t\t\t\tonChange={e => toggleProviderSelection(provider.id, !provider.selected)} \n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label htmlFor={\"selection-\"+ provider.id}>\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={!!provider.selected ? faCheckSquare : faSquare} size=\"lg\" color={!!provider.selected ? \"green\" : \"black\"} />\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</Col><Col>\n\t\t\t\t\t<p className=\"font-weight-bold\" \n\t\t\t\t\t\tstyle={{marginBottom: \".25rem\", cursor: \"pointer\", display:\"inline-block\"}}\n\t\t\t\t\t\tonClick={e => toggleProviderSelection(provider.id, !provider.selected, e)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{provider.name}\n\t\t\t\t\t</p>\n\t\t\t\t\t\t{ provider.lastUpdated && renderDataDetails() }\n\t\t\t\t\t\t{ controls }\n\t\t\t\t</Col>\n\t\t\t</Row></CardBody>\n\t\t</Card>\n\n\t};\n\n\treturn <div>\n\t\t<div style={{marginBottom: \"1.5rem\"}}>\n\t\t\t<Button color=\"success\"\n\t\t\t\tstyle={{marginRight: \"1rem\"}}\n\t\t\t\tonClick={handleAddProvider}\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faPlus} className=\"mr-2\" />\n\t\t\t\tAdd Provider\n\t\t\t</Button>\t\n\t\t</div>\n\t\t{ providers.map(renderCard) }\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Spinner, Modal, ModalBody, ModalFooter} from 'reactstrap';\nimport { saveAs } from \"file-saver\";\n\nexport default () => {\n\n\tconst { uiState, providers, dispatch } = useStoreon(\"uiState\", \"providers\");\n\n\tconst provider =  useMemo( () => {\n\t\treturn providers.find(p => p.id === uiState.id)\n\t}, [uiState.id, providers]);\n\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/cancelLoad\");\n\t}, [dispatch]);\n\n\tconst handleClose = useCallback( e => {\n\t\tif (e) e.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode  === \"authorizing\" || uiState.submode === \"loading\") {\n\t\t\t\thandleCancel(e);\n\t\t\t} else {\n\t\t\t\thandleClose(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel, handleClose, uiState.submode]);\n\n\tconst handleSave = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: provider.id,\n\t\t\tlastUpdated: new Date(),\n\t\t\tdata: uiState.data\n\t\t});\n\t\thandleClose();\n\t}\n\n\tconst handleLogDownload = e => {\n\t\te.preventDefault();\n\t\tconst blob = new Blob(\n\t\t\t[JSON.stringify(uiState.data.errorLog, null, 2)], \n\t\t\t{type: \"application/json\"}\n\t\t);\n\t\tsaveAs(blob, \"errors.json\");\n\t}\n\t\n\tconst renderAuthorizing = () => <div>\n\t\t<h5>Waiting for authorization...</h5>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst pluralizeEn = (text, len) => len === 1 ? text : text+\"s\";\n\n\tconst renderLoading = () => <div>\n\t\t<h5>\n\t\t\t{uiState.requestCount} {pluralizeEn(\"request\", uiState.requestCount)} \n\t\t\t&nbsp; / &nbsp;\n\t\t\t{uiState.errorCount} {pluralizeEn(\"error\", uiState.errorCount)}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderLoaded = () => <div>\n\t\t<h5>\n\t\t\t{uiState.data.entry.length} {pluralizeEn(\"resource\", uiState.data.entry.length)} retrieved<br/>\n\t\t\t{uiState.data.files.length || \"No\"} {pluralizeEn(\"attachment\", uiState.data.files.length)} downloaded<br/>\n\t\t\t{uiState.data.errorLog.length || \"No\"} {pluralizeEn(\"error\", uiState.data.errorLog.length)} occurred\n\t\t</h5>\n\t</div>\n\n\tconst renderGlobalError = () => <div>\n\t\t<h5 style={{padding: \"1rem 0\", color: \"red\"}}>An error occurred: { uiState.status }</h5>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleClose}>Close</Button>\n\t\t</div>\n\t</div>\n\n\t\n\tconst renderLoadedButtons = () => {\n\t\tconst downloadLink = uiState.data.errorLog.length > 0 && \n\t\t\t<div className=\"mr-auto\"><a href=\"#\" onClick={handleLogDownload}>Download error log</a></div>;\n\t \treturn <ModalFooter>\n\t\t\t{downloadLink}\n\t\t\t<Button color=\"outline-secondary\" onClick={handleClose}>Cancel</Button>\n\t\t\t<Button color=\"primary\" style={{marginLeft: \"1em\"}} onClick={handleSave}>Save</Button>\n\t\t</ModalFooter>\n\t}\n\n\treturn <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalBody style={{textAlign: \"center\"}}>\n\t\t\t<h3>{provider.name}</h3>\n\t\t\t{ uiState.submode === \"authorizing\" && renderAuthorizing() }\n\t\t\t{ uiState.submode === \"loading\" && renderLoading() }\n\t\t\t{ uiState.submode === \"loaded\" && renderLoaded() }\n\t\t\t{ uiState.submode === \"error\" && renderGlobalError() }\n\t\t</ModalBody>\n\t\t{ uiState.submode === \"loaded\" && renderLoadedButtons() }\t\n\t</Modal>\n\n\n}","import React from \"react\";\nimport {Spinner} from 'reactstrap';\n\nexport default () => {\n\n\treturn <div className=\"text-center\" style={{margin:\"3rem\"}}>\n\t\t<Spinner style={{ width:\"3rem\", height:\"3rem\", margin:\"1rem\"}} />\n\t\t<h4>Loading</h4>\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {\n\tButton, Spinner, Col, Row, \n\tForm, FormGroup, Modal, ModalHeader, \n\tModalBody, ModalFooter, Label, \n\tInput, Container, Alert\n} from 'reactstrap';\n\nexport default () => {\n\t//app state\n\tconst {uiState, githubConfig, dispatch} = useStoreon(\"uiState\", \"githubConfig\");\n\n\t//component state\n\tconst [showInstructions, setShowInstructions] = useState();\n\n\tconst handleHideDialog = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"})\n\t}, [dispatch]);\n\n\tconst handleCancelExport = useCallback( e => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/github/cancel\");\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode !== \"push\") {\n\t\t\t\thandleHideDialog(e);\n\t\t\t} else {\n\t\t\t\thandleCancelExport(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancelExport, handleHideDialog]);\n\t\n\tconst handleSubmit = e => {\n\t\te.preventDefault()\n\t\tif (!githubConfig.token || !githubConfig.owner || !githubConfig.project) {\n\t\t\tdispatch(\"uiState/merge\", {\n\t\t\t\terror: \"Please enter a personal access token, repository owner and repository project to continue.\"\n\t\t\t});\n\t\t} else {\n\t\t\tdispatch(\"export/github\");\n\t\t}\n\t}\n\n\tconst handleFieldChange = (fieldName, e) => {\n\t\tconst value = fieldName === \"pullRequest\"\n\t\t\t? e.target.value === \"true\"\n\t\t\t: e.target.value;\n\t\tdispatch(\"config/merge\", {\n\t\t\tgithubConfig: {\n\t\t\t\t...githubConfig, [fieldName]: value\n\t\t\t}\n\t\t});\n\t\tdispatch(\"uiState/merge\", {\n\t\t\tstatus: null,\n\t\t\terror: null\n\t\t});\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleToggleInstructions = e => {\n\t\te.preventDefault();\n\t\tsetShowInstructions(!showInstructions);\n\t}\n\n\tconst renderLoading = () => <ModalBody className=\"text-center\">\n\t\t<h5>\n\t\t\t{uiState.status}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancelExport}>Cancel</Button>\n\t\t</div>\n\t</ModalBody>\n\n\tconst renderError = () => (\n\t\t<Row><Col xs={12}>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"danger\">\n\t\t\t\t\t<span>{uiState.error.toString()}</span>\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</Col></Row>\n\t);\n\n\tconst renderMessage = () => {\n\t\tconst url = uiState.statusUrl \n\t\t\t? <span> (<a href={uiState.statusUrl} target=\"_blank\" rel=\"noopener noreferrer\">view</a>)</span>\n\t\t\t: null;\n\t\treturn <Row><Col xs={12}>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"success\">\n\t\t\t\t\t{uiState.status}\n\t\t\t\t\t{url}.\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</Col></Row>\n\t};\n\n\tconst renderForm = () => <Form onSubmit={handleSubmit}>\n\t\t<ModalBody>\n\t\t\t{ uiState.error && renderError() }\n\t\t\t{ uiState.status && renderMessage() }\n\t\t\t<Row form style={{margin: \"1rem 0\"}}><Col xs={12}>\n\t\t\t\t\t<div className=\"small float-right\">\n\t\t\t\t\t\t<a href=\"#\" onClick={handleToggleInstructions}>How do I get a token?</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\"token-instructions\" style={{display: showInstructions ? \"block\" : \"none\", marginTop: \"2rem\"}}>\n\t\t\t\t\t\tTo obtain a personal access token for your Github account:\n\t\t\t\t\t\t<ol>\n\t\t\t\t\t\t\t<li>Visit <a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\thttps://github.com/settings/tokens\n\t\t\t\t\t\t\t</a></li>\n\t\t\t\t\t\t\t<li>Click the \"Generate new token\" button in upper right corner of the page.</li>\n\t\t\t\t\t\t\t<li>Add a note to identify the token in case you want to revoke it later (eg. \"Procure\").</li>\n\t\t\t\t\t\t\t<li>Select permissions:\n\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t<li>To push data to a public repository, check the <i>\"public_repo\"</i> item under <i>\"repo\"</i>.</li>\n\t\t\t\t\t\t\t\t\t<li>To push data to a private repository, check the <i>\"repo\"</i> item.</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>Click the \"Generate token\" button at the bottom of the page.</li>\n\t\t\t\t\t\t</ol>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Label for=\"token\">Personal Access Token</Label>\n\t\t\t\t\t<Input id=\"token\" \n\t\t\t\t\t\tvalue={(githubConfig && githubConfig.token) || \"\"} \n\t\t\t\t\t\tonChange={ e => handleFieldChange(\"token\", e) }\n\t\t\t\t\t/>\n\n\t\t\t</Col></Row>\n\n\t\t\t<Row form style={{margin: \"1rem 0\"}}><Col xs={12}>\n\t\t\t\t<Label for=\"repo\">Repository</Label>\n\t\t\t</Col><Col xs={4}>\n\t\t\t\t<Input id=\"owner\"\n\t\t\t\t\tvalue={(githubConfig && githubConfig.owner) || \"\"} \n\t\t\t\t\tonChange={ e => handleFieldChange(\"owner\", e) } \n\t\t\t\t\tplaceholder=\"Owner\" data-lpignore=\"true\"\n\t\t\t\t/>\n\t\t\t</Col><Col xs={1}>\n\t\t\t<Input readOnly className=\"form-control-plaintext\" defaultValue=\"/\" />\n\t\t\t</Col><Col xs={7}>\n\t\t\t\t<Input id=\"project\" \n\t\t\t\t\tvalue={(githubConfig && githubConfig.project) || \"\"} \n\t\t\t\t\tonChange={ e => handleFieldChange(\"project\", e) } \n\t\t\t\t\tplaceholder=\"Project\" data-lpignore=\"true\"\n\t\t\t\t/>\n\t\t\t</Col></Row>\n\n\t\t\t<Row form style={{margin: \"2rem 0\"}}><Col xs={12}>\n\t\t\t\t<FormGroup check>\n\t\t\t\t\t<Label check>\n\t\t\t\t\t\t<Input type=\"radio\"\n\t\t\t\t\t\t\tname=\"pull-request\"\n\t\t\t\t\t\t\tvalue={false}\n\t\t\t\t\t\t\tchecked={!githubConfig.pullRequest}\n\t\t\t\t\t\t\tonChange={ e => handleFieldChange(\"pullRequest\", e) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tCommit directly to the master branch</Label>\n\t\t\t\t</FormGroup>\n\t\t\t\t<FormGroup check>\n\t\t\t\t\t<Label check>\n\t\t\t\t\t\t<Input type=\"radio\"\n\t\t\t\t\t\t\tname=\"pull-request\"\n\t\t\t\t\t\t\tvalue={true}\n\t\t\t\t\t\t\tchecked={githubConfig.pullRequest === true}\n\t\t\t\t\t\t\tonChange={ e => handleFieldChange(\"pullRequest\", e) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tCreate a new branch and pull request</Label>\n\t\t\t\t</FormGroup>\n\t\t\t</Col></Row>\n\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"success\" type=\"submit\">Push Data</Button>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Close</Button>\n\t\t</ModalFooter>\n\t</Form>\n\t\n\treturn  <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalHeader>Push to Github Repository</ModalHeader>\n\t\t{ uiState.submode === \"push\" ? renderLoading() : renderForm() }\n\t</Modal>\n\n}","import React, { useState } from \"react\";\n\nexport default ({ children, dropHint, fileDropHandler }) => {\n\n\tconst [dragCounter, setDragCounter] = useState(0);\n\n\tconst isFileDrag = e => {\n\t\treturn !e.dataTransfer.types ||\n\t\t\te.dataTransfer.types[0] === \"Files\" ||\n\t\t\te.dataTransfer.types[0] === \"application/x-moz-file\";\n\t}\n\t\n\tconst handleDrop = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (e.dataTransfer.files && e.dataTransfer.files.length === 1)\n\t\t\tfileDropHandler(e.dataTransfer.files[0]);\n\t\t// e.dataTransfer.clearData();\n\t\tsetDragCounter(0);\n\t}\n\n\tconst handleDragOver = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\t\n\t}\n\n\tconst handleDragEnter = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (isFileDrag(e))\n\t\t\tsetDragCounter(dragCounter+1);\n\t}\n\n\tconst handleDragLeave = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (isFileDrag(e))\n\t\t\tsetDragCounter(dragCounter-1);\n\t}\n\n\tconst overlay = <div className=\"d-flex justify-content-center\" style={{\n\t\tborder: 'dashed grey 4px',\n\t\tbackgroundColor: 'rgba(255,255,255,.8)',\n\t\tposition: 'absolute',\n\t\ttop: 0,\n\t\tbottom: 0,\n\t\tleft: 0, \n\t\tright: 0,\n\t\tzIndex: 9999,\n\t}}>\n\t\t<div className=\"d-flex align-items-center\">\n\t\t\t{ dropHint || \"Drop settings file here\"}\n\t\t</div>\n\t</div>\n\n\treturn <div \n\t\tstyle={{position: \"relative\"}}\n\t\t\tonDragEnter={handleDragEnter}\n\t\t\tonDragOver={handleDragOver}\n\t\t\tonDragLeave={handleDragLeave}\n\t\t\tonDrop={handleDrop}\n\t\t>\n\t\t{ dragCounter > 0 && overlay }\n\t\t{ children }\n\t</div>\n\t\n\t\n} \t","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, {useRef, useEffect} from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Navbar, NavbarBrand, Nav, NavItem, NavLink} from 'reactstrap';\nimport SettingsImportDropZone from \"./SettingsImportDropZone\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faMedkit } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { providers, isDirty, warnOnPageNavigate, appName, dispatch } = useStoreon(\"providers\", \"isDirty\", \"warnOnPageNavigate\", \"appName\");\n\tconst fileInput = useRef();\n\n\tuseEffect( () => {\n\t\twindow.onbeforeunload = () => (isDirty && warnOnPageNavigate) ? true : null;\n\t});\n\n\tconst handleImportSettings = e => {\n\t\te.preventDefault();\n\t\tfileInput.current.value = \"\";\n\t\tfileInput.current.click();\n\t}\n\n\tconst handleFileSelected = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (e.target.files.length === 1)\n\t\t\treadFile(e.target.files[0]);\n\t}\n\n\tconst handleDownloadSettings = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"export/settings\");\n\t}\n\n\tconst readFile = (file) => {\n\t\tconst replace = providers.length === 0 || window.confirm(\n\t\t\t\"Current providers in your list will be replaced. Continue?\"\n\t\t)\n\t\tif (replace) {\n\t\t\tdispatch(\"import/settings\", file)\n\t\t\tdispatch(\"refreshDirty\", true);\n\t\t};\n\t}\n\n\treturn <div style={{marginBottom: \"2rem\"}}><SettingsImportDropZone fileDropHandler={readFile}>\n\t\t<input ref={fileInput}\n\t\t\t\ttype=\"file\" \n\t\t\t\tstyle={{display: 'none'}}\n\t\t\t\tonChange={handleFileSelected}\n\t\t\t\taccept=\".json, application/json\"\n\t\t/>\n\t\t<Navbar color=\"light\" light expand=\"xs\">\n\t\t\t<NavbarBrand href=\"/\">\n\t\t\t\t<FontAwesomeIcon icon={faMedkit} alt=\"Procure logo\" className=\"mr-2\" />\n\t\t\t\t{appName || \"Procure\"}\n\t\t\t</NavbarBrand>\n\t\t\t<Nav className=\"ml-auto\" navbar>\n\t\t\t\t<NavItem>\n\t\t\t\t\t<NavLink href=\"#\" onClick={handleImportSettings}>import settings</NavLink>\n\t\t\t\t</NavItem>\n\t\t\t\t<NavItem>\n\t\t\t\t\t<NavLink href=\"#\" onClick={handleDownloadSettings} style={{fontWeight: isDirty ? \"bold\" : \"normal\"}}>\n\t\t\t\t\t\texport settings\n\t\t\t\t\t</NavLink>\n\t\t\t\t</NavItem>\n\t\t\t</Nav>\n\t\t</Navbar>\n\t</SettingsImportDropZone></div> \n\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useMemo, useRef } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport Select from \"react-select\";\nimport JSONTree from \"react-json-tree\";\nimport {FormGroup, Button} from \"reactstrap\";\nimport _ from \"lodash\";\nimport { saveAs } from \"file-saver\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronLeft, faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\t\n\t//app state\n\tconst { providers, dateSortElements } = useStoreon(\"providers\", \"dateSortElements\");\n\n\t//component state\n\tconst [resourceType, setResourceType] = useState();\n\tconst [position, setPosition] = useState(1);\n\tconst [overlayResources, setOverlayResources] = useState([]);\n\n\tconst componentTopRef = useRef();\n\n\tlet resourceTypeOptions = useMemo( () => {\n\t\treturn _.chain(providers)\n\t\t\t.filter( p => p.data && p.selected )\n\t\t\t.map( p => p.data.entry.map(e => e.resource.resourceType) )\n\t\t\t.flatten().uniq()\n\t\t\t.map(o => ({label: o, value: o}))\n\t\t\t.sortBy([\"label\"])\n\t\t\t.value();\n\t}, [providers]);\n\n\tlet resources = useMemo( () => {\n\t\treturn _.chain(providers)\n\t\t\t.filter( p => p.data && p.data.entry && p.selected )\n\t\t\t.map( p => p.data.entry ).flatten()\n\t\t\t.filter( e => (!resourceType || resourceType.value === e.resource.resourceType) )\n\t\t\t.sortBy( e => {\n\t\t\t\tconst sortElements = dateSortElements[e.resource.resourceType] || [];\n\t\t\t\tconst sortElement = _.find( sortElements, element => e.resource[element]);\n\t\t\t\tconst dateValue =\n\t\t\t\t\t(sortElement && (e.resource[sortElement].start || e.resource[sortElement])) || \n\t\t\t\t\t(e.resource.meta && e.resource.meta.lastUpdated) || \"\";\n\t\t\t\treturn dateValue;\n\t\t\t})\n\t\t\t.reverse()\n\t\t\t.value();\n\t}, [providers, resourceType, dateSortElements]);\n\n\t//remove leading slashes, trailing slashes and protocol\n\tconst simplifyUrl = (url) => url.replace(/^\\/|https?:\\/\\/|\\/*$/g, \"\")\n\n\tconst referenceIndex = useMemo( () => {\n\t\tlet index = {};\n\t\t_.each(providers, (provider, i) => {\n\t\t\t_.each(((provider.data && provider.data.entry) || []), (entry, j) => {\n\t\t\t\tindex[simplifyUrl(entry.fullUrl)] = [i, j, \"resource\"]\n\t\t\t})\n\t\t\t_.each(((provider.data && provider.data.files) || []), (file, j) => {\n\t\t\t\tindex[file.fileName] = [i, j, \"file\"]\n\t\t\t})\t\t\n\t\t});\n\t\treturn index;\n\t}, [providers]);\n\n\tconst handlePosChange = (dir, e) => {\n\t\te.preventDefault();\n\t\tsetPosition(position+dir);\n\t}\n\n\tconst filters = <FormGroup>\n\t\t<Select id=\"resourceType\"\n\t\t\tvalue={resourceType}\n\t\t\tonChange={ selection => {setResourceType(selection); setPosition(1);setOverlayResources([]);} }\n\t\t\tisSearchable={true}\n\t\t\toptions={ resourceTypeOptions }\n\t\t\tplaceholder=\"Filter by Resource Type\"\n\t\t\tisClearable={true}\n\t\t/>\n\t</FormGroup>\n\n\tconst renderPositionNav = () => {\n\t\tconst noResources = <div className=\"text-center\">\n\t\t\tNo resources found\n\t\t</div>;\n\t\t\t\t\n\t\tconst nextPrevNav = <div>\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" \n\t\t\t\tdisabled={position === 1}\n\t\t\t\tonClick={e => handlePosChange(-1, e)} className=\"mr-3\"\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faChevronLeft} />\n\t\t\t</Button>\n\t\t\t\tResource {position} of {resources.length}\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" \n\t\t\t\tdisabled={position === resources.length} \n\t\t\t\tonClick={e => handlePosChange(1, e)}  className=\"ml-3\"\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t</Button>\n\t\t</div>;\n\n\t\tconst overlayNav = <div>\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" onClick={e => {\n\t\t\t\tsetOverlayResources(_.slice(overlayResources, 0, -1))\n\t\t\t}}>\n\t\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\tBack\n\t\t\t</Button>\n\t\t</div>;\n\n\t\tif (overlayResources.length) {\n\t\t\treturn overlayNav;\n\t\t} else if (resources.length) {\n\t\t\treturn nextPrevNav;\n\t\t} else {\n\t\t\treturn noResources;\n\t\t}\n\n\t}\n\n\tconst treeTheme = {\n\t\tbase00: '#272822',base01: '#383830',base02: '#49483e',base03: '#75715e',\n\t\tbase04: '#a59f85',base05: '#f8f8f2',base06: '#f5f4f1',base07: '#f9f8f5',\n\t\tbase08: '#f92672',base09: '#fd971f',base0A: '#f4bf75',base0B: '#a6e22e',\n\t\tbase0C: '#a1efe4',base0D: '#66d9ef',base0E: '#ae81ff',base0F: '#cc6633'\n\t};\n\n\tconst handleReference = (url, e) => {\n\t\te.preventDefault();\n\t\tconst index = referenceIndex[url];\n\t\tif (index[2] === \"file\") {\n\t\t\tconst file = providers[index[0]].data.files[index[1]];\n\t\t\tsaveAs(file.blob, file.fileName);\n\t\t} else {\n\t\t\tsetOverlayResources([...overlayResources, url]);\n\t\t\twindow.scrollTo(0, componentTopRef.current.offsetTop);\n\t\t}\n\t}\n\n\tconst valueRenderer = (raw, value, key) => {\n\t\tlet link;\n\n\t\tif (key === \"reference\") {\n\t\t\t//remove leading and trailing slashes\n\t\t\tlet refUrl = simplifyUrl(value);\n\n\t\t\t//add base url if relative path\n\t\t\tif ((refUrl.match(/\\//g) || []).length === 1) {\n\t\t\t\tconst fullUrl =\n\t\t\t\t\t(overlayResources.length && _.last(overlayResources).fullUrl) ||\n\t\t\t\t\tresources[position-1].fullUrl;\n\t\t\t\tconst baseUrl = simplifyUrl(fullUrl).split(\"/\");\n\t\t\t\trefUrl = baseUrl\n\t\t\t\t\t.slice(0, baseUrl.length-2).join(\"/\") + \"/\" + refUrl;\n\t\t\t}\n\t\t\tif (referenceIndex[refUrl]) link = refUrl;\n\t\t//this could be optimized by only looking at attachment keys\n\t\t} else if (key === \"url\" && referenceIndex[value]) {\n\t\t\tlink = value;\n\t\t//truncate very long values\n\t\t} else if (value.length > 500) {\n\t\t\traw = value.substring(0,500) + \"...\";\n\t\t}\n\n\t\treturn link ? <span>\n\t\t\t\"<a href=\"#\" style={{textDecoration: \"underline\"}}\n\t\t\tonClick={e => handleReference(link, e)}\n\t\t\t>{value}</a>\"\n\t\t</span> : raw;\n\t}\n\n\tconst getResourceByUrl = (url) => {\n\t\tconst index = referenceIndex[url];\n\t\tif (index) return providers[index[0]].data.entry[index[1]];\n\t}\n\n\tconst renderJsonTree = () => {\n\n\t\tconst overlayData = overlayResources.length && getResourceByUrl(_.last(overlayResources))\n\t\tif (overlayResources.length && !overlayData) \n\t\t\tsetOverlayResources(_.slice(overlayResources, 1,-1));\t\n\t\tconst data = (\n\t\t\toverlayData && overlayData.resource\n\t\t) || (\n\t\t\tresources[position-1] && resources[position-1].resource\n\t\t);\n\t\t\n\t\tif (data) return <div style={{\n\t\t\tmarginTop: \"1rem\", padding: \"1rem\", \n\t\t\tborder: \"1px solid #ccc\", borderRadius: \".25rem\", \n\t\t\tbackground: \"#fffffa\"\n\t\t}}>\n\t\t\t<JSONTree \n\t\t\t\tdata={data} \n\t\t\t\ttheme={treeTheme} \n\t\t\t\thideRoot={true} \n\t\t\t\tshouldExpandNode={(keyName, data, level) => true}\n\t\t\t\tinvertTheme={true}\n\t\t\t\tvalueRenderer={valueRenderer}\n\t\t\t/>\n\t\t</div>;\n\t}\n\n\treturn <div ref={componentTopRef}>\n\t\t{ filters }\n\t\t{ renderPositionNav() }\n\t\t{ renderJsonTree() }\n\t</div>\n}","import React, {useState} from \"react\";\nimport {Button, Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faTable, faFileDownload, faFileUpload } from \"@fortawesome/free-solid-svg-icons\"\nimport { faGithub } from \"@fortawesome/free-brands-svg-icons\"\n\nexport default (props) => {\n\n\tconst { \n\t\tspreadsheetTemplates,\n\t\tupload,\n\t\tnonModalUi, dispatch \n\t} = useStoreon(\n\t\t\"spreadsheetTemplates\",\n\t\t\"upload\",\n\t\t\"nonModalUi\"\n\t);\n\t\n\tconst [showSpreadsheetOptions, setShowSpreadsheetOptions] = useState(false);\n\n\tconst handleExportData = (e) => {\t\t\n\t\te.preventDefault();\n\t\tdispatch(\"export/download\");\n\t}\n\n\tconst handleFileUpload = (e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/upload\");\n\t}\n\n\tconst handleShowGithubExport = (e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"githubExport\"});\n\t}\n\n\tconst handelExportSpreadsheet = (templateId, format, e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/spreadsheet\", {templateId, format});\n\t}\n\n\tconst renderSpreadsheetExport = () => {\n\t\tif (!Object.keys(spreadsheetTemplates||{}).length) \n\t\t\treturn null;\n\t\tlet menuItems = [];\n\t\tObject.keys(spreadsheetTemplates).forEach( templateId => {\n\t\t\tmenuItems.push(\n\t\t\t\t<DropdownItem \n\t\t\t\t\tkey={templateId + \"-xlsx\"} \n\t\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"xlsx\")}\n\t\t\t\t>\n\t\t\t\t\t{spreadsheetTemplates[templateId].name + \" (Excel)\"}\n\t\t\t\t</DropdownItem>,\n\t\t\t\t<DropdownItem \n\t\t\t\t\tkey={templateId + \"-csv\"}\n\t\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"csv\")}\n\t\t\t\t>\n\t\t\t\t\t{spreadsheetTemplates[templateId].name + \" (CSV)\"}\n\t\t\t\t</DropdownItem>\n\t\t\t)\n\t\t});\n\t\treturn <Dropdown \n\t\t\tstyle={{display: \"inline\",}}\n\t\t\tdisabled={nonModalUi.isExportingSheet}\n\t\t\tisOpen={showSpreadsheetOptions}\n\t\t\ttoggle={e => setShowSpreadsheetOptions(!showSpreadsheetOptions)}\n\t\t>\n\t\t\t<DropdownToggle \n\t\t\t\tcolor=\"outline-secondary\" \n\t\t\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\t\t\tcaret\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faTable} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Export as Spreadsheet</span>\n\t\t\t</DropdownToggle>\n\t\t\t<DropdownMenu>{menuItems}</DropdownMenu>\n\t\t</Dropdown>\n\t}\n\n\tconst uploadButton = <Button \n\t\tcolor=\"success\"\n\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\tonClick={handleFileUpload}\n\t\t>\n\t\t\t<FontAwesomeIcon icon={faFileUpload} className=\"mr-2\" />\n\t\t\t{upload.label || \"Share Data\"}\n\t</Button>;\n\n\tconst downloadAllButton = <Button \n\t\tcolor=\"outline-secondary\"\n\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\tonClick={handleExportData}\n\t\tdisabled={nonModalUi.isDownloading}\n\t\t>\n\t\t\t<FontAwesomeIcon icon={faFileDownload} className=\"mr-2\" />\n\t\t\tDownload Data\n\t</Button>;\n\n\tconst ghExportButton = <Button \n\t\tstyle={{margin: \"0 0 1rem 0\"}}\n\t\tcolor=\"outline-secondary\"\n\t\tonClick={handleShowGithubExport}\n\t\t>\n\t\t<FontAwesomeIcon icon={faGithub} className=\"mr-2\" />\n\t\tUpload to Github\n\t</Button>;\n\n\treturn <div style={{marginBottom: \".5rem\"}}>\n\t\t{upload && (upload.manifestUrl || upload.uploadUrl) && uploadButton}\n\t\t{downloadAllButton}\n\t\t{props.hasResources && renderSpreadsheetExport()}\n\t\t{ghExportButton}\n\t</div>\n\n}","import React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button} from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { dispatch } = useStoreon();\n\n\tconst handleAddProvider = (e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\treturn \t<Button block color=\"success\"\n\t\tonClick={handleAddProvider}\n\t>\n\t\t<FontAwesomeIcon icon={faPlus} className=\"mr-2\" />\n\t\tAdd Provider\n\t</Button>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {\n\tButton, Spinner, Modal, ModalHeader, \n\tModalBody, ModalFooter, Container, Alert\n} from 'reactstrap';\n\nexport default () => {\n\t//app state\n\tconst {uiState, upload, dispatch} = useStoreon(\"uiState\", \"upload\");\n\n\tconst handleHideDialog = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"})\n\t}, [dispatch]);\n\n\tconst handleDone = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\t\n\t\tif (upload.continueUrl)\n\t\t\twindow.open(upload.continueUrl);\n\t\t\n\t\thandleHideDialog(e);\n\t}, [handleHideDialog, upload]);\n\n\tconst handleCancelExport = useCallback( e => {\n\t\te.preventDefault()\n\t\tconst endState = uiState.submode === \"getManifest\"\n\t\t\t? {mode: \"ready\"}\n\t\t\t: {mode: \"fileUpload\", submode: \"preUpload\"}\n\t\tdispatch(\"export/upload/cancel\");\n\t\tdispatch(\"uiState/set\", endState)\n\t}, [dispatch, uiState.submode]);\n\n\tconst handleUploadFile = useCallback( e => {\n\t\te.preventDefault()\t\n\t\tdispatch(\"export/upload/send\");\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode === \"preUpload\" || uiState.submode === \"postUpload\") {\n\t\t\t\thandleHideDialog(e);\n\t\t\t} else {\n\t\t\t\thandleCancelExport(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancelExport, handleHideDialog]);\n\n\tconst renderLoading = () => <ModalBody className=\"text-center\">\n\t\t<h5>\n\t\t\t{uiState.status}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancelExport}>Cancel</Button>\n\t\t</div>\n\t</ModalBody>\n\n\tconst renderError = () => <div>\n\t\t<ModalBody>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"danger\">\n\t\t\t\t\t<span>{uiState.status}</span>\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Close</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\tconst renderUploadDetails = () => <div>\n\t\t<ModalBody>\n\t\t\t<p>\n\t\t\t\tClicking the <b>upload</b> button below will share your medical record \n\t\t\tinformation with <b>{upload.name}</b> and indicates your agreement to the \n\t\t\tterms of use, privacy policy and other information outlined at \n\t\t\t\t<b>&nbsp;<a href={upload.infoUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t{upload.infoUrl}\n\t\t\t\t</a></b>.\n\t\t\t</p>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"success\" onClick={handleUploadFile}>Upload</Button>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Cancel</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\tconst renderPostUpload = () => <div>\n\t\t<ModalBody className=\"text-center\">\n\t\t\t<h5>{upload.successMessage || \"Your information has been transmitted!\"}</h5>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"primary\" onClick={handleDone}>\n\t\t\t\t{upload.continueUrl ? (upload.continueLabel || \"Continue\") : \"Close\"}\n\t\t\t</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\treturn  <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalHeader>Share My Data</ModalHeader>\n\t\t{uiState.submode === \"error\" && renderError()}\n\t\t{uiState.submode === \"getManifest\" && renderLoading()}\n\t\t{uiState.submode === \"preUpload\" && renderUploadDetails()}\n\t\t{uiState.submode === \"uploading\" && renderLoading()}\n\t\t{uiState.submode === \"postUpload\" && renderPostUpload()}\n\t</Modal>\n\n}","import React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport { Button } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\";\n\nexport default() => {\n\n\tconst {upload, dispatch} = useStoreon(\"upload\");\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Welcome</h4>\n\t\t<p>This app will walk you through the process of collecting digital copies of your medical records from healthcare institutions where you've received care and sharing them with {upload.name}. You can find additional information at <a href={upload.infoUrl} target=\"_blank\" rel=\"noopener noreferrer\">{upload.infoUrl}</a>.\n\t\t</p><p>You'll also have the option to download a copy of the data to this device to keep for yourself.</p>\n\t\t<Button color=\"success\" className=\"float-right mt-4\"\n\t\t\tonClick={ e => dispatch(\"uiState/set\", {mode: \"editProvider\" }) }\n\t\t>\n\t\t\t<span className=\"mr-2\">Get Started</span>\n\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t</Button>\n\t\t<div className=\"clearfix\"></div>\n\t</div>\n\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport { Button } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport Select, { createFilter } from \"react-select\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\t//app state\n\tconst {\n\t\tuiState, providers, credentials,\n\t\torganizations, orgDefaults, redirectUri, dispatch\n\t } = useStoreon(\n\t\t\"uiState\", \"providers\", \"credentials\",\n\t\t\"organizations\", \"orgDefaults\", \"redirectUri\"\n\t );\n\n\t//component state\n\tconst [provider, setProvider] = useState({});\t\n\n\tconst orgOptions = _.chain(organizations)\n\t\t.map( o => ({label: o.name, value: o.orgId || o.fhirEndpoint}) )\n\t\t.sortBy( o => o.label )\n\t\t.value();\n\n\tuseEffect( () => {\n\t\tif (!provider.id && uiState.id && uiState.mode === \"editProvider\") {\n\t\t\tconst currentProvider = providers.find(p => p.id === uiState.id);\n\t\t\tsetProvider(currentProvider)\n\t\t}\n\t}, [uiState.id, uiState.mode, provider.id, providers])\n\n\tconst handleSubmit = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/upsertAndLoad\", provider);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleSkip = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t}\n\n\tconst handleOrgSelection = (selection) => {\n\t\tlet orgConfig = organizations.find( \n\t\t\to => selection.value === o.orgId || selection.value === o.fhirEndpoint\n\t\t);\n\n\t\tconst defaults = orgDefaults[orgConfig.defaultId] || {};\n\t\tif (orgConfig.defaultId !== undefined) \n\t\t\torgConfig = {...defaults, ...orgConfig};\n\n\t\t//get credential details if included by reference\n\t\tif (orgConfig.credentialId)\n\t\t\torgConfig = {...credentials[orgConfig.credentialId], ...orgConfig};\n\n\t\t//update provider with new defaults\n\t\tsetProvider({\n\t\t\t...orgConfig,\n\t\t\tredirectUri,\n\t\t\tid: provider.id,\n\t\t\torgId: selection.value,\n\t\t\tqueryProfile: orgConfig.queryProfile || \"argonaut_spec\"\n\t\t});\n\t}\n\n\tconst renderOrgSelector = () => {\n\n\t\t//workaround since component uses both the value and label to match and we just want to store the value\n\t\tconst value = provider.orgId ? orgOptions.find(o => o.value === provider.orgId) : null;\n\n\t\treturn <Select id=\"organization\" autoFocus\n\t\t\t\t//performance improvement on autocomplete\n\t\t\t\tfilterOption={createFilter({ignoreAccents: false})}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={handleOrgSelection}\n\t\t\t\tisSearchable={true}\n\t\t\t\toptions={orgOptions}\n\t\t\t\tdefaultMenuIsOpen={true}\n\t\t\t/>\n\t}\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Select Your Provider</h4>\n\t\t<p>\n\t\t\tChoose a healthcare institution where you've received care from the list below.\n\t\t</p><p>\n\t\t\tIf you've been to multiple healthcare providers, after retrieving your records you'll have the option to return to this screen to select another institution.\n\t\t</p>\n\t\t{ renderOrgSelector() }\n\n\t\t<div className=\"d-flex\">\n\t\t\t<div className=\"align-self-end flex-grow-1 mt-4 pl-1\">\n\t\t\t\t{providers.length > 0 && <a href=\"#\" onClick={handleSkip}>skip</a>}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<Button color=\"success\" className=\"mt-4\"\n\t\t\t\t\tonClick={ handleSubmit } \n\t\t\t\t\tdisabled={provider.orgId ? false :true}\n\t\t\t\t>\n\t\t\t\t\t<span className=\"mr-2\">Login to Patient Portal</span>\n\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Spinner} from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronLeft } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { uiState, providers, dispatch } = useStoreon(\"uiState\", \"providers\");\n\n\tconst provider =  useMemo( () => {\n\t\treturn providers.find(p => p.id === uiState.id)\n\t}, [uiState.id, providers]);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/cancelLoad\", \"editProvider\");\n\t\tdispatch(\"providers/remove\", provider.id)\n\t}, [dispatch, provider]);\n\n\tconst handleBack = e => {\n\t\tdispatch(\"providers/remove\", provider.id)\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode  === \"authorizing\" || uiState.submode === \"loading\") {\n\t\t\t\thandleCancel(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel, uiState.submode]);\n\n\t//TODO: this is kind of a hack to build on non-wizard modes (need to restructure modes to work with both)\n\tif (uiState.mode !== \"loadData\") return null;\n\tif (uiState.submode === \"loaded\") {\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: provider.id,\n\t\t\tlastUpdated: new Date(),\n\t\t\tdata: uiState.data\n\t\t});\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t};\n\n\tconst renderWorking = (status) => <div className=\"p-4 text-center\">\n\t\t<h5 className=\"mb-4\">{status}</h5>\n\t\t<div className=\"my-4\">\n\t\t\t<Spinner color=\"primary\" style={{ width: \"3rem\", height: \"3rem\" }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button color=\"outline-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderGlobalError = () => <div className=\"p-2\">\n\t\t<h5>Error</h5>\n\t\t<p>An error occurred loading your record: {uiState.status}</p>\n\t\t<div>\n\t\t\t<Button color=\"primary\" className=\"mt-4\" onClick={handleBack}>\n\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Back</span>\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n\n\treturn <div>\n\t\t<h4>{provider.name}</h4>\n\t\t{ uiState.submode === \"authorizing\" && renderWorking(\"Waiting for Portal Login...\") }\n\t\t{ uiState.submode === \"loading\" && renderWorking(\"Retrieving Healthcare Records...\") }\n\t\t{ uiState.submode === \"error\" && renderGlobalError() }\n\t</div>\n\n\n}","import React, {useState} from \"react\";\nimport {Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faFileDownload } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default (props) => {\n\n\tconst { \n\t\tspreadsheetTemplates,\n\t\tnonModalUi,\n\t\tdispatch\n\t} = useStoreon(\n\t\t\"spreadsheetTemplates\",\n\t\t\"nonModalUi\"\n\t);\n\n\tconst [showDownloadOptions, setShowDownloadOptions] = useState(false);\n\n\tconst handelExportSpreadsheet = (templateId, format, e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/spreadsheet\", {templateId, format});\n\t}\n\n\tconst handleExportData = (e) => {\t\t\n\t\te.preventDefault();\n\t\tdispatch(\"export/download\");\n\t}\n\n\tlet menuItems = [\n\t\t<DropdownItem \n\t\t\tkey=\"fhir\" \n\t\t\tonClick={handleExportData}\n\t\t>FHIR Format</DropdownItem>\n\t];\n\n\t(Object.keys(spreadsheetTemplates) || []).forEach( templateId => {\n\t\tmenuItems.push(\n\t\t\t<DropdownItem \n\t\t\t\tkey={templateId + \"-xlsx\"} \n\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"xlsx\")}\n\t\t\t>\n\t\t\t\tSpreadsheet of {spreadsheetTemplates[templateId].name}\n\t\t\t</DropdownItem>\n\t\t)\n\t});\n\n\treturn <Dropdown \n\t\tclassName={props.className}\n\t\tstyle={{display: \"inline\",}}\n\t\tdisabled={nonModalUi.isExportingSheet}\n\t\tisOpen={showDownloadOptions}\n\t\ttoggle={e => setShowDownloadOptions(!showDownloadOptions)}\n\t>\n\t\t<DropdownToggle \n\t\t\tcolor=\"outline-secondary\" \n\t\t\tstyle={{margin: \"0 1rem 0 0\"}}\n\t\t\tcaret\n\t\t>\n\t\t<FontAwesomeIcon icon={faFileDownload} className=\"mr-2\" />\n\t\t\t<span className=\"mr-2\">Download copy of data</span>\n\t\t</DropdownToggle>\n\t\t<DropdownMenu>{menuItems}</DropdownMenu>\n\t</Dropdown>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport { Button } from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport DownloadButton from \"./DownloadButton\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\tconst {providers, upload, dispatch} = useStoreon(\"providers\", \"upload\");\n\n\tconst handleAddProvider = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\tconst handleFileUpload = e => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/upload/send\");\n\t}\n\n\tconst handleDeleteProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/remove\", id);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst renderProvider = (provider) => {\n\t\treturn <li key={provider.id}>\n\t\t\t{provider.name}{\" \"}\n\t\t\t(<a href=\"#\" onClick={e => handleDeleteProvider(provider.id, e)}>remove</a>)\n\t\t</li>\n\t};\n\n\tconst providerList = _.chain(providers)\n\t\t.sortBy( p => p.lastUpdated)\n\t\t.map(renderProvider)\n\t\t.value();\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Review Data to Share</h4>\n\t\t<p>You have collected records from the following healthcare providers:</p>\n\t\t<ul>{ providerList }</ul>\n\n\t\t<div className=\"d-md-flex\">\n\t\t\t<div className=\"align-self-end flex-grow-1 mt-4\">\n\t\t\t\t<DownloadButton />\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<Button color=\"success\" \n\t\t\t\t\tonClick={handleAddProvider}\n\t\t\t\t\tclassName=\"btn-block text-left mt-4\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"d-flex\">\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center flex-grow-1\">Add another provider</div>\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</Button>\n\t\t\t\t<Button color=\"success\" \n\t\t\t\t\tclassName=\"btn-block text-left mt-2\"\n\t\t\t\t\tdisabled={providerList.length === 0}\n\t\t\t\t\tonClick={handleFileUpload}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"d-flex\">\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center flex-grow-1\">\n\t\t\t\t\t\t\tShare with {upload.name}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport DownloadButton from \"./DownloadButton\";\nimport { Button, Spinner } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight, faChevronLeft } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\t//app state\n\tconst {uiState, upload, dispatch} = useStoreon(\"uiState\", \"upload\");\n\n\tconst handleBack = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"review\"})\n\t}, [dispatch]);\n\n\tconst handleDone = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tif (upload.continueUrl) \n\t\t\twindow.location.href = upload.continueUrl;\n\t}, [upload]);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"export/upload/cancel\");\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27 || uiState.submode === \"uploading\") return;\n\t\t\thandleCancel(e);\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancel, handleBack]);\n\n\tconst renderWorking = () => <div className=\"p-4 text-center\">\n\t\t<h5 className=\"mb-4\">{uiState.status || \"Preparing to send data\"}</h5>\n\t\t<div className=\"my-4\">\n\t\t\t<Spinner color=\"primary\" style={{ width: \"3rem\", height: \"3rem\" }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button color=\"outline-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderError = () => <div className=\"p-2\">\n\t\t<h5>Error</h5>\n\t\t<p>{uiState.status}</p>\n\t\t<div>\n\t\t\t<Button color=\"primary\" className=\"mt-4\" onClick={handleBack}>\n\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Back</span>\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderPostUpload = () => \t<div className=\"p-2\">\n\t\t<h5>Success</h5>\n\t\t<p>{\n\t\t\tupload.successMessage || \n\t\t\t(\"Your healthcare records have been successfully shared with \" + upload.name + \".\")\n\t\t}</p>\n\t\t<DownloadButton className=\"float-left mt-4\" />\n\t\t{upload.continueUrl &&\n\t\t\t<Button color=\"success\" className=\"float-right mt-4\" onClick={handleDone}>\n\t\t\t\t<span className=\"mr-2\">\n\t\t\t\t\t{ upload.continueLabel || \"Continue to \" + upload.name }\n\t\t\t\t</span>\n\t\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t\t</Button>\n\t\t}\n\t\t<div className=\"clearfix\"></div>\n\t</div>\n\n\treturn <div>\n\t\t{uiState.submode === \"error\" && renderError()}\n\t\t{uiState.submode !== \"postUpload\" && uiState.submode !== \"error\" && renderWorking()}\n\t\t{uiState.submode === \"postUpload\" && renderPostUpload()}\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport Start from \"./Start\";\nimport SelectProvider from \"./SelectProvider\";\nimport Retrieve from \"./Retrieve\";\nimport Review from \"./Review\";\nimport Upload from \"./Upload\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faMedkit, faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport {Row, Col} from \"reactstrap\";\n\nexport default() => {\n\t\n\t//app state\n\tconst {uiState, dispatch, appName} = useStoreon(\"uiState\", \"appName\");\n\n\tconst handleSwitchMode = () => dispatch(\"wizard/hide\");\n\n\tconst numberStyle = {\n\t\tactive: {background: \"#3182CE\", border: \"1px solid white\", color: \"white\"},\n\t\tinactive: {color: \"#3182CE\", border: \"1px solid #3182CE\", background: \"white\"}\n\t};\n\n\tconst switchToFull = uiState.mode !== \"loadData\" && \n\t\t(uiState.mode !== \"upload\" || uiState.submode === \"loaded\") &&\n\t\t<Row><Col className=\"text-center\">\n\t\t\t<small className=\"mt-4 float-right d-none d-sm-block\"><a href=\"#\" onClick={handleSwitchMode} className=\"text-muted\">switch to full version of Procure</a></small>\n\t\t</Col></Row>;\n\n\treturn <div>\n\t\t{switchToFull}\n\t\t<Row><Col>\n\t\t\t<h2 style={{color: \"#3182CE\", padding: \"1em 0\", textAlign: \"center\"}}>\n\t\t\t\t<FontAwesomeIcon icon={faMedkit} alt=\"Procure logo\" className=\"mr-2\" />\n\t\t\t\t<span>{appName || \"Procure\"}</span>\n\t\t\t</h2>\n\t\t</Col></Row>\n\t\t<Row><Col md={{size:10, offset: 1}} lg={{size:8, offset: 2}}>\n\t\t\t<div className=\"shadow p-4 mb-5 bg-white rounded unbox-sm\">\n\n\t\t\t\t<div className=\"d-none d-sm-block\">\n\t\t\t\t\t<div className=\"d-none d-flex flex-row justify-content-around mb-4\" style={{borderBottom: \"1px solid #3182CE\"}}>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"ready\" ? \"active\" : \"inactive\"], display: \"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">1</div>\n\t\t\t\t\t\t\t<div>Start</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"m-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"editProvider\" || uiState.mode ===\"loadData\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">2</div>\n\t\t\t\t\t\t\t<div>Retrieve Records</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"m-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"review\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">3</div>\n\t\t\t\t\t\t\t<div>Review</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"mr-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"fileUpload\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">4</div>\n\t\t\t\t\t\t\t<div>Share Records</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{ uiState.mode === \"ready\" && <Start /> }\n\t\t\t\t{ uiState.mode === \"editProvider\" && <SelectProvider /> }\n\t\t\t\t{ uiState.mode === \"loadData\" && <Retrieve /> }\n\t\t\t\t{ uiState.mode === \"review\" && <Review />}\n\t\t\t\t{ uiState.mode === \"fileUpload\" && <Upload />}\n\n\t\t\t</div>\n\n\t</Col></Row> \n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, {useEffect} from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Alert, Container, Row, Col} from 'reactstrap';\nimport _ from \"lodash\";\nimport ProviderForm from \"./ProviderForm\";\nimport ProviderList from \"./ProviderList\";\nimport Fetcher from \"./Fetcher\";\nimport Loader from \"./Loader\"\nimport GithubUploader from \"./GithubUploader\";\nimport Header from \"./Header\";\nimport FhirTree from \"./FhirTree\";\nimport Toolbar from \"./Toolbar\";\nimport BlankSlate from \"./BlankSlate\";\nimport FileUploader from \"./FileUploader\";\nimport Wizard from \"./Wizard/\";\n\nconst App = () =>  {\n\n\t//global state\n\tconst { uiState, showWizard, upload, providers, appName } = useStoreon(\"uiState\", \"upload\", \"showWizard\", \"providers\", \"appName\");\n\n\tuseEffect(() => {\n\t\tdocument.title = appName || \"Procure\";\n\t}, [appName]);\n\n\tif (uiState.mode === \"loading\") \n\t\treturn <Loader />;\n\n\tif (uiState.mode === \"globalError\")\n\t\treturn <Container style={{margin: \"1em\"}}>\n\t\t\t<Alert color=\"danger\">\n\t\t\t\t<span>Failed to load configuration information.</span><br />\n\t\t\t\t<span>{uiState.error.toString()}</span>\n\t\t\t</Alert>\n\t\t</Container>;\n\t\n\tconst inlineError = <Col xs=\"12\" style={{margin: \"0.5rem\"}}>\n\t\t<Alert color=\"warning\" style={{textAlign: \"center\"}}>{uiState.error}</Alert>\n\t</Col>\n\n\tconst renderProviderList = () => <Col xs=\"12\" md=\"6\" lg=\"5\" xl=\"4\">\n\t\t<ProviderList />\n\t</Col>\n\n\tconst renderData = (hasResources) => <Col xs=\"12\" md=\"6\" lg=\"7\" xl=\"8\">\n\t\t<Toolbar hasResources={hasResources} />\n\t\t{ hasResources && <FhirTree />\t}\t\n\t</Col>\n\n\tconst renderBlankSlate = () => <Col sm={{size: 4, offset: 4}}>\n\t\t<BlankSlate />\n\t</Col>\n\n\tconst hasProviders = providers && providers.length;\n\tconst hasData = hasProviders && _.find(providers, p => {\n\t\treturn p.selected && p.data && p.data.entry && (p.data.entry.length || p.data.errorLog.length);\n\t});\n\tconst hasResources = hasProviders && _.find(providers, p => {\n\t\treturn p.selected && p.data && p.data.entry && p.data.entry.length\n\t});\n\n\tconst fullUi = <div>\n\t\t<Header />\n\t\t<Container fluid>\n\t\t\t<Row className=\"m-2\">\n\t\t\t\t{ uiState.error && uiState.mode === \"ready\" && inlineError }\n\t\t\t\t{ hasProviders ? renderProviderList() : renderBlankSlate() }\n\t\t\t\t{ hasData ? renderData(hasResources) : null }\n\t\t\t</Row>\n\t\t\t{ uiState.mode === \"editProvider\" && <ProviderForm /> }\n\t\t\t{ uiState.mode === \"loadData\" && <Fetcher /> }\n\t\t\t{ uiState.mode === \"githubExport\" && <GithubUploader /> }\n\t\t\t{ uiState.mode === \"fileUpload\" && <FileUploader /> }\n\t\t</Container>\n\t</div>\n\n\tconst wizardUi = showWizard && \n\t\tupload && (upload.manifestUrl || upload.uploadUrl) &&\n\t\t\t<Container>\n\t\t\t{ uiState.error && uiState.mode === \"ready\" && \n\t\t\t\t<Row className=\"m-2\">{inlineError}</Row>\n\t\t\t}\t\n\t\t\t<Wizard />\n\t\t</Container>\n\n\tif (wizardUi) {\n\t\tdocument.body.classList.add(\"bg-light-md\");\n\t\treturn wizardUi;\n\t} else {\n\t\tdocument.body.classList = \"\";\n\t\treturn fullUi;\n\t}\n\n}\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n\n      //NOTE: changed from CRA default per https://github.com/facebook/create-react-app/issues/5673\n      const swUrl = `${process.env.PUBLIC_URL}/sw.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport StoreContext from 'storeon/react/context'\n//import 'bootstrap/dist/css/bootstrap.min.css';\n//moved to index.html to avoid flash of unstyled content when using dev server\nimport store from \"./store/store\";\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nstore.dispatch(\"config/load\", \"ready\");\n\nReactDOM.render(\n\t<StoreContext.Provider value={store}><App /></StoreContext.Provider>,\n\tdocument.getElementById('root')\n);\n\nserviceWorker.register();"],"sourceRoot":""}