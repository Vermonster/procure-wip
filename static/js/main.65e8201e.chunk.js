(this["webpackJsonpprocure-wip"]=this["webpackJsonpprocure-wip"]||[]).push([[0],{264:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","definitions":{"endpoint_item":{"type":"object","anyOf":[{"required":["fhirEndpoint","name"]},{"required":["FHIRPatientFacingURI","OrganizationName"]}],"properties":{"clientId":{"type":"string"},"clientSecret":{"type":"string"},"queryProfile":{"type":"string"},"isOpen":{"type":"boolean"},"scope":{"type":"array","items":{"type":"string"}},"fhirEndpoint":{"type":"string","format":"uri"},"patient":{"type":"string"},"OrganizationName":{"type":"string"},"FHIRPatientFacingURI":{"type":"string","format":"uri"}}}},"type":"object","anyOf":[{"required":["Entries"]},{"required":["entry"]}],"properties":{"Entries":{"type":"array","items":{"$ref":"#/definitions/endpoint_item"}}}}')},265:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","definitions":{"credentials":{"type":"object","additionalProperties":{"type":"object","required":["clientId"],"properties":{"clientId":{"type":"string"},"clientSecret":{"type":"string"}}}},"mime_type_mappings":{"type":"object","additionalProperties":{"type":"string","maxLength":4,"propertyNames":{"pattern":"^[-\\\\w]+/[-\\\\w+]+$"}}},"upload":{"type":"object","anyOf":[{"required":["whitelist"]},{"required":["manifestUrl"]},{"required":["name","uploadUrl","infoUrl"]}],"properties":{"whitelist":{"type":"array","items":{"type":"string","pattern":"^https?://.+"}},"name":{"type":"string"},"label":{"type":"string"},"manifestUrl":{"type":"string","format":"uri"},"uploadUrl":{"type":"string","format":"uri"},"infoUrl":{"type":"string","format":"uri"},"simulate":{"type":"boolean"},"successMessage":{"type":"string"},"continueLabel":{"type":"string"},"continueUrl":{"type":"string","format":"uri"}}},"date_sort_elements":{"type":"object","additionalProperties":{"type":"array","items":{"type":"string"}},"propertyNames":{"pattern":"^[A-Z][A-Za-z]*$"}},"endpoint_lists":{"type":"object","additionalProperties":{"$ref":"#/definitions/endpoint_list"}},"endpoint_list":{"type":"object","required":["path"],"properties":{"path":{"type":"string"},"defaults":{"$ref":"#/definitions/endpoint_list_default"}},"additionalProperties":false},"endpoint_list_default":{"type":"object","properties":{"clientId":{"type":"string"},"clientSecret":{"type":"string"},"queryProfile":{"type":"string"},"isOpen":{"type":"boolean"},"scope":{"type":"array","items":{"type":"string","pattern":"^(([-\\\\w]+/(\\\\*\\\\.)?[*-\\\\w+]+(\\\\.\\\\w+)?)|profile|openid|fhirUser|launch|offline_access|online_access)$"}},"fhirEndpoint":{"type":"string","format":"uri"},"patient":{"type":"string"}}},"query_profiles":{"type":"object","additionalProperties":{"$ref":"#/definitions/query_profile"}},"query_profile":{"type":"object","properties":{"title":{"type":"string"},"fhirVersion":{"type":"string","enum":["DSTU2","STU3","R2","R3","R4","R5"]},"retryLimit":{"type":"integer"},"queries":{"type":"array","minLength":1,"items":{"$ref":"#/definitions/query"}}},"additionalProperties":false},"query":{"type":"object","required":["resourcePath"],"properties":{"title":{"type":"string"},"resourcePath":{"type":"string"},"params":{"type":"object","additionalProperties":{"type":["string","array","integer","number"],"item":{"type":"string"}}},"retrieveReferences":{"type":["array","string"],"items":{"type":"string"}},"containReferences":{"type":["array","string"],"items":{"type":"string"}},"downloadAttachments":{"type":["array","string"],"items":{"type":"string"}},"pageLimit":{"type":"integer"}},"additionalProperties":false},"template_item":{"type":"object","properties":{"path":{"type":["array","string"],"items":{"type":"string"}},"test":{"type":"string"},"id":{"type":"string"},"transform":{"type":"string"},"children":{"type":"array","minLength":1,"items":{"$ref":"#/definitions/template_item"}}}},"spreadsheet_template":{"additionalProperties":false,"type":"object","required":["name","template"],"properties":{"name":{"type":"string"},"extends":{"type":"array","items":{"type":"string"}},"sortBy":{"type":"array","items":{"type":"object","required":["name","dir"],"additionalProperties":false,"properties":{"name":{"type":"string"},"dir":{"type":"string","enum":["asc","desc"]}}}},"template":{"type":"array","minLength":1,"items":{"$ref":"#/definitions/template_item"}}}},"spreadsheet_templates":{"type":"object","additionalProperties":{"$ref":"#/definitions/spreadsheet_template"}}},"type":"object","required":["queryProfiles"],"additionalProperties":false,"properties":{"appName":{"type":"string"},"noCustomEndpoints":{"type":"boolean"},"credentials":{"$ref":"#/definitions/credentials"},"mimeTypeMappings":{"$ref":"#/definitions/mime_type_mappings"},"dateSortElements":{"$ref":"#/definitions/date_sort_elements"},"upload":{"$ref":"#/definitions/upload"},"redirectUri":{"type":["string","null"],"format":"uri"},"showWizard":{"type":"boolean"},"endpointLists":{"$ref":"#/definitions/endpoint_lists"},"queryProfiles":{"$ref":"#/definitions/query_profiles"},"spreadsheetTemplates":{"$ref":"#/definitions/spreadsheet_templates"},"warnOnPageNavigate":{"type":"boolean"},"ignoreState":{"type":"boolean"}}}')},267:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","type":"object","required":["name","uploadUrl","infoUrl"],"additionalProperties":false,"properties":{"name":{"type":"string"},"uploadUrl":{"type":"string","format":"uri"},"infoUrl":{"type":"string","format":"uri"},"successMessage":{"type":"string"},"continueLabel":{"type":"string"},"continueUrl":{"type":"string","format":"uri"}}}')},269:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","definitions":{"provider_secure":{"type":"object","required":["id","fhirEndpoint","orgId","name","queryProfile","redirectUri","scope"],"properties":{"isOpen":{"type":"boolean","enum":[false]},"id":{"type":["string","number"]},"name":{"type":"string"},"clientId":{"type":"string"},"clientSecret":{"type":"string"},"queryProfile":{"type":"string"},"orgId":{"type":"string"},"selected":{"type":"boolean"},"redirectUri":{"type":"string"},"scope":{"type":"array","items":{"type":"string","pattern":"^[-\\\\w]+/(\\\\*\\\\.)?[*-\\\\w+]+(\\\\.\\\\w+)?$"}},"fhirEndpoint":{"type":"string","format":"uri"}}},"provider_open":{"type":"object","required":["id","fhirEndpoint","orgId","name","queryProfile","redirectUri","scope","patient"],"properties":{"isOpen":{"type":"boolean","enum":[true]},"id":{"type":["string","number"]},"name":{"type":"string"},"clientId":{"type":"string"},"queryProfile":{"type":"string"},"orgId":{"type":"string"},"selected":{"type":"boolean"},"patient":{"type":"string"},"scope":{"type":"array","items":{"type":"string","pattern":"^[-\\\\w]+/(\\\\*\\\\.)?[*-\\\\w+]+(\\\\.\\\\w+)?$"}},"fhirEndpoint":{"type":"string","format":"uri"}}},"providers":{"type":"array","items":{"oneOf":[{"$ref":"#/definitions/provider_open"},{"$ref":"#/definitions/provider_secure"}]}},"github_config":{"type":"object","additionalProperties":false,"properties":{"token":{"type":"string"},"owner":{"type":"string"},"project":{"type":"string"}}}},"type":"object","required":["redirectUri","providers","githubConfig"],"additionalProperties":false,"properties":{"providers":{"$ref":"#/definitions/providers"},"redirectUri":{"type":"string","format":"uri"},"githubConfig":{"$ref":"#/definitions/github_config"}}}')},281:function(e,t,r){e.exports=r(545)},293:function(e,t){},295:function(e,t){},344:function(e,t){},369:function(e,t){},370:function(e,t){},413:function(e,t){e.exports={uiState:{mode:"loading"},spreadsheetTemplates:{},isDirty:!1,nonModalUi:{},queryProfile:{},mimeTypeMappings:{},githubConfig:{},upload:{},providers:[]}},545:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(43),i=r.n(o),l=r(160),c=r.n(l),s=r(11),u=r(263),d=r.n(u),f=r(50),m=r(51),p=r(111),h=r.n(p),g=r(4),v=r.n(g);function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DSTU2",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(t||(t={}),t.headers||(t.headers={}),!t.headers.Accept){var i="DSTU2"===r.toUpperCase()||"R2"===r.toUpperCase();t.headers.Accept=i?"application/json+fhir":"application/fhir+json"}return n&&(t.headers.Authorization="Bearer ".concat(n)),fetch(e,t).then((function(e){if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e})).then((function(e){return e.json()})).then((function(t){if(!t.resourceType||"OperationOutcome"===t.resourceType){var r=t.issue&&t.issue[0]&&t.issue[0].diagnostics;throw new Error(r||"Fetch failed for "+e)}return t})).catch((function(i){if(a&&o<a)return y(e,t,r,n,a,o+1);throw i}))}function E(e,t,r){if("string"===typeof e&&(e=e.split(".")),t){var n=t[e[0]],a=e.slice(1);if(a.length||void 0===n)void 0!==n&&(Array.isArray(n)?n:[n]).forEach((function(e){return E(a,e,r)}));else{var o=r(n);void 0!==o&&(t[e[0]]=o)}return t}}function b(e,t){if("string"===typeof e&&(e=e.split(".")),!t)return[];var r=t[e[0]]||[];Array.isArray(r)||(r=[r]);var n=e.slice(1);return n.length?r.map((function(e){return b(n,e)})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return void 0!==e})):r}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return/^http/.test(t)?t:e.replace(/\/*$/,"/")+t}function k(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"R2";return e.meta=e.meta||{},"STU4"===r.toUpperCase()||"R4"===r.toUpperCase()?e.meta.source=e.meta.source||t:(e.meta.extension=e.meta.extension||[],e.meta.extension.push({url:"http://hl7.org/fhir/4.0/StructureDefinition/extension-Meta.source",valueUri:t})),e}function C(e){var t=e.urls,r=void 0===t?[]:t,n=e.fhirVersion,a=e.retryLimit,o=e.token,i=e.allowErrors,l=e.signal,c=e.statusCallback;return Promise.all(v.a.map(r,(function(e){return c&&c(e),y(e,{signal:l},n,o,a).then((function(t){return{fullUrl:e,resource:t}})).catch((function(t){if(!i||"AbortError"===t.name)throw t;return c&&c(e,!0),{fullUrl:e,error:t.message,requestType:"reference"}}))}))).then((function(e){var t=e.filter((function(e){return e.error})),r=e.filter((function(e){return!e.error}));return i?{entry:r,errorLog:t}:r}))}function j(e){var t=e.entry,r=void 0===t?[]:t,n=e.paths,a=void 0===n?[]:n,o=e.fhirEndpoint;return a=(a=Array.isArray(a)?a:[a]).map((function(e){return/\.reference$/.test(e)?e:e+".reference"})),v.a.reduce(r,(function(e,t,r){return v.a.each(a,(function(n){v.a.each(b(n,t.resource),(function(t){if(!/^#/.test(t)){var a=w(o,t);e[a]=e[a]||[],e[a].push({i:r,path:n,rawUrl:t})}}))})),e}),{})}function O(e){var t=e.entry,r=void 0===t?[]:t,n=e.refEntry,a=void 0===n?[]:n,o=e.refIndex,i=void 0===o?{}:o;return v.a.each(a,(function(e){var t;v.a.each(i[e.fullUrl]||[],(function(n){t||((t=r[n.i].resource).contained=r[n.i].resource.contained||[],t.contained.push(e.resource)),E(n.path,t,(function(t){if(t===n.rawUrl)return"#"+e.resource.id}))}))})),r}function U(e){var t=e.entry,r=void 0===t?[]:t,n=e.paths,a=void 0===n?[]:n,o=e.fhirEndpoint;return a=Array.isArray(a)?a:[a],v.a.reduce(r,(function(e,t){return v.a.each(a,(function(r){v.a.each(b(r,t.resource),(function(t){if(t.url&&!t.data){var r=w(o,t.url),n=t.contentType||"";e[r+"::"+n||""]=e[r+"::"+n||""]||{contentType:t.contentType,url:r,rawUrl:t.url,count:0},e[r+"::"+n||""].count+=1}}))})),e}),{})}var S={fetchFHIR:y,replaceValue:E,pathToValues:b,findReferences:j,embedReferences:O,findAttachments:U,getResourcesByQuery:function(e){var t=e.fhirEndpoint,r=e.query,n=void 0===r?{}:r,a=e.retryLimit,o=void 0===a?0:a,i=e.token,l=e.signal,c=e.allowErrors,s=e.statusCallback,u=[];return new Promise((function(e,r){var a;!function a(d){var f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;s&&s(d),y(d,{signal:l},n.fhirVersion,i,o).then((function(r){if("Bundle"!==r.resourceType)return r=k(r,t,n.fhirVersion),e({query:n,entry:[{resource:r,fullUrl:d}]});u=u.concat((r.entry||[]).filter((function(e){return"OperationOutcome"!==e.resource.resourceType})).map((function(e){return e.resource=k(e.resource,t,n.fhirVersion),e.fullUrl=w(t,e.resource.resourceType+"/"+e.resource.id),e})));var o=r.link&&r.link.find((function(e){return"next"===e.relation}));return o&&(!n.pageLimit||m<n.pageLimit)?a(o.url,f,m+1):e({entry:u,query:n})})).catch((function(t){c&&"AbortError"!==t.name?(s&&s(d,!0),e({errorLog:[{fullUrl:d,error:t.message,requestType:"query"}],entry:[],errorCount:1})):r(t)}))}(t.replace(/\/*$/,"/")+(n.resourcePath||"")+(Object.keys(n.params||{}).length?(a=n.params,"?"+Object.keys(a).map((function(e){var t=Array.isArray(a[e])?a[e].join(","):a[e];return e+"="+encodeURIComponent(t)})).join("&")):""))}))},followAndEmbedReferences:function(e){var t=e.entry,r=void 0===t?[]:t,n=e.paths,a=void 0===n?[]:n,o=e.fhirEndpoint,i=e.fhirVersion,l=e.retryLimit,c=void 0===l?0:l,s=e.token,u=e.allowErrors,d=e.signal,f=e.statusCallback,m=j({entry:r,paths:a,fhirEndpoint:o});return C({urls:v.a.keys(m),fhirVersion:i,retryLimit:c,token:s,allowErrors:u,signal:d,statusCallback:f}).then((function(e){var t=u?e.entry:e,n=O({entry:r,refEntry:t,refIndex:m});return u?{entry:n,errorLog:e.errorLog}:n}))},followReferences:function(e){var t=e.entry,r=void 0===t?[]:t,n=e.paths,a=void 0===n?[]:n,o=e.fhirEndpoint,i=e.fhirVersion,l=e.retryLimit,c=void 0===l?0:l,s=e.token,u=e.allowErrors,d=e.signal,f=e.statusCallback,m=j({entry:r,paths:a,fhirEndpoint:o});return C({urls:v.a.keys(m),fhirVersion:i,retryLimit:c,token:s,allowErrors:u,signal:d,statusCallback:f}).then((function(e){return u&&(e.errorCount=v.a.reduce(e.errorLog,(function(e,t){return e+m[t.fullUrl].length}),0)),e}))},findAndDownloadAttachments:function(e){var t=e.entry,r=void 0===t?[]:t,n=e.paths,a=void 0===n?[]:n,o=e.fhirEndpoint,i=e.token,l=e.allowErrors,c=e.retryLimit,s=void 0===c?0:c,u=e.signal,d=e.statusCallback,f=e.mimeTypeMappings,m=void 0===f?{}:f,p=U({entry:r,paths:a,fhirEndpoint:o}),h=0;return Promise.all(v.a.map(p,(function(e){var t={signal:u,headers:{Authorization:i?"Bearer ".concat(i):void 0,Accept:e.contentType||void 0}};return d&&d(e.url),function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return fetch(t,r).then((function(e){if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e})).catch((function(o){if(n&&a<n)return e(t,r,n,a+1);throw o}))}(e.url,t,s).then((function(e){return e.blob()})).then((function(t){var r=e.url.match(/\.(.{3})$|\.(.{4})$/),n=e.contentType&&m[e.contentType],a=r&&r[1]||n;return{fileName:(h+=1).toString()+(a?"."+a:""),fullUrl:e.url,blob:t,contentType:e.contentType,rawUrl:e.rawUrl}})).catch((function(t){if(!l||"AbortError"===t.name)throw t;return d&&d(e.url,!0),{fullUrl:e.url,contentType:e.contentType,error:t.message,requestType:"attachment",rawUrl:e.rawUrl}}))}))).then((function(e){if(!l)return e;var t=e.filter((function(e){return e.error})),r=v.a.reduce(t,(function(e,t){return e+p[t.fullUrl+"::"+t.contentType||""].count}),0),n=e.filter((function(e){return!e.error}));return l?{files:n,errorLog:t,errorCount:r}:n}))},attachmentsToFilenames:function(e){var t=e.entry,r=void 0===t?[]:t,n=e.files,a=void 0===n?[]:n,o=e.paths;return o=Array.isArray(o)?o:[o],v.a.each(r,(function(e){v.a.each(o,(function(t){e.resource=E(t,e.resource,(function(e){var t=a.find((function(t){return t.rawUrl===e.url&&t.contentType===e.contentType}));if(t)return Object(s.a)({},e,{url:t.fileName})}))}))})),r}},x="Authorization endpoint or token endpoint not found";function P(e){return fetch(e+".well-known/smart-configuration").then((function(e){if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e})).then((function(e){return e.json()})).then((function(e){var t={registrationEndpoint:e.registration_endpoint,authorizationEndpoint:e.authorization_endpoint,tokenEndpoint:e.token_endpoint};if(t.authorizationEndpoint&&t.tokenEndpoint)return t;throw x})).catch((function(e){throw x}))}function N(e){var t=e+"metadata";return S.fetchFHIR(t).then((function(e){var t=(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(t=t.trim())?t.split(".").reduce((function(e,t){return e?e[t]:void 0}),e):e}(e||{},"rest.0.security.extension")||[]).filter((function(e){return"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris"===e.url})).map((function(e){return e.extension}))[0],r={};if(t&&t.forEach((function(e){"register"===e.url&&(r.registrationEndpoint=e.valueUri),"authorize"===e.url&&(r.authorizationEndpoint=e.valueUri),"token"===e.url&&(r.tokenEndpoint=e.valueUri)})),r.authorizationEndpoint&&r.tokenEndpoint)return r;throw x})).catch((function(e){throw x}))}var T={getWellKnownEndpoints:P,getCapabilityEndpoints:N,getAuthEndpoints:function(e){var t=e.replace(/\/*$/,"/");return new Promise((function(e,r){P(t).then((function(t){return e(t)})).catch((function(n){N(t).then((function(t){return e(t)})).catch((function(e){return r(x)}))}))}))},buildQs:function(e){return"?"+Object.keys(e).map((function(t){var r=Array.isArray(e[t])?e[t].join(","):e[t];return t+"="+encodeURIComponent(r)})).join("&")},buildAuthorizeUrl:function(e,t,r,n,a,o,i,l){Array.isArray(n)&&(n=n.join(" "));var c=["response_type=code","client_id="+encodeURIComponent(o),"scope="+encodeURIComponent(n),"redirect_uri="+encodeURIComponent(a),"aud="+encodeURIComponent(t),"state="+r];return l&&c.push("launch="+encodeURIComponent(l)),i&&c.push("client_secret="+encodeURIComponent(i)),e+"?"+c.join("&")},exchangeCodeForToken:function(e,t,r,n,a){var o={method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},body:["grant_type=authorization_code","code="+encodeURIComponent(t),"redirect_uri="+encodeURIComponent(r)].join("&")};return a?o.headers.Authorization="Basic ".concat(btoa("".concat(n,":").concat(a))):o.body+="&client_id="+encodeURIComponent(n),fetch(e,o)},refreshToken:function(e,t){return fetch(e,{method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},mode:"cors",body:["grant_type=refresh_token","refresh_token="+encodeURIComponent(t)].join("&")})},generateStateParam:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=[];e--;)r.push(t.charAt(Math.floor(Math.random()*t.length)));return r.join("")}},D=function(){function e(t){Object(f.a)(this,e),this.provider=t,this.authWindow=window.open("","_blank"),this.authWindow.document.write("Loading...")}return Object(m.a)(e,[{key:"parseQs",value:function(e){var t=e.split("&"),r={};return t.forEach((function(e){e=e.split("="),r[e[0]]=decodeURIComponent(e[1]||"")})),r}},{key:"cancel",value:function(){this.reject&&(clearInterval(this.popupPoll),window.removeEventListener("message",this.messageListener),this.authWindow.close(),this.reject(new Error("cancelled")))}},{key:"authorize",value:function(e,t){var r=this;return new Promise((function(n,a){r.reject=a;var o=T.generateStateParam();r.popupPoll=setInterval((function(){r.authWindow.closed&&(clearInterval(r.popupPoll),window.removeEventListener("message",r.messageListener),a(new Error("Login window closed by user")))}),500);var i=T.buildAuthorizeUrl(e.authorizationEndpoint,r.provider.fhirEndpoint,o,r.provider.scope,r.provider.redirectUri,r.provider.clientId);r.messageListener=window.addEventListener("message",(function(i){if(i.origin===window.location.origin&&"string"===typeof i.data){clearInterval(r.popupPoll),window.removeEventListener("message",r.messageListener),r.authWindow.close();var l=r.parseQs(i.data);l.error?a(l.error):l.code&&!0!==t&&l.state!==o?a("Invalid state parameter returned by server"):l.code?T.exchangeCodeForToken(e.tokenEndpoint,l.code,r.provider.redirectUri,r.provider.clientId,r.provider.clientSecret).then((function(e){return e.json()})).then((function(e){e.access_token?n(e):(console.log(e),a("No access token in server token response"))})):a("Failed to retrieve code parameter")}}),!1),r.authWindow.location.href=i}))}}]),e}(),L=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"resetAbortController",value:function(){this.controller=new AbortController,this.signal=this.controller.signal}},{key:"cancel",value:function(){this.popup?this.popup.cancel():this.controller.abort()}},{key:"mergeAndDeDupeData",value:function(e){var t={},r=[],n=[],a=[],o=0;return e.forEach((function(e){e.entry.forEach((function(e){t[e.fullUrl]||(t[e.fullUrl]=!0,n.push(e))})),r=r.concat(e.files||[]),a=a.concat(e.errorLog||[]),o+=e.errorCount||0})),{entry:n,files:r,errorLog:a,errorCount:o}}},{key:"getFHIR",value:function(e,t,r){var n=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,c=r?r.patient:e.patient,u=function(u){var d=Object(s.a)({},u.params);Object.keys(d).forEach((function(e){Array.isArray(d[e])&&(d[e]=d[e].join(",")),d[e]=d[e].toString().replace("{{patientId}}",c)}));var f=u.resourcePath.replace(/\{\{patientId\}\}/g,c);return S.getResourcesByQuery({fhirEndpoint:e.fhirEndpoint,query:Object(s.a)({},u,{params:d,resourcePath:f,fhirVersion:t.fhirVersion}),token:r?r.access_token:null,retryLimit:i,allowErrors:a,statusCallback:l,signal:n.signal}).then((function(o){return u.containReferences?S.followAndEmbedReferences({entry:o.entry,paths:u.containReferences,fhirEndpoint:e.fhirEndpoint,fhirVersion:t.fhirVersion,token:r?r.access_token:null,retryLimit:i,allowErrors:a,statusCallback:l,signal:n.signal}).then((function(e){return o.errorLog=o.errorLog||[],o.errorLog=o.errorLog.concat(e.errorLog),o.errorCount=o.errorCount||0,o.errorCount+=e.errorCount,o.entry=e.entry,o})):o})).then((function(o){return u.retrieveReferences?S.followReferences({entry:o.entry,paths:u.retrieveReferences,fhirEndpoint:e.fhirEndpoint,fhirVersion:t.fhirVersion,token:r?r.access_token:null,retryLimit:i,allowErrors:a,statusCallback:l,signal:n.signal}).then((function(e){return o.errorLog=o.errorLog||[],o.errorLog=o.errorLog.concat(e.errorLog),o.errorCount=o.errorCount||0,o.errorCount+=e.errorCount,o.entry=o.entry.concat(e.entry),o})):o})).then((function(a){return u.downloadAttachments?S.findAndDownloadAttachments({entry:a.entry,paths:u.downloadAttachments,fhirEndpoint:e.fhirEndpoint,fhirVersion:t.fhirVersion,token:r?r.access_token:null,retryLimit:i,mimeTypeMappings:o,allowErrors:!0,statusCallback:l,signal:n.signal}).then((function(e){return a.errorLog=a.errorLog||[],a.errorLog=a.errorLog.concat(e.errorLog||[]),a.errorCount=a.errorCount||0,a.errorCount+=e.errorCount,a.files=e.files,a.entry=S.attachmentsToFilenames({entry:a.entry,files:e.files,paths:u.downloadAttachments}),a})):a}))};return this.resetAbortController(),Promise.all(t.queries.map(u)).then(this.mergeAndDeDupeData)}},{key:"authAndGetFHIR",value:function(e,t){var r=this;return this.popup=new D(e),T.getAuthEndpoints(e.fhirEndpoint).then((function(e){return r.popup.authorize(e,t)})).then((function(e){return r.popup=null,e})).catch((function(e){throw r.popup=null,e}))}}]),e}(),A=r(165),I=r.n(A),R=r(29),q=r.n(R),_=r(264),z=r(265),F=r(266),M=r.n(F),B=r(267),$=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"cancel",value:function(){this.controller.abort()}},{key:"resetCancelled",value:function(){this.controller=new AbortController,this.signal=this.controller.signal}},{key:"isValidUrl",value:function(e,t){return void 0!==v.a.find(t,(function(t){return M()(e,t)}))}},{key:"getManifest",value:function(e){this.resetCancelled();var t={signal:this.signal,accept:"application/json"};return fetch(e,t).then((function(e){if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e})).then((function(e){return e.json()})).then((function(t){if(q.a.validate(t,B),q.a.error)throw console&&console.log(q.a.error),new Error(e+": "+q.a.error.message);return t}))}},{key:"putFile",value:function(e,t){this.resetCancelled();var r={signal:this.signal,method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:t};return fetch(e,r).then((function(e){if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e})).then((function(e){var t=e.headers.get("content-type");return t&&-1!==t.indexOf("application/json")?e.json():{}})).then((function(e){if(e.error)throw new Error(e.error)})).catch((function(e){throw console.log(e),"AbortError"===e.name?e:new Error("An error occurred sending your data: ".concat(e.message))}))}}]),e}();var H={merge:function(e){var t=function(e,t){return v.a.each(t,(function(t){var n=t.id?v.a.findIndex(e,(function(e){return e.id===t.id})):-1;t._?n>-1&&e.splice(n,1):n>-1?e[n]=r(e[n],t):e.push(t)})),e},r=function e(r,n){return v.a.each(v.a.keys(n),(function(a){"_"===a[0]?r[a.slice(1)]=n[a]:void 0===r[a]?r[a]=n[a]:v.a.isPlainObject(n[a])&&n[a]._?delete r[a]:v.a.isPlainObject(n[a])?r[a]=e(r[a],n[a]):v.a.isArray(r[a])&&v.a.isArray(n[a])?r[a]=t(r[a],n[a]):r[a]=n[a]})),r},n=JSON.parse(JSON.stringify(e[0]));return v.a.each(e,(function(e,a){0!==a&&(e=JSON.parse(JSON.stringify(e)),n=v.a.isPlainObject(n)&&v.a.isPlainObject(e)?r(n,e):v.a.isArray(n)&&v.a.isArray(e)?t(n,e):e)})),n}};function V(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function W(e,t){return h()(e,{headers:{Accept:"application/json"}}).then((function(r){if(!r.ok&&!t)throw new Error("".concat(e," - HTTP ").concat(r.status," - ").concat(r.statusText));return!r.ok&&t&&(r={text:function(){return"{}"}}),r})).then((function(e){return e.text()})).then((function(t){try{return JSON.parse(I()(t))}catch(r){throw console.log(r),new Error("".concat(e," is not valid JSON."))}}))}var J={loadConfigFile:function(e,t,r){var n=[W(e)],a=V("config");return a&&r?n.push(W(a,!0)):t&&n.push(W(t,!0)),Promise.all(n).then((function(e){return H.merge(e)})).then((function(t){if(q.a.validate(t,z),q.a.error)throw console&&console.log(q.a.error),new Error(e+": "+q.a.error.message);return t})).then((function(t){if(!t.endpointLists)return t;var r=v.a.find(v.a.keys(t.endpointLists)||[],(function(e){var r=t.endpointLists[e];return r&&r.defaults&&r.defaults.queryProfile&&!t.queryProfiles[r.defaults.queryProfile]}));if(r)throw new Error("Invalid query profile in endpoint "+e+": /endpointLists/"+r+"/defaults");var n=v.a.find(v.a.keys(t.endpointLists)||[],(function(e){var r=t.endpointLists[e];return r&&r.defaults&&r.defaults.credentialId&&!t.credentials[r.defaults.credentialId]}));if(n)throw new Error("Invalid credential id in endpoint "+e+": /endpointLists/"+n+"/defaults");return t})).then((function(e){if(!e.spreadsheetTemplates)return e;var t=Object.keys(e.spreadsheetTemplates);return t.forEach((function(r){(e.spreadsheetTemplates[r].extends||[]).forEach((function(e){if(-1===t.indexOf(e))throw new Error("Invalid base template name in '"+r+"'")}))})),e})).then((function(e){return e.endpointLists?function(e){return Promise.all(v.a.map(e.endpointLists,(function(t,r){return function(t,r){if(t.path)return h()(t.path,{headers:{Accept:"application/json"}}).then((function(e){if(!e.ok)throw new Error("".concat(t.path," - HTTP ").concat(e.status," - ").concat(e.statusText));return e})).then((function(e){return e.text()})).then((function(e){try{return JSON.parse(I()(e))}catch(r){throw console.log(r),new Error("".concat(t.path," is not valid JSON."))}})).then((function(e){if(q.a.validate(e,_),q.a.error)throw console&&console.log(q.a.error),new Error(t.path+": "+q.a.error.message);return e})).then((function(r){return(r.entry||r.Entries||[]).forEach((function(r){if(r.queryProfile&&!e.queryProfiles[r.queryProfile])throw new Error("Invalid query profile in endpoint list "+t.path+" - "+r.queryProfile)})),(r.entry||r.Entries||[]).forEach((function(r){if(r.credentialId&&!e.credentials[r.credentialId])throw new Error("Invalid credential id endpoint list "+t.path+" - "+r.credentialId)})),r})).then((function(e){return(e.Entries||e.entry).map((function(e){var n=Object(s.a)({},e);return n.OrganizationName&&(n.name=n.OrganizationName,delete n.OrganizationName),n.FHIRPatientFacingURI&&(n.fhirEndpoint=n.FHIRPatientFacingURI,delete n.FHIRPatientFacingURI),n.id&&(n.orgId=n.id,delete n.id),t.defaults&&(n.defaultId=r),n}))})).catch((function(e){if(e.message)throw e;throw new Error("Error reading "+t.path)}))}(t,r)}))).then((function(t){var r=[].concat.apply([],t),n=v.a.mapValues(e.endpointLists,(function(e){return e.defaults}));return Object(s.a)({},e,{orgDefaults:n,organizations:r,endpointLists:null})}))}(e):e})).then((function(e){return e.redirectUri=e.redirectUri||window.location.href.split(/\?|#/)[0].replace(/\/*$/,"/callback.html"),e})).then((function(e){return function(e){var t=V("upload_manifest_url");t&&(e.upload=e.upload||{},e.upload.manifestUrl=t,e.upload.qsManifestUrl=!0);var r=V("upload_label");return r&&(e.upload=e.upload||{},e.upload.label=r),V("wizard")&&(e.showWizard=!0),e}(e)})).then((function(e){if(!e.showWizard||e.upload&&!e.upload.manifestUrl)return e;if(!e.upload||!e.upload.manifestUrl&&!e.upload.uploadUrl)throw new Error("Upload configuration required for wizard mode");var t=new $;if(e.upload.qsManifestUrl&&!t.isValidUrl(e.upload.manifestUrl,e.upload.whitelist))throw new Error("Url manifest location not in whitelist: "+e.upload.manifestUrl);return t.getManifest(e.upload.manifestUrl).then((function(t){return e.upload=Object(s.a)({},e.upload,{},t),e})).catch((function(t){throw new Error("Unable to load manifest at "+e.upload.manifestUrl)}))}))}},G=r(64),Q=r.n(G),Y=r(95),Z=r.n(Y),K=r(42),X=r.n(K);function ee(e,t){var r=v.a.chain(t.data.entry).groupBy((function(e){return e.resource.resourceType})).mapValues((function(e){return{entry:v.a.map(e,(function(e){return{fullUrl:e.fullUrl,resource:e.resource}})),total:e.length,type:"collection"}})).value();v.a.each(r,(function(t,r){e.file(r+".json",JSON.stringify(t,null,2))})),v.a.each(t.data.files,(function(t){e.file(t.fileName,t.blob,{type:"blob"})})),t.data.errorLog.length&&e.file("error_log.json",JSON.stringify(t.data.errorLog,null,2))}function te(e){return new Promise((function(t,r){var n=new Z.a;e.filter((function(e){return e.data&&e.selected})).forEach((function(e){ee(n.folder(Q()(e.name)),e)})),n.generateAsync({type:"blob"}).then(t).catch(r)}))}var re={generateFile:function(e,t){var r,n=v.a.filter(e,(function(e){return e.data&&e.data.entry&&e.selected&&(e.data.entry.length||e.data.errorLog.length)}));return n.length>1?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"procure-data.zip";return te(e).then((function(e){return Object(K.saveAs)(e,t)}))}(n,t):(r=n[0],new Promise((function(e,t){var n=new Z.a;ee(n,r);var a=Q()(r.name);n.generateAsync({type:"blob"}).then((function(e){return Object(K.saveAs)(e,a)})).then(e).catch(t)})))},exportProvidersAsBlob:te};function ne(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",n=arguments.length>3?arguments[3]:void 0,a={headers:{Authorization:"Bearer ".concat(e.token)},method:r};n&&(a.body=JSON.stringify(n));var o="".concat(e.baseUrl||"https://api.github.com","/repos/").concat(e.owner,"/").concat(e.project,"/").concat(t);return fetch(o,a).then((function(e){if(e.ok)return e.json();if(404===e.status)throw new Error("Repository not found");if(500===e.stats)throw new Error(e.message||"Github API returned a 500 error");return e.json().then((function(e){throw new Error(e.message)}))}))}var ae={getLastCommit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"master";return ne(e,"git/refs/heads/".concat(t)).catch((function(e){throw"Git Repository is empty."===e.message&&(e.message="Git repository is empty. Please initialize the repository and try again."),e}))},getTree:function(e,t){return ne(e,"git/trees/".concat(t.object.sha)).then((function(e){if(e.truncated)throw new Error("Unable to load entire head tree - too many files");return e})).catch((function(e){if("Repository not found"===e.message)return{tree:[]}}))},createBlob:function(e,t){return ne(e,"git/blobs","POST",t)},createTree:function(e,t){return ne(e,"git/trees","POST",t)},commitTree:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"master";return ne(e,"git/commits","POST",{message:r,tree:t.sha,parents:[n.object.sha]}).then((function(t){return ne(e,"git/refs/heads/".concat(a),"PATCH",{sha:t.sha})}))},commitTreeToPullRequest:function(e,t,r,n,a,o){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"master",l=arguments.length>7?arguments[7]:void 0;return ne(e,"git/commits","POST",{message:r,tree:t.sha,parents:[n.object.sha]}).then((function(t){return ne(e,"git/refs","POST",{ref:"refs/heads/".concat(o),sha:t.sha})})).then((function(){return ne(e,"pulls","POST",{title:a,body:l,head:o,base:i,maintainer_can_modify:!0})}))}},oe=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"cancel",value:function(){this.canceled=!0}},{key:"blobToBase64",value:function(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){var e=n.result.split(",")[1];t(e)},n.onerror=r,n.readAsDataURL(e)}))}},{key:"buildProviderTree",value:function(e,t){var r,n,a=this,o=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"utf-8";if(a.canceled)throw new Error("Canceled");return a.statusCb&&a.statusCb("Adding "+t+"/"+r),ae.createBlob(a.config,{content:e,encoding:n}).then((function(e){return{sha:e.sha,path:t+"/"+r,mode:"100644",type:"blob"}}))},i=v.a.chain(e.data.entry).groupBy((function(e){return e.resource.resourceType})).mapValues((function(e){return{entry:v.a.map(e,(function(e){return{fullUrl:e.fullUrl,resource:e.resource}})),total:e.length,type:"collection"}})).value();return Promise.all([function(e){return Promise.all(v.a.map(e,(function(e,t){return o(JSON.stringify(e,null,2),t+".json")})))}(i),(n=e.data.files,Promise.all(v.a.map(n,(function(e){return a.blobToBase64(e.blob).then((function(t){return o(t,e.fileName,"base64")}))})))),(r=e.data.errorLog,r.length?o(JSON.stringify(r,null,2),"error_log.json").then((function(e){return[e]})):Promise.resolve([]))]).then((function(e){return v.a.flatten(e)}))}},{key:"buildTree",value:function(e,t){var r=this,n=v.a.filter(t,(function(e){return e.selected&&e.data&&e.data.entry&&(e.data.entry.length||e.data.errorLog.length)})),a=v.a.map(n,(function(e){return Q()(e.name)})),o=v.a.filter(e.tree,(function(e){return!a.find((function(t){return"tree"===e.type&&e.path===t}))}));return Promise.all(v.a.map(n,(function(e,t){return r.buildProviderTree(e,a[t])}))).then((function(t){return Object(s.a)({},e,{tree:o.concat(v.a.flatten(t))})}))}},{key:"prepareCommit",value:function(e){var t,r=this;return this.statusCb&&this.statusCb("Retrieving repository information"),ae.getLastCommit(this.config).then((function(e){if(t=e,r.canceled)throw new Error("canceled");return ae.getTree(r.config,e)})).then((function(t){if(r.canceled)throw new Error("canceled");return r.buildTree(t,e)})).then((function(e){if(r.canceled)throw new Error("canceled");return ae.createTree(r.config,e)})).then((function(e){return{tree:e,lastCommit:t}}))}},{key:"export",value:function(e,t,r,n){return this.config=t,this.canceled=!1,this.statusCb=r,t.pullRequest?this.commitPullRequest(e,n):this.commitToMaster(e)}},{key:"commitToMaster",value:function(e){var t=this;return this.prepareCommit(e).then((function(e){var r=e.tree,n=e.lastCommit;if(t.canceled)throw new Error("canceled");return t.statusCb&&t.statusCb("Committing files"),ae.commitTree(t.config,r,"ProcureBot Commit",n).then((function(){t.statusCb&&t.statusCb("Data has been committed to master branch")}))}))}},{key:"commitPullRequest",value:function(e,t){var r=this;return t||(t="Procure/"+(new Date).toISOString().replace(/:/g,"-")),this.prepareCommit(e).then((function(e){var n=e.tree,a=e.lastCommit;if(r.canceled)throw new Error("canceled");return r.statusCb&&r.statusCb("Creating pull request"),ae.commitTreeToPullRequest(r.config,n,"ProcureBot commit",a,"ProcureBot pull request",t).then((function(e){r.statusCb&&r.statusCb("A new pull request has been created",e.html_url)}))}))}}]),e}(),ie=r(61),le=r(268),ce=r.n(le),se={validateExists:function(e){return void 0!==e},validateCode:function(e,t){return!!e&&(Array.isArray(e)||(e=[e]),!!e.find((function(e){return e.code===t.target})))},validateValue:function(e,t){return e===t.target},getHelperData:function(e,t,r){return r[t.helperDataField]},stringifyCodings:function(e){return e?(Array.isArray(e)||(e=[e]),e.map((function(e){return e.system+"|"+e.code})).join(" ")):e},parseDateForExcel:function(e,t,r){return e&&"csv"!==r.format?new Date(e):e}};function ue(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;n=n||se;var a=[];return v.a.each(t,(function(t){var o=function(e){0===a.length&&(a=[{}]);var t=[];v.a.each(e,(function(e){v.a.isArray(e)||(e=[e]),v.a.each(e,(function(e){v.a.each(a,(function(r){t.push(Object(s.a)({},r,{},e))}))}))})),a=t};v.a.isArray(t.path)||(t.path=[t.path]);var i=v.a.chain(e).at(e,t.path).filter((function(e){return void 0!==e})).first().value();if(!i&&t.path.indexOf("*")>-1&&(i=e),t.transform&&(i=n[t.transform](i,t,r)),!(void 0===t.test||n[t.test](i,t,r)))return a=null,!1;if(t.children){v.a.isArray(i)||(i=[i]);var l=v.a.map(i,(function(e){return ue(e,t.children,r,n)}));if(l.indexOf(null)>-1)return a=null,!1;o(l)}else if(t.name){v.a.isArray(i)||(i=[i]),o(i.map((function(e){return Object(ie.a)({},t.name,e)})))}})),a}function de(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return v.a.chain(e).filter((function(e){return e.selected&&e.data&&e.data.entry&&e.data.entry.length>0})).map((function(e){return v.a.chain(e.data.entry).map((function(a){var o=Object(s.a)({},r,{source:e.name});return ue(a.resource,t,o,n)})).flatten().value()})).flatten().filter((function(e){return null!==e})).value()}function fe(e){var t=[];return function e(r){v.a.each(r,(function(r){r.name&&t.push(r.name),r.children&&e(r.children)}))}(e||e.template),t}function me(e,t,r){var n=fe(t),a=e.map((function(e){return n.map((function(t){return e[t]}))})),o=function(e){var t=e.map((function(e){return e.map((function(e){var t=null===e?"":e.toString();return e instanceof Date&&(t=e.toLocaleString()),(t=t.replace(/"/g,'""')).search(/("|,|\n)/g)>=0&&(t='"'+t+'"'),t})).join(",")})).join("\n");return new Blob([t],{type:"text/csv;charset=utf-8;"})}([n].concat(a));return new Promise((function(e){X()(o,Q()(r)+".csv"),e()}))}var pe={flatten:ue,flattenProviders:de,defaultHelperFns:se,exportSpreadsheet:function(e,t,r,n){var a=t[r],o=v.a.map(a.extends||[],(function(e){return t[e]})).concat([a]),i=H.merge(o),l=de(e,i.template,{format:n});if(i.sortBy){var c=v.a.map(i.sortBy,(function(e){return e.name})),s=v.a.map(i.sortBy,(function(e){return e.dir||"desc"}));l=v.a.orderBy(l,c,s)}return"xlsx"===n?function(e,t,r){var n=fe(t),a=[],o=e.map((function(e){return n.map((function(t,r){return e[t]instanceof Date&&-1===a.indexOf(r+1)&&a.push(r+1),e[t]}))}));return ce.a.fromBlankAsync().then((function(e){return e.sheet(0).name(r).cell("A1").value([n].concat(o)),a.forEach((function(t){e.sheet(0).column(t).style("numberFormat","dddd, mmmm dd, yyyy")})),e.outputAsync()})).then((function(e){X()(e,Q()(r)+".xlsx")}))}(l,i.template,i.name):me(l,i.template,i.name)}},he=r(269);function ge(e,t,r){var n={providers:v.a.map(e,(function(e){return Object(s.a)({},e,{lastUpdated:null,data:null})})),githubConfig:t,redirectUri:r};return JSON.stringify(n,null,2)}var ve,ye={buildJSON:ge,download:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"procure-settings.json",a=ge(e,t,r),o=new Blob([a],{type:"application/json;charset=utf-8"});X()(o,n)},readFromFile:function(e,t,r){var n=new FileReader;return new Promise((function(t,r){n.onload=function(e){return t(n.result)},n.onerror=function(e){return r(e)},n.readAsText(e)})).then((function(e){try{return JSON.parse(e)}catch(t){throw new Error("Unable to read file")}})).then((function(e){if(e.redirectUri!==t)throw new Error("Only settings saved from this website can be imported");return e})).then((function(e){if(q.a.validate(e,he),q.a.error)throw console&&console.log(q.a.error),new Error("Invalid file format: "+q.a.error.message);return e})).then((function(e){return v.a.each(e.providers,(function(e){if(!r[e.queryProfile])throw new Error("Query profile not found: "+e.queryProfile)})),e}))}};ve=r(413);var Ee,be=new L,we=new oe,ke=new $,Ce=function(){return Math.random().toString(36)},je=d()([function(e){e.on("@init",(function(){return ve})),e.on("uiState/set",(function(e,t){return{uiState:t}})),e.on("uiState/merge",(function(e,t){var r=e.uiState;return{uiState:Object(s.a)({},r,{},t)}})),e.on("uiState/incrementCounts",(function(e,t){var r=e.uiState;return Object.keys(t).forEach((function(e){t[e]=t[e]+(r[e]||0)})),{uiState:Object(s.a)({},r,{},t)}})),e.on("wizard/hide",(function(){return{showWizard:!1,uiState:{mode:"ready"}}})),e.on("nonModalUi/merge",(function(e,t){var r=e.nonModalUi;return{nonModalUi:Object(s.a)({},r||{},{},t)}})),e.on("refreshDirty",(function(e,t){var r=e.providers,n=e.githubConfig,a=e.redirectUri,o=e.dirtySnapshot,i=ye.buildJSON(r,n,a);return t?{isDirty:!1,dirtySnapshot:i}:{isDirty:o!==i}})),e.on("providers/add",(function(e,t){var r=e.providers;return t.id||(t.id=Ce()),t.selected=!0,console.log(t),{providers:r.concat([t])}})),e.on("providers/update",(function(e,t){return{providers:e.providers.map((function(e){return e.id!==t.id?e:Object(s.a)({},e,{},t)}))}})),e.on("providers/upsert",(function(t,r){r.id?e.dispatch("providers/update",r):(r.id=Ce(),e.dispatch("providers/add",r))})),e.on("providers/upsertAndLoad",(function(t,r){e.dispatch("providers/upsert",r),e.dispatch("fhir/loadData",r.id)})),e.on("providers/remove",(function(e,t){return{providers:e.providers.filter((function(e){return e.id!==t}))}})),e.on("config/load",(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ready";e.dispatch("uiState/set",{mode:"loading"});var n=!1,a=n?"./config/config-override-dev.json":"./config/config-override.json";J.loadConfigFile("./config/config.json",a,n).then((function(t){e.dispatch("config/merge",t),e.dispatch("uiState/set",{mode:r}),e.dispatch("refreshDirty",!0)})).catch((function(t){e.dispatch("uiState/set",{mode:"globalError",error:t})}))})),e.on("config/merge",(function(e,t){return Object(s.a)({},e,{},t)})),e.on("fhir/loadData",(function(t,r){var n=t.providers,a=t.queryProfiles,o=t.mimeTypeMappings,i=t.ignoreState,l=n.find((function(e){return e.id===r})),c=a[l.queryProfile],s=a[l.queryProfile].retryLimit||0,u=function(t){e.dispatch("uiState/set",{mode:"loadData",submode:"loaded",data:t,id:l.id})},d=function(t,r){console&&console.log("Fetching: ",t),e.dispatch("uiState/incrementCounts",{requestCount:1,errorCount:r?1:0})},f=function(t){e.dispatch("uiState/merge",{submode:"loading"}),be.getFHIR(l,c,t,!0,o,s,d).then(u).catch(m)},m=function(t){"cancelled"!==t.message&&"AbortError"!==t.name&&e.dispatch("uiState/set",{mode:"loadData",submode:"error",status:t.message||t,id:l.id})};l.isOpen?(e.dispatch("uiState/set",{mode:"loadData",submode:"loading",id:l.id}),f()):(e.dispatch("uiState/set",{mode:"loadData",submode:"authorizing",id:l.id}),be.authAndGetFHIR(l,i).then(f).catch(m))})),e.on("fhir/cancelLoad",(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ready";be.cancel(),e.dispatch("uiState/set",{mode:r})})),e.on("export/download",(function(t){var r=t.providers;e.dispatch("nonModalUi/merge",{isDownloading:!0}),re.generateFile(r).catch((function(t){e.dispatch("uiState/set",{mode:"ready",error:t.message})})).finally((function(){e.dispatch("nonModalUi/merge",{isDownloading:!1})}))})),e.on("export/spreadsheet",(function(t,r){var n=t.providers,a=t.spreadsheetTemplates;e.dispatch("nonModalUi/merge",{isExportingSheet:!0}),pe.exportSpreadsheet(n,a,r.templateId,r.format).catch((function(t){e.dispatch("uiState/set",{mode:"globalError",error:t})})).finally((function(){e.dispatch("nonModalUi/merge",{isExportingSheet:!1})}))})),e.on("export/github",(function(t){var r=t.githubConfig,n=t.providers;e.dispatch("uiState/merge",{submode:"push",error:null}),we.export(n,r,(function(t,r){e.dispatch("uiState/merge",{status:t,statusUrl:r})})).then((function(){e.dispatch("uiState/merge",{submode:null})})).catch((function(t){e.dispatch("uiState/set",{mode:"githubExport",error:"canceled"===t.message?null:t.message})}))})),e.on("export/github/cancel",(function(){we.cancel(),e.dispatch("uiState/set",{mode:"githubExport"})})),e.on("export/upload",(function(t){var r=t.upload;if((e.dispatch("uiState/set",{mode:"fileUpload",submode:"getManifest",status:"Preparing to send data"}),r.qsManifestUrl)&&!ke.isValidUrl(r.manifestUrl,r.whitelist))return e.dispatch("uiState/merge",{submode:"error",status:"Url manifest location not in whitelist: "+r.manifestUrl});if(r.uploadUrl&&!r.manifestUrl)return e.dispatch("uiState/merge",{submode:"preUpload"});ke.getManifest(r.manifestUrl).then((function(t){e.dispatch("config/merge",{upload:Object(s.a)({manifestUrl:r.manifestUrl,label:r.label},t)}),e.dispatch("uiState/merge",{submode:"preUpload"})})).catch((function(t){e.dispatch("uiState/merge",{submode:"error",status:"Unable to load manifest at "+r.manifestUrl})}))})),e.on("export/upload/cancel",(function(e){if(e.upload.simulate)return window.clearTimeout(Ee);ke.cancel()})),e.on("export/upload/send",(function(t){var r=t.upload,n=t.providers;if(e.dispatch("uiState/set",{mode:"fileUpload",submode:"uploading",status:"Uploading Data"}),r.simulate)return Ee=window.setTimeout((function(){e.dispatch("uiState/merge",{submode:"postUpload"})}),2e3);re.exportProvidersAsBlob(n).then((function(e){return ke.putFile(r.uploadUrl,e)})).then((function(){e.dispatch("uiState/merge",{submode:"postUpload"})})).catch((function(t){"AbortError"!==t.name&&e.dispatch("uiState/merge",{submode:"error",status:t.message.toString()})}))})),e.on("export/settings",(function(e){var t=e.providers,r=e.githubConfig,n=e.redirectUri;ye.download(t,r,n)})),e.on("import/settings",(function(t,r){var n=t.redirectUri,a=t.queryProfiles,o=t.noCustomEndpoints;ye.readFromFile(r,n,a).then((function(t){o&&(t.providers=[]),e.dispatch("uiState/set",{mode:"loading"}),e.dispatch("config/merge",t),e.dispatch("uiState/set",{mode:"ready"})})).catch((function(t){e.dispatch("uiState/set",{mode:"ready",error:t.message})}))}))}]),Oe=r(16),Ue=r.n(Oe),Se=r(560),xe=r(561),Pe=r(558),Ne=r(557),Te=r(30),De=r(546),Le=r(547),Ae=r(548),Ie=r(549),Re=r(550),qe=r(569),_e=r(551),ze=r(552),Fe=r(553),Me=r(554),Be=r(271),$e=r(83),He=r(81),Ve=function(){var e=Ue()("uiState","providers","queryProfiles","credentials","organizations","orgDefaults","redirectUri","noCustomEndpoints"),t=e.uiState,r=e.providers,o=e.queryProfiles,i=e.credentials,l=e.organizations,c=e.orgDefaults,u=e.redirectUri,d=e.noCustomEndpoints,f=e.dispatch,m=Object(n.useState)({}),p=Object(Te.a)(m,2),h=p[0],g=p[1],y=Object(n.useState)({}),E=Object(Te.a)(y,2),b=E[0],w=E[1],k=Object(n.useState)(!1),C=Object(Te.a)(k,2),j=C[0],O=C[1],U=(d?[]:[{label:"Custom Endpoint",value:"custom"}]).concat(v.a.chain(l).map((function(e){return{label:e.name,value:e.orgId||e.fhirEndpoint}})).sortBy((function(e){return e.label})).value()),S=Object(n.useCallback)((function(e){e.preventDefault(),f("uiState/set",{mode:"ready"})}),[f]);Object(n.useEffect)((function(){var e=function(e){27===e.keyCode&&S(e)};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[S]),Object(n.useEffect)((function(){if(!h.id&&t.id&&"editProvider"===t.mode){var e=r.find((function(e){return e.id===t.id}));g(e),w({}),O(e&&"custom"===e.orgId)}}),[t.id,t.mode,h.id,r]);var x=function(e,t){e.preventDefault();var r=N(h);if(r)return w(r);t?(f("providers/upsert",h),f("uiState/set",{mode:"ready"})):f("providers/upsertAndLoad",h),f("refreshDirty")},P=function(e){var t;if("custom"!==e.value){t=l.find((function(t){return e.value===t.orgId||e.value===t.fhirEndpoint}));var r=c[t.defaultId]||{};void 0!==t.defaultId&&(t=Object(s.a)({},r,{},t))}else t={name:e.label,scope:["patient/*.read","launch/patient"]};t.credentialId&&(t=Object(s.a)({},i[t.credentialId],{},t));var n=Object(s.a)({},t,{redirectUri:u,id:h.id,orgId:e.value});O(N(n)),g(n)},N=function(e){var t={},r=function(e){return!/^https?:\/\//.test(e.toLowerCase())};return e.isOpen?["name","patient"].forEach((function(r){e[r]||(t[r]="Required")})):["name","clientId","scope"].forEach((function(r){e[r]||(t[r]="Required")})),r(e.fhirEndpoint||"")&&(t.fhirEndpoint="Valid URL Required"),!e.isOpen&&r(e.redirectUri||"")&&(t.redirectUri="Valid URL Required"),Object.keys(t).length>0?t:null},T=function(e,t,r,n,o,i,l){var c=o?a.a.createElement(Ae.a,{color:"muted"},o):"",u=b[t]?a.a.createElement(Ie.a,null,b[t]):"",d=l||function(e){g(Object(s.a)({},h,Object(ie.a)({},t,e.target.value)))};return a.a.createElement(De.a,null,a.a.createElement(Le.a,{for:"{property}"},e),a.a.createElement(Re.a,{value:i?i():h[t]||"",type:r||"text",id:t,onChange:d,invalid:!!b[t],required:n}),c,u)},D=function(){var e=Object.keys(o).map((function(e){return a.a.createElement("option",{value:e,key:e},o[e].title)}));return a.a.createElement(De.a,null,a.a.createElement(Le.a,{for:"profile"},"Profile"),a.a.createElement(Re.a,{type:"select",value:h.queryProfile||"argonaut_spec",onChange:function(e){return g(Object(s.a)({},h,{queryProfile:e.target.value}))},name:"profile"}," ",e," "))},L=a.a.createElement(De.a,{check:!0},a.a.createElement(Re.a,{type:"checkbox",id:"isOpen",checked:!0===h.isOpen||"true"===h.isOpen||!1,onChange:function(e){return g(Object(s.a)({},h,{isOpen:!h.isOpen}))}}),a.a.createElement(Le.a,{for:"isOpen"},"Open Endpoint")),A=!d&&a.a.createElement(De.a,null,a.a.createElement("a",{href:"#",onClick:function(e){return O(!0)}},"Show Configuration Details")),I=a.a.createElement(a.a.Fragment,null,function(){var e=h.orgId?U.find((function(e){return e.value===h.orgId})):null;return a.a.createElement(De.a,null,a.a.createElement(Le.a,{for:"organization"},"Healthcare Organization"),a.a.createElement($e.a,{id:"organization",autoFocus:!0,filterOption:Object(He.b)({ignoreAccents:!1}),value:e,onChange:P,isSearchable:!0,options:U,defaultMenuIsOpen:!h.id}))}(),T("Title","name","text",!0)),R=a.a.createElement(a.a.Fragment,null,T("FHIR Endpoint URL","fhirEndpoint","url",!0),L,D(),T("Patient Id","patient","text",!0)),q=a.a.createElement(a.a.Fragment,null,T("FHIR Endpoint URL","fhirEndpoint","url",!0),L,D(),T("Client Id","clientId","text",!0),T("Client Secret (if applicable)","clientSecret","text",!0),T("Redirect URL","redirectUri","url",!0),T("Scope","scope","text",!0,"separate scopes with spaces",(function(){return(h.scope||[]).join(" ")}),(function(e){return g(Object(s.a)({},h,{scope:e.target.value.split(/\s+/)}))})));return a.a.createElement(qe.a,{isOpen:!0,fade:!1,backdrop:!0,autoFocus:!1},a.a.createElement(_e.a,null,h.id?"Update Provider":"Add Provider"," "),a.a.createElement(ze.a,null,a.a.createElement(Fe.a,{onSubmit:x,className:"needs-validation",noValidate:!0},I,!j&&h.orgId?A:null,j&&h.isOpen?R:null,j&&!h.isOpen?q:null)),a.a.createElement(Me.a,null,a.a.createElement("div",{className:"mr-auto"},a.a.createElement("a",{href:"#",onClick:S},"Cancel")),a.a.createElement(Be.a,{color:"outline-secondary",onClick:function(e){return x(e,!0)}},"Save"),a.a.createElement(Be.a,{color:"primary",style:{marginLeft:"1em"},onClick:x},"Save and Load Records")))},We=r(279),Je=r(272),Ge=r(280),Qe=r(166),Ye=function(e){function t(e){var r;return Object(f.a)(this,t),(r=Object(We.a)(this,Object(Je.a)(t).call(this,e))).state={timeAgo:Object(Qe.format)(r.props.time)},r}return Object(Ge.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval((function(){e.setState({timeAgo:Object(Qe.format)(e.props.time)})}),6e4*(this.props.refreshMinutes||1))}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){return this.state.timeAgo}}]),t}(a.a.Component),Ze=r(555),Ke=r(556),Xe=r(14),et=r(15),tt=r(273),rt=function(){var e=Ue()("providers"),t=e.providers,r=e.dispatch,n=function(e,t,n){r("providers/update",{id:e,selected:t})},o=function(e,t){return 1===t?e:e+"s"};return a.a.createElement("div",null,a.a.createElement("div",{style:{marginBottom:"1.5rem"}},a.a.createElement(Be.a,{color:"success",style:{marginRight:"1rem"},onClick:function(e){e.preventDefault(),r("uiState/set",{mode:"editProvider"})}},a.a.createElement(Xe.a,{icon:et.h,className:"mr-2"}),"Add Provider")),t.map((function(e){var t=a.a.createElement("div",null,a.a.createElement("div",{className:"float-right"},a.a.createElement("a",{href:"#",onClick:function(t){return function(e,t){t.preventDefault(),r("uiState/set",{mode:"editProvider",id:e})}(e.id,t)},title:"Edit Provider"},a.a.createElement(Xe.a,{icon:et.d,color:"#6c757d",className:"mx-2"})),a.a.createElement("a",{href:"#",onClick:function(t){return function(e,t){t.preventDefault(),r("providers/remove",e),r("refreshDirty")}(e.id,t)},title:"Delete Provider"},a.a.createElement(Xe.a,{icon:et.j,color:"#6c757d",className:"mx-2"}))),a.a.createElement("a",{href:"#",style:{fontWeight:e.lastUpdated?"normal":"bold"},onClick:function(t){return function(e,t){t.preventDefault(),r("fhir/loadData",e)}(e.id,t)}},e.lastUpdated?"re":"","load records"));return a.a.createElement(Ze.a,{style:{margin:"0 1rem 1rem 0"},key:e.id},a.a.createElement(Ke.a,null,a.a.createElement(Ne.a,null,a.a.createElement(Pe.a,{xs:{size:"auto"},className:"mr-0 pr-1 text-center"},a.a.createElement("div",null,a.a.createElement("input",{type:"checkbox",style:{visibility:"hidden",width:0,height:0},checked:!!e.selected,id:"selection-"+e.id,onChange:function(t){return n(e.id,!e.selected)}}),a.a.createElement("label",{htmlFor:"selection-"+e.id},a.a.createElement(Xe.a,{icon:e.selected?et.a:tt.a,size:"lg",color:e.selected?"green":"black"})))),a.a.createElement(Pe.a,null,a.a.createElement("p",{className:"font-weight-bold",style:{marginBottom:".25rem",cursor:"pointer",display:"inline-block"},onClick:function(t){return n(e.id,!e.selected)}},e.name),e.lastUpdated&&a.a.createElement("p",null,e.data.entry.length," ",o("resource",e.data.entry.length)," | ",e.data.files.length," ",o("file",e.data.files.length)," | ",e.data.errorLog.length," ",o("error",e.data.errorLog.length),a.a.createElement("br",null),"loaded ",a.a.createElement(Ye,{time:e.lastUpdated})),t))))})))},nt=r(559),at=function(){var e=Ue()("uiState","providers"),t=e.uiState,r=e.providers,o=e.dispatch,i=Object(n.useMemo)((function(){return r.find((function(e){return e.id===t.id}))}),[t.id,r]),l=Object(n.useCallback)((function(e){e.preventDefault(),o("fhir/cancelLoad")}),[o]),c=Object(n.useCallback)((function(e){e&&e.preventDefault(),o("uiState/set",{mode:"ready"})}),[o]);Object(n.useEffect)((function(){var e=function(e){27===e.keyCode&&("authorizing"===t.submode||"loading"===t.submode?l(e):c(e))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[l,c,t.submode]);var s=function(e){e.preventDefault(),o("providers/update",{id:i.id,lastUpdated:new Date,data:t.data}),c()},u=function(e){e.preventDefault();var r=new Blob([JSON.stringify(t.data.errorLog,null,2)],{type:"application/json"});Object(K.saveAs)(r,"errors.json")},d=function(e,t){return 1===t?e:e+"s"};return a.a.createElement(qe.a,{isOpen:!0,fade:!1,backdrop:!0},a.a.createElement(ze.a,{style:{textAlign:"center"}},a.a.createElement("h3",null,i.name),"authorizing"===t.submode&&a.a.createElement("div",null,a.a.createElement("h5",null,"Waiting for authorization..."),a.a.createElement("div",null,a.a.createElement(Be.a,{className:"btn-primary",onClick:l},"Cancel"))),"loading"===t.submode&&a.a.createElement("div",null,a.a.createElement("h5",null,t.requestCount," ",d("request",t.requestCount),"\xa0 / \xa0",t.errorCount," ",d("error",t.errorCount)),a.a.createElement("div",{style:{padding:"1rem 0rem"}},a.a.createElement(nt.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),a.a.createElement("div",null,a.a.createElement(Be.a,{className:"btn-primary",onClick:l},"Cancel"))),"loaded"===t.submode&&a.a.createElement("div",null,a.a.createElement("h5",null,t.data.entry.length," ",d("resource",t.data.entry.length)," retrieved",a.a.createElement("br",null),t.data.files.length||"No"," ",d("attachment",t.data.files.length)," downloaded",a.a.createElement("br",null),t.data.errorLog.length||"No"," ",d("error",t.data.errorLog.length)," occurred")),"error"===t.submode&&a.a.createElement("div",null,a.a.createElement("h5",{style:{padding:"1rem 0",color:"red"}},"An error occurred: ",t.status),a.a.createElement("div",null,a.a.createElement(Be.a,{className:"btn-primary",onClick:c},"Close")))),"loaded"===t.submode&&function(){var e=t.data.errorLog.length>0&&a.a.createElement("div",{className:"mr-auto"},a.a.createElement("a",{href:"#",onClick:u},"Download error log"));return a.a.createElement(Me.a,null,e,a.a.createElement(Be.a,{color:"outline-secondary",onClick:c},"Cancel"),a.a.createElement(Be.a,{color:"primary",style:{marginLeft:"1em"},onClick:s},"Save"))}())},ot=function(){return a.a.createElement("div",{className:"text-center",style:{margin:"3rem"}},a.a.createElement(nt.a,{style:{width:"3rem",height:"3rem",margin:"1rem"}}),a.a.createElement("h4",null,"Loading"))},it=function(){var e=Ue()("uiState","githubConfig"),t=e.uiState,r=e.githubConfig,o=e.dispatch,i=Object(n.useState)(),l=Object(Te.a)(i,2),c=l[0],u=l[1],d=Object(n.useCallback)((function(e){e&&e.preventDefault(),o("uiState/set",{mode:"ready"})}),[o]),f=Object(n.useCallback)((function(e){e.preventDefault(),o("export/github/cancel")}),[o]);Object(n.useEffect)((function(){var e=function(e){27===e.keyCode&&("push"!==t.submode?d(e):f(e))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t.submode,f,d]);var m=function(e){e.preventDefault(),r.token&&r.owner&&r.project?o("export/github"):o("uiState/merge",{error:"Please enter a personal access token, repository owner and repository project to continue."})},p=function(e,t){var n="pullRequest"===e?"true"===t.target.value:t.target.value;o("config/merge",{githubConfig:Object(s.a)({},r,Object(ie.a)({},e,n))}),o("uiState/merge",{status:null,error:null}),o("refreshDirty")},h=function(e){e.preventDefault(),u(!c)};return a.a.createElement(qe.a,{isOpen:!0,fade:!1,backdrop:!0},a.a.createElement(_e.a,null,"Push to Github Repository"),"push"===t.submode?a.a.createElement(ze.a,{className:"text-center"},a.a.createElement("h5",null,t.status),a.a.createElement("div",{style:{padding:"1rem 0rem"}},a.a.createElement(nt.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),a.a.createElement("div",null,a.a.createElement(Be.a,{className:"btn-primary",onClick:f},"Cancel"))):a.a.createElement(Fe.a,{onSubmit:m},a.a.createElement(ze.a,null,t.error&&a.a.createElement(Ne.a,null,a.a.createElement(Pe.a,{xs:12},a.a.createElement(Se.a,null,a.a.createElement(xe.a,{color:"danger"},a.a.createElement("span",null,t.error.toString()))))),t.status&&function(){var e=t.statusUrl?a.a.createElement("span",null," (",a.a.createElement("a",{href:t.statusUrl,target:"_blank",rel:"noopener noreferrer"},"view"),")"):null;return a.a.createElement(Ne.a,null,a.a.createElement(Pe.a,{xs:12},a.a.createElement(Se.a,null,a.a.createElement(xe.a,{color:"success"},t.status,e,"."))))}(),a.a.createElement(Ne.a,{form:!0,style:{margin:"1rem 0"}},a.a.createElement(Pe.a,{xs:12},a.a.createElement("div",{className:"small float-right"},a.a.createElement("a",{href:"#",onClick:h},"How do I get a token?")),a.a.createElement("div",{id:"token-instructions",style:{display:c?"block":"none",marginTop:"2rem"}},"To obtain a personal access token for your Github account:",a.a.createElement("ol",null,a.a.createElement("li",null,"Visit ",a.a.createElement("a",{href:"https://github.com/settings/tokens",target:"_blank",rel:"noopener noreferrer"},"https://github.com/settings/tokens")),a.a.createElement("li",null,'Click the "Generate new token" button in upper right corner of the page.'),a.a.createElement("li",null,'Add a note to identify the token in case you want to revoke it later (eg. "Procure").'),a.a.createElement("li",null,"Select permissions:",a.a.createElement("ul",null,a.a.createElement("li",null,"To push data to a public repository, check the ",a.a.createElement("i",null,'"public_repo"')," item under ",a.a.createElement("i",null,'"repo"'),"."),a.a.createElement("li",null,"To push data to a private repository, check the ",a.a.createElement("i",null,'"repo"')," item."))),a.a.createElement("li",null,'Click the "Generate token" button at the bottom of the page.'))),a.a.createElement(Le.a,{for:"token"},"Personal Access Token"),a.a.createElement(Re.a,{id:"token",value:r&&r.token||"",onChange:function(e){return p("token",e)}}))),a.a.createElement(Ne.a,{form:!0,style:{margin:"1rem 0"}},a.a.createElement(Pe.a,{xs:12},a.a.createElement(Le.a,{for:"repo"},"Repository")),a.a.createElement(Pe.a,{xs:4},a.a.createElement(Re.a,{id:"owner",value:r&&r.owner||"",onChange:function(e){return p("owner",e)},placeholder:"Owner","data-lpignore":"true"})),a.a.createElement(Pe.a,{xs:1},a.a.createElement(Re.a,{readOnly:!0,className:"form-control-plaintext",defaultValue:"/"})),a.a.createElement(Pe.a,{xs:7},a.a.createElement(Re.a,{id:"project",value:r&&r.project||"",onChange:function(e){return p("project",e)},placeholder:"Project","data-lpignore":"true"}))),a.a.createElement(Ne.a,{form:!0,style:{margin:"2rem 0"}},a.a.createElement(Pe.a,{xs:12},a.a.createElement(De.a,{check:!0},a.a.createElement(Le.a,{check:!0},a.a.createElement(Re.a,{type:"radio",name:"pull-request",value:!1,checked:!r.pullRequest,onChange:function(e){return p("pullRequest",e)}}),"Commit directly to the master branch")),a.a.createElement(De.a,{check:!0},a.a.createElement(Le.a,{check:!0},a.a.createElement(Re.a,{type:"radio",name:"pull-request",value:!0,checked:!0===r.pullRequest,onChange:function(e){return p("pullRequest",e)}}),"Create a new branch and pull request"))))),a.a.createElement(Me.a,null,a.a.createElement(Be.a,{color:"success",type:"submit"},"Push Data"),a.a.createElement(Be.a,{color:"secondary",onClick:d},"Close"))))},lt=r(562),ct=r(563),st=r(564),ut=r(565),dt=r(566),ft=function(e){var t=e.children,r=e.dropHint,o=e.fileDropHandler,i=Object(n.useState)(0),l=Object(Te.a)(i,2),c=l[0],s=l[1],u=function(e){return!e.dataTransfer.types||"Files"===e.dataTransfer.types[0]||"application/x-moz-file"===e.dataTransfer.types[0]},d=a.a.createElement("div",{className:"d-flex justify-content-center",style:{border:"dashed grey 4px",backgroundColor:"rgba(255,255,255,.8)",position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:9999}},a.a.createElement("div",{className:"d-flex align-items-center"},r||"Drop settings file here"));return a.a.createElement("div",{style:{position:"relative"},onDragEnter:function(e){e.preventDefault(),e.stopPropagation(),u(e)&&s(c+1)},onDragOver:function(e){e.preventDefault(),e.stopPropagation()},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),u(e)&&s(c-1)},onDrop:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&1===e.dataTransfer.files.length&&o(e.dataTransfer.files[0]),s(0)}},c>0&&d,t)},mt=function(){var e=Ue()("providers","isDirty","warnOnPageNavigate","appName"),t=e.providers,r=e.isDirty,o=e.warnOnPageNavigate,i=e.appName,l=e.dispatch,c=Object(n.useRef)();Object(n.useEffect)((function(){window.onbeforeunload=function(){return!(!r||!o)||null}}));var s=function(e){(0===t.length||window.confirm("Current providers in your list will be replaced. Continue?"))&&(l("import/settings",e),l("refreshDirty",!0))};return a.a.createElement("div",{style:{marginBottom:"2rem"}},a.a.createElement(ft,{fileDropHandler:s},a.a.createElement("input",{ref:c,type:"file",style:{display:"none"},onChange:function(e){e.preventDefault(),e.stopPropagation(),1===e.target.files.length&&s(e.target.files[0])},accept:".json, application/json"}),a.a.createElement(lt.a,{color:"light",light:!0,expand:"xs"},a.a.createElement(ct.a,{href:"/"},a.a.createElement(Xe.a,{icon:et.g,alt:"Procure logo",className:"mr-2"}),i||"Procure"),a.a.createElement(st.a,{className:"ml-auto",navbar:!0},a.a.createElement(ut.a,null,a.a.createElement(dt.a,{href:"#",onClick:function(e){e.preventDefault(),c.current.value="",c.current.click()}},"import settings")),a.a.createElement(ut.a,null,a.a.createElement(dt.a,{href:"#",onClick:function(e){e.preventDefault(),l("export/settings")},style:{fontWeight:r?"bold":"normal"}},"export settings"))))))},pt=r(278),ht=r(274),gt=r.n(ht),vt=function(){var e=Ue()("providers","dateSortElements"),t=e.providers,r=e.dateSortElements,o=Object(n.useState)(),i=Object(Te.a)(o,2),l=i[0],c=i[1],s=Object(n.useState)(1),u=Object(Te.a)(s,2),d=u[0],f=u[1],m=Object(n.useState)([]),p=Object(Te.a)(m,2),h=p[0],g=p[1],y=Object(n.useRef)(),E=Object(n.useMemo)((function(){return v.a.chain(t).filter((function(e){return e.data&&e.selected})).map((function(e){return e.data.entry.map((function(e){return e.resource.resourceType}))})).flatten().uniq().map((function(e){return{label:e,value:e}})).sortBy(["label"]).value()}),[t]),b=Object(n.useMemo)((function(){return v.a.chain(t).filter((function(e){return e.data&&e.data.entry&&e.selected})).map((function(e){return e.data.entry})).flatten().filter((function(e){return!l||l.value===e.resource.resourceType})).sortBy((function(e){var t=r[e.resource.resourceType]||[],n=v.a.find(t,(function(t){return e.resource[t]}));return n&&(e.resource[n].start||e.resource[n])||e.resource.meta&&e.resource.meta.lastUpdated||""})).reverse().value()}),[t,l,r]),w=function(e){return e.replace(/^\/|https?:\/\/|\/*$/g,"")},k=Object(n.useMemo)((function(){var e={};return v.a.each(t,(function(t,r){v.a.each(t.data&&t.data.entry||[],(function(t,n){e[w(t.fullUrl)]=[r,n,"resource"]})),v.a.each(t.data&&t.data.files||[],(function(t,n){e[t.fileName]=[r,n,"file"]}))})),e}),[t]),C=function(e,t){t.preventDefault(),f(d+e)},j=a.a.createElement(De.a,null,a.a.createElement($e.a,{id:"resourceType",value:l,onChange:function(e){c(e),f(1),g([])},isSearchable:!0,options:E,placeholder:"Filter by Resource Type",isClearable:!0})),O={base00:"#272822",base01:"#383830",base02:"#49483e",base03:"#75715e",base04:"#a59f85",base05:"#f8f8f2",base06:"#f5f4f1",base07:"#f9f8f5",base08:"#f92672",base09:"#fd971f",base0A:"#f4bf75",base0B:"#a6e22e",base0C:"#a1efe4",base0D:"#66d9ef",base0E:"#ae81ff",base0F:"#cc6633"},U=function(e,r,n){var o;if("reference"===n){var i=w(r);if(1===(i.match(/\//g)||[]).length){var l=h.length&&v.a.last(h).fullUrl||b[d-1].fullUrl,c=w(l).split("/");i=c.slice(0,c.length-2).join("/")+"/"+i}k[i]&&(o=i)}else"url"===n&&k[r]?o=r:r.length>500&&(e=r.substring(0,500)+"...");return o?a.a.createElement("span",null,'"',a.a.createElement("a",{href:"#",style:{textDecoration:"underline"},onClick:function(e){return function(e,r){r.preventDefault();var n=k[e];if("file"===n[2]){var a=t[n[0]].data.files[n[1]];Object(K.saveAs)(a.blob,a.fileName)}else g([].concat(Object(pt.a)(h),[e])),window.scrollTo(0,y.current.offsetTop)}(o,e)}},r),'"'):e};return a.a.createElement("div",{ref:y},j,function(){var e=a.a.createElement("div",{className:"text-center"},"No resources found"),t=a.a.createElement("div",null,a.a.createElement(Be.a,{size:"sm",outline:!0,color:"primary",disabled:1===d,onClick:function(e){return C(-1,e)},className:"mr-3"},a.a.createElement(Xe.a,{icon:et.b})),"Resource ",d," of ",b.length,a.a.createElement(Be.a,{size:"sm",outline:!0,color:"primary",disabled:d===b.length,onClick:function(e){return C(1,e)},className:"ml-3"},a.a.createElement(Xe.a,{icon:et.c}))),r=a.a.createElement("div",null,a.a.createElement(Be.a,{size:"sm",outline:!0,color:"primary",onClick:function(e){g(v.a.slice(h,0,-1))}},a.a.createElement(Xe.a,{icon:et.b,className:"mr-2"}),"Back"));return h.length?r:b.length?t:e}(),function(){var e=h.length&&function(e){var r=k[e];if(r)return t[r[0]].data.entry[r[1]]}(v.a.last(h));h.length&&!e&&g(v.a.slice(h,1,-1));var r=e&&e.resource||b[d-1]&&b[d-1].resource;if(r)return a.a.createElement("div",{style:{marginTop:"1rem",padding:"1rem",border:"1px solid #ccc",borderRadius:".25rem",background:"#fffffa"}},a.a.createElement(gt.a,{data:r,theme:O,hideRoot:!0,shouldExpandNode:function(e,t,r){return!0},invertTheme:!0,valueRenderer:U}))}())},yt=r(567),Et=r(568),bt=r(570),wt=r(571),kt=r(275),Ct=function(e){var t=Ue()("spreadsheetTemplates","upload","nonModalUi"),r=t.spreadsheetTemplates,o=t.upload,i=t.nonModalUi,l=t.dispatch,c=Object(n.useState)(!1),s=Object(Te.a)(c,2),u=s[0],d=s[1],f=function(e,t,r){r.preventDefault(),l("export/spreadsheet",{templateId:e,format:t})},m=a.a.createElement(Be.a,{color:"success",style:{margin:"0 1rem 1rem 0"},onClick:function(e){e.preventDefault(),l("export/upload")}},a.a.createElement(Xe.a,{icon:et.f,className:"mr-2"}),o.label||"Share Data"),p=a.a.createElement(Be.a,{color:"outline-secondary",style:{margin:"0 1rem 1rem 0"},onClick:function(e){e.preventDefault(),l("export/download")},disabled:i.isDownloading},a.a.createElement(Xe.a,{icon:et.e,className:"mr-2"}),"Download Data"),h=a.a.createElement(Be.a,{style:{margin:"0 0 1rem 0"},color:"outline-secondary",onClick:function(e){e.preventDefault(),l("uiState/set",{mode:"githubExport"})}},a.a.createElement(Xe.a,{icon:kt.a,className:"mr-2"}),"Upload to Github");return a.a.createElement("div",{style:{marginBottom:".5rem"}},o&&(o.manifestUrl||o.uploadUrl)&&m,p,e.hasResources&&function(){if(!Object.keys(r||{}).length)return null;var e=[];return Object.keys(r).forEach((function(t){e.push(a.a.createElement(yt.a,{key:t+"-xlsx",onClick:f.bind(void 0,t,"xlsx")},r[t].name+" (Excel)"),a.a.createElement(yt.a,{key:t+"-csv",onClick:f.bind(void 0,t,"csv")},r[t].name+" (CSV)"))})),a.a.createElement(Et.a,{style:{display:"inline"},disabled:i.isExportingSheet,isOpen:u,toggle:function(e){return d(!u)}},a.a.createElement(bt.a,{color:"outline-secondary",style:{margin:"0 1rem 1rem 0"},caret:!0},a.a.createElement(Xe.a,{icon:et.i,className:"mr-2"}),a.a.createElement("span",{className:"mr-2"},"Export as Spreadsheet")),a.a.createElement(wt.a,null,e))}(),h)},jt=function(){var e=Ue()().dispatch;return a.a.createElement(Be.a,{block:!0,color:"success",onClick:function(t){t.preventDefault(),e("uiState/set",{mode:"editProvider"})}},a.a.createElement(Xe.a,{icon:et.h,className:"mr-2"}),"Add Provider")},Ot=function(){var e=Ue()("uiState","upload"),t=e.uiState,r=e.upload,o=e.dispatch,i=Object(n.useCallback)((function(e){e&&e.preventDefault(),o("uiState/set",{mode:"ready"})}),[o]),l=Object(n.useCallback)((function(e){e&&e.preventDefault(),r.continueUrl&&window.open(r.continueUrl),i(e)}),[i,r]),c=Object(n.useCallback)((function(e){e.preventDefault();var r="getManifest"===t.submode?{mode:"ready"}:{mode:"fileUpload",submode:"preUpload"};o("export/upload/cancel"),o("uiState/set",r)}),[o,t.submode]),s=Object(n.useCallback)((function(e){e.preventDefault(),o("export/upload/send")}),[o]);Object(n.useEffect)((function(){var e=function(e){27===e.keyCode&&("preUpload"===t.submode||"postUpload"===t.submode?i(e):c(e))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t.submode,c,i]);var u=function(){return a.a.createElement(ze.a,{className:"text-center"},a.a.createElement("h5",null,t.status),a.a.createElement("div",{style:{padding:"1rem 0rem"}},a.a.createElement(nt.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),a.a.createElement("div",null,a.a.createElement(Be.a,{className:"btn-primary",onClick:c},"Cancel")))};return a.a.createElement(qe.a,{isOpen:!0,fade:!1,backdrop:!0},a.a.createElement(_e.a,null,"Share My Data"),"error"===t.submode&&a.a.createElement("div",null,a.a.createElement(ze.a,null,a.a.createElement(Se.a,null,a.a.createElement(xe.a,{color:"danger"},a.a.createElement("span",null,t.status)))),a.a.createElement(Me.a,null,a.a.createElement(Be.a,{color:"secondary",onClick:i},"Close"))),"getManifest"===t.submode&&u(),"preUpload"===t.submode&&a.a.createElement("div",null,a.a.createElement(ze.a,null,a.a.createElement("p",null,"Clicking the ",a.a.createElement("b",null,"upload")," button below will share your medical record information with ",a.a.createElement("b",null,r.name)," and indicates your agreement to the terms of use, privacy policy and other information outlined at",a.a.createElement("b",null,"\xa0",a.a.createElement("a",{href:r.infoUrl,target:"_blank",rel:"noopener noreferrer"},r.infoUrl)),".")),a.a.createElement(Me.a,null,a.a.createElement(Be.a,{color:"success",onClick:s},"Upload"),a.a.createElement(Be.a,{color:"secondary",onClick:i},"Cancel"))),"uploading"===t.submode&&u(),"postUpload"===t.submode&&a.a.createElement("div",null,a.a.createElement(ze.a,{className:"text-center"},a.a.createElement("h5",null,r.successMessage||"Your information has been transmitted!")),a.a.createElement(Me.a,null,a.a.createElement(Be.a,{color:"primary",onClick:l},r.continueUrl?r.continueLabel||"Continue":"Close"))))},Ut=function(){var e=Ue()("upload"),t=e.upload,r=e.dispatch;return a.a.createElement("div",{className:"p-2"},a.a.createElement("h4",{className:"mb-4"},"Welcome"),a.a.createElement("p",null,"This app will walk you through the process of collecting digital copies of your medical records from healthcare institutions where you've received care and sharing them with ",t.name,". You can find additional information at ",a.a.createElement("a",{href:t.infoUrl,target:"_blank",rel:"noopener noreferrer"},t.infoUrl),"."),a.a.createElement("p",null,"You'll also have the option to download a copy of the data to this device to keep for yourself."),a.a.createElement(Be.a,{color:"success",className:"float-right mt-4",onClick:function(e){return r("uiState/set",{mode:"editProvider"})}},a.a.createElement("span",{className:"mr-2"},"Get Started"),a.a.createElement(Xe.a,{icon:et.c,className:"mr-2"})),a.a.createElement("div",{className:"clearfix"}))},St=function(){var e=Ue()("uiState","providers","credentials","organizations","orgDefaults","redirectUri"),t=e.uiState,r=e.providers,o=e.credentials,i=e.organizations,l=e.orgDefaults,c=e.redirectUri,u=e.dispatch,d=Object(n.useState)({}),f=Object(Te.a)(d,2),m=f[0],p=f[1],h=v.a.chain(i).map((function(e){return{label:e.name,value:e.orgId||e.fhirEndpoint}})).sortBy((function(e){return e.label})).value();Object(n.useEffect)((function(){if(!m.id&&t.id&&"editProvider"===t.mode){var e=r.find((function(e){return e.id===t.id}));p(e)}}),[t.id,t.mode,m.id,r]);var g=function(e){var t=i.find((function(t){return e.value===t.orgId||e.value===t.fhirEndpoint})),r=l[t.defaultId]||{};void 0!==t.defaultId&&(t=Object(s.a)({},r,{},t)),t.credentialId&&(t=Object(s.a)({},o[t.credentialId],{},t)),p(Object(s.a)({},t,{redirectUri:c,id:m.id,orgId:e.value,queryProfile:t.queryProfile||"argonaut_spec"}))};return a.a.createElement("div",{className:"p-2"},a.a.createElement("h4",{className:"mb-4"},"Select Your Provider"),a.a.createElement("p",null,"Choose a healthcare institution where you've received care from the list below."),a.a.createElement("p",null,"If you've been to multiple healthcare providers, after retrieving your records you'll have the option to return to this screen to select another institution."),function(){var e=m.orgId?h.find((function(e){return e.value===m.orgId})):null;return a.a.createElement($e.a,{id:"organization",autoFocus:!0,filterOption:Object(He.b)({ignoreAccents:!1}),value:e,onChange:g,isSearchable:!0,options:h,defaultMenuIsOpen:!0})}(),a.a.createElement("div",{className:"d-flex"},a.a.createElement("div",{className:"align-self-end flex-grow-1 mt-4 pl-1"},r.length>0&&a.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),u("uiState/set",{mode:"review"})}},"skip")),a.a.createElement("div",null,a.a.createElement(Be.a,{color:"success",className:"mt-4",onClick:function(e){e.preventDefault(),u("providers/upsertAndLoad",m),u("refreshDirty")},disabled:!m.orgId},a.a.createElement("span",{className:"mr-2"},"Login to Patient Portal"),a.a.createElement(Xe.a,{icon:et.c,className:"mr-2"})))))},xt=function(){var e=Ue()("uiState","providers"),t=e.uiState,r=e.providers,o=e.dispatch,i=Object(n.useMemo)((function(){return r.find((function(e){return e.id===t.id}))}),[t.id,r]),l=Object(n.useCallback)((function(e){e.preventDefault(),o("fhir/cancelLoad","editProvider"),o("providers/remove",i.id)}),[o,i]),c=function(e){o("providers/remove",i.id),o("uiState/set",{mode:"editProvider"})};if(Object(n.useEffect)((function(){var e=function(e){27===e.keyCode&&("authorizing"!==t.submode&&"loading"!==t.submode||l(e))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[l,t.submode]),"loadData"!==t.mode)return null;"loaded"===t.submode&&(o("providers/update",{id:i.id,lastUpdated:new Date,data:t.data}),o("uiState/set",{mode:"review"}));var s=function(e){return a.a.createElement("div",{className:"p-4 text-center"},a.a.createElement("h5",{className:"mb-4"},e),a.a.createElement("div",{className:"my-4"},a.a.createElement(nt.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),a.a.createElement("div",null,a.a.createElement(Be.a,{color:"outline-primary",onClick:l},"Cancel")))};return a.a.createElement("div",null,a.a.createElement("h4",null,i.name),"authorizing"===t.submode&&s("Waiting for Portal Login..."),"loading"===t.submode&&s("Retrieving Healthcare Records..."),"error"===t.submode&&a.a.createElement("div",{className:"p-2"},a.a.createElement("h5",null,"Error"),a.a.createElement("p",null,"An error occurred loading your record: ",t.status),a.a.createElement("div",null,a.a.createElement(Be.a,{color:"primary",className:"mt-4",onClick:c},a.a.createElement(Xe.a,{icon:et.b,className:"mr-2"}),a.a.createElement("span",{className:"mr-2"},"Back")))))},Pt=function(e){var t=Ue()("spreadsheetTemplates","nonModalUi"),r=t.spreadsheetTemplates,o=t.nonModalUi,i=t.dispatch,l=Object(n.useState)(!1),c=Object(Te.a)(l,2),s=c[0],u=c[1],d=function(e,t,r){r.preventDefault(),i("export/spreadsheet",{templateId:e,format:t})},f=[a.a.createElement(yt.a,{key:"fhir",onClick:function(e){e.preventDefault(),i("export/download")}},"FHIR Format")];return(Object.keys(r)||[]).forEach((function(e){f.push(a.a.createElement(yt.a,{key:e+"-xlsx",onClick:d.bind(void 0,e,"xlsx")},"Spreadsheet of ",r[e].name))})),a.a.createElement(Et.a,{className:e.className,style:{display:"inline"},disabled:o.isExportingSheet,isOpen:s,toggle:function(e){return u(!s)}},a.a.createElement(bt.a,{color:"outline-secondary",style:{margin:"0 1rem 0 0"},caret:!0},a.a.createElement(Xe.a,{icon:et.e,className:"mr-2"}),a.a.createElement("span",{className:"mr-2"},"Download copy of data")),a.a.createElement(wt.a,null,f))},Nt=function(){var e=Ue()("providers","upload"),t=e.providers,r=e.upload,n=e.dispatch,o=v.a.chain(t).sortBy((function(e){return e.lastUpdated})).map((function(e){return a.a.createElement("li",{key:e.id},e.name," ","(",a.a.createElement("a",{href:"#",onClick:function(t){return function(e,t){t.preventDefault(),n("providers/remove",e),n("refreshDirty")}(e.id,t)}},"remove"),")")})).value();return a.a.createElement("div",{className:"p-2"},a.a.createElement("h4",{className:"mb-4"},"Review Data to Share"),a.a.createElement("p",null,"You have collected records from the following healthcare providers:"),a.a.createElement("ul",null,o),a.a.createElement("div",{className:"d-md-flex"},a.a.createElement("div",{className:"align-self-end flex-grow-1 mt-4"},a.a.createElement(Pt,null)),a.a.createElement("div",null,a.a.createElement(Be.a,{color:"success",onClick:function(e){e.preventDefault(),n("uiState/set",{mode:"editProvider"})},className:"btn-block text-left mt-4"},a.a.createElement("div",{className:"d-flex"},a.a.createElement("div",{className:"mr-2 align-self-center flex-grow-1"},"Add another provider"),a.a.createElement("div",{className:"mr-2 align-self-center"},a.a.createElement(Xe.a,{icon:et.c})))),a.a.createElement(Be.a,{color:"success",className:"btn-block text-left mt-2",disabled:0===o.length,onClick:function(e){e.preventDefault(),n("export/upload/send")}},a.a.createElement("div",{className:"d-flex"},a.a.createElement("div",{className:"mr-2 align-self-center flex-grow-1"},"Share with ",r.name),a.a.createElement("div",{className:"mr-2 align-self-center"},a.a.createElement(Xe.a,{icon:et.c})))))))},Tt=function(){var e=Ue()("uiState","upload"),t=e.uiState,r=e.upload,o=e.dispatch,i=Object(n.useCallback)((function(e){e&&e.preventDefault(),o("uiState/set",{mode:"review"})}),[o]),l=Object(n.useCallback)((function(e){e&&e.preventDefault(),r.continueUrl&&(window.location.href=r.continueUrl)}),[r]),c=Object(n.useCallback)((function(e){e.preventDefault(),o("export/upload/cancel"),o("uiState/set",{mode:"review"})}),[o]);Object(n.useEffect)((function(){var e=function(e){27===e.keyCode&&"uploading"!==t.submode&&c(e)};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t.submode,c,i]);return a.a.createElement("div",null,"error"===t.submode&&a.a.createElement("div",{className:"p-2"},a.a.createElement("h5",null,"Error"),a.a.createElement("p",null,t.status),a.a.createElement("div",null,a.a.createElement(Be.a,{color:"primary",className:"mt-4",onClick:i},a.a.createElement(Xe.a,{icon:et.b,className:"mr-2"}),a.a.createElement("span",{className:"mr-2"},"Back")))),"postUpload"!==t.submode&&"error"!==t.submode&&a.a.createElement("div",{className:"p-4 text-center"},a.a.createElement("h5",{className:"mb-4"},t.status||"Preparing to send data"),a.a.createElement("div",{className:"my-4"},a.a.createElement(nt.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),a.a.createElement("div",null,a.a.createElement(Be.a,{color:"outline-primary",onClick:c},"Cancel"))),"postUpload"===t.submode&&a.a.createElement("div",{className:"p-2"},a.a.createElement("h5",null,"Success"),a.a.createElement("p",null,r.successMessage||"Your healthcare records have been successfully shared with "+r.name+"."),a.a.createElement(Pt,{className:"float-left mt-4"}),r.continueUrl&&a.a.createElement(Be.a,{color:"success",className:"float-right mt-4",onClick:l},a.a.createElement("span",{className:"mr-2"},r.continueLabel||"Continue to "+r.name),a.a.createElement(Xe.a,{icon:et.c,className:"mr-2"})),a.a.createElement("div",{className:"clearfix"})))},Dt=function(){var e=Ue()("uiState","appName"),t=e.uiState,r=e.dispatch,n=e.appName,o={active:{background:"#3182CE",border:"1px solid white",color:"white"},inactive:{color:"#3182CE",border:"1px solid #3182CE",background:"white"}},i="loadData"!==t.mode&&("upload"!==t.mode||"loaded"===t.submode)&&a.a.createElement(Ne.a,null,a.a.createElement(Pe.a,{className:"text-center"},a.a.createElement("small",{className:"mt-4 float-right d-none d-sm-block"},a.a.createElement("a",{href:"#",onClick:function(){return r("wizard/hide")},className:"text-muted"},"switch to full version of Procure"))));return a.a.createElement("div",null,i,a.a.createElement(Ne.a,null,a.a.createElement(Pe.a,null,a.a.createElement("h2",{style:{color:"#3182CE",padding:"1em 0",textAlign:"center"}},a.a.createElement(Xe.a,{icon:et.g,alt:"Procure logo",className:"mr-2"}),a.a.createElement("span",null,n||"Procure")))),a.a.createElement(Ne.a,null,a.a.createElement(Pe.a,{md:{size:10,offset:1},lg:{size:8,offset:2}},a.a.createElement("div",{className:"shadow p-4 mb-5 bg-white rounded unbox-sm"},a.a.createElement("div",{className:"d-none d-sm-block"},a.a.createElement("div",{className:"d-none d-flex flex-row justify-content-around mb-4",style:{borderBottom:"1px solid #3182CE"}},a.a.createElement("div",{className:"p-2 text-center"},a.a.createElement("div",{style:Object(s.a)({},o["ready"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"1"),a.a.createElement("div",null,"Start")),a.a.createElement("div",{className:"my-auto"},a.a.createElement(Xe.a,{icon:et.c,alt:"arrow right",className:"m-2"})),a.a.createElement("div",{className:"p-2 text-center"},a.a.createElement("div",{style:Object(s.a)({},o["editProvider"===t.mode||"loadData"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"2"),a.a.createElement("div",null,"Retrieve Records")),a.a.createElement("div",{className:"my-auto"},a.a.createElement(Xe.a,{icon:et.c,alt:"arrow right",className:"m-2"})),a.a.createElement("div",{className:"p-2 text-center"},a.a.createElement("div",{style:Object(s.a)({},o["review"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"3"),a.a.createElement("div",null,"Review")),a.a.createElement("div",{className:"my-auto"},a.a.createElement(Xe.a,{icon:et.c,alt:"arrow right",className:"mr-2"})),a.a.createElement("div",{className:"p-2 text-center"},a.a.createElement("div",{style:Object(s.a)({},o["fileUpload"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"4"),a.a.createElement("div",null,"Share Records")))),"ready"===t.mode&&a.a.createElement(Ut,null),"editProvider"===t.mode&&a.a.createElement(St,null),"loadData"===t.mode&&a.a.createElement(xt,null),"review"===t.mode&&a.a.createElement(Nt,null),"fileUpload"===t.mode&&a.a.createElement(Tt,null)))))},Lt=function(){var e=Ue()("uiState","upload","showWizard","providers","appName"),t=e.uiState,r=e.showWizard,o=e.upload,i=e.providers,l=e.appName;if(Object(n.useEffect)((function(){document.title=l||"Procure"}),[l]),"loading"===t.mode)return a.a.createElement(ot,null);if("globalError"===t.mode)return a.a.createElement(Se.a,{style:{margin:"1em"}},a.a.createElement(xe.a,{color:"danger"},a.a.createElement("span",null,"Failed to load configuration information."),a.a.createElement("br",null),a.a.createElement("span",null,t.error.toString())));var c=a.a.createElement(Pe.a,{xs:"12",style:{margin:"0.5rem"}},a.a.createElement(xe.a,{color:"warning",style:{textAlign:"center"}},t.error)),s=i&&i.length,u=s&&v.a.find(i,(function(e){return e.selected&&e.data&&e.data.entry&&(e.data.entry.length||e.data.errorLog.length)})),d=s&&v.a.find(i,(function(e){return e.selected&&e.data&&e.data.entry&&e.data.entry.length})),f=a.a.createElement("div",null,a.a.createElement(mt,null),a.a.createElement(Se.a,{fluid:!0},a.a.createElement(Ne.a,{className:"m-2"},t.error&&"ready"===t.mode&&c,s?a.a.createElement(Pe.a,{xs:"12",md:"6",lg:"5",xl:"4"},a.a.createElement(rt,null)):a.a.createElement(Pe.a,{sm:{size:4,offset:4}},a.a.createElement(jt,null)),u?function(e){return a.a.createElement(Pe.a,{xs:"12",md:"6",lg:"7",xl:"8"},a.a.createElement(Ct,{hasResources:e}),e&&a.a.createElement(vt,null))}(d):null),"editProvider"===t.mode&&a.a.createElement(Ve,null),"loadData"===t.mode&&a.a.createElement(at,null),"githubExport"===t.mode&&a.a.createElement(it,null),"fileUpload"===t.mode&&a.a.createElement(Ot,null))),m=r&&o&&(o.manifestUrl||o.uploadUrl)&&a.a.createElement(Se.a,null,t.error&&"ready"===t.mode&&a.a.createElement(Ne.a,{className:"m-2"},c),a.a.createElement(Dt,null));return m?(document.body.classList.add("bg-light-md"),m):(document.body.classList="",f)},At=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function It(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var r=e.installing;null!=r&&(r.onstatechange=function(){"installed"===r.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}je.dispatch("config/load","ready"),i.a.render(a.a.createElement(c.a.Provider,{value:je},a.a.createElement(Lt,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/procure-wip",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/procure-wip","/sw.js");At?(!function(e,t){fetch(e).then((function(r){var n=r.headers.get("content-type");404===r.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):It(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):It(t,e)}))}}()}},[[281,1,2]]]);
//# sourceMappingURL=main.65e8201e.chunk.js.map